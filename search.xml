<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>command</title>
    <url>/post/command.html</url>
    <content><![CDATA[<h1 id="Linux-基础命令"><a href="#Linux-基础命令" class="headerlink" title="Linux 基础命令"></a>Linux 基础命令</h1><h2 id="1-打包解压缩"><a href="#1-打包解压缩" class="headerlink" title="1.打包解压缩"></a>1.打包解压缩</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.打包文件(c表示打包，f指定要操作的文件)</span></span><br><span class="line">tar cf /tmp/demobackup.tar  demo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.打包并压缩（加入z,j,J参数表示用不同的压缩方式来压缩，用双扩展名表示打包并压缩）</span></span><br><span class="line"><span class="comment">#压缩方式：gzip-&gt;.tar.gz/.tgz    bzip2-&gt;.tar.bz2/.tbz2（双扩展名的两种写法都可以）</span></span><br><span class="line">tar czf /tmp/demobackup.tar.gz   demo</span><br><span class="line">tar cjf /tmp/demobackup.tar.bz2  demo</span><br><span class="line">tar cJf /tmp/demobackup.tar.xz   demo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.解压（x参数解压）</span></span><br><span class="line">tar xf    /tmp/demobackup.tar  -C  文件解包存放的位置  <span class="comment">#-C 在特定目录解压缩</span></span><br><span class="line">tar xzfv  /tmp/demobackup.tar.gz    <span class="comment"># -v 解压缩过程将文件显示出来</span></span><br><span class="line">tar xjf  /tmp/demobackup.tar.bz2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 查看压缩包中的文件</span></span><br><span class="line">-t 查看压缩包里面的文件 ，t,c,x三个动作参数不能同时存在，一次操作只能使用其中的一个参数</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-ls-的参数"><a href="#2-ls-的参数" class="headerlink" title="2.ls 的参数"></a>2.ls 的参数</h2><table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">用法</th>
</tr>
</thead>
<tbody><tr>
<td align="left">- l</td>
<td align="left">显示长格式文件</td>
</tr>
<tr>
<td align="left">-a</td>
<td align="left">显示隐藏文件</td>
</tr>
<tr>
<td align="left">-t</td>
<td align="left">按照时间顺序显示</td>
</tr>
<tr>
<td align="left">-R</td>
<td align="left">递归显示</td>
</tr>
<tr>
<td align="left">-h</td>
<td align="left">文件大小用 M 显示</td>
</tr>
<tr>
<td align="left">-d</td>
<td align="left">单独查看某个文件，ls -d 要查看的文件名</td>
</tr>
<tr>
<td align="left">-r</td>
<td align="left">逆序显示</td>
</tr>
</tbody></table>
<h2 id="3-文件及文件夹操作"><a href="#3-文件及文件夹操作" class="headerlink" title="3.文件及文件夹操作"></a>3.文件及文件夹操作</h2><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">mkdir</td>
<td align="left">新建文件夹</td>
</tr>
<tr>
<td align="left">mkdir -p &#x2F;tmp&#x2F;demo&#x2F;</td>
<td align="left">嵌套建立多层目录</td>
</tr>
<tr>
<td align="left">rmdir</td>
<td align="left">删除空文件夹</td>
</tr>
<tr>
<td align="left">rm -rf</td>
<td align="left">删除非空目录，f 表示不提示</td>
</tr>
<tr>
<td align="left">rm</td>
<td align="left">删除文件</td>
</tr>
<tr>
<td align="left">cp -r</td>
<td align="left">复制目录</td>
</tr>
<tr>
<td align="left">cp -p</td>
<td align="left">复制文件但是保留用户权限时间等文件属性</td>
</tr>
<tr>
<td align="left">mv</td>
<td align="left">移动 mv 原文件 目的目录</td>
</tr>
<tr>
<td align="left">mv</td>
<td align="left">重命名 mv 源文件名 目标文件名</td>
</tr>
</tbody></table>
<h2 id="4-Vim-操作"><a href="#4-Vim-操作" class="headerlink" title="4.Vim 操作"></a>4.Vim 操作</h2><h3 id="1-插入模式"><a href="#1-插入模式" class="headerlink" title="1.插入模式"></a>1.插入模式</h3><table>
<thead>
<tr>
<th align="left">进入插入模式有多种方式</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">i</td>
<td align="left">光标处插入</td>
</tr>
<tr>
<td align="left">I</td>
<td align="left">光标移到该行开头插入</td>
</tr>
<tr>
<td align="left">a</td>
<td align="left">光标移到后一位插入</td>
</tr>
<tr>
<td align="left">A</td>
<td align="left">光标移到该行末尾插入</td>
</tr>
<tr>
<td align="left">o</td>
<td align="left">光标该行的下一行插入空行</td>
</tr>
<tr>
<td align="left">O</td>
<td align="left">光标该行的上一行插入空行</td>
</tr>
</tbody></table>
<h3 id="2-正常模式"><a href="#2-正常模式" class="headerlink" title="2.正常模式"></a>2.正常模式</h3><p>(插入模式下按 ESC 回到正常模式)</p>
<table>
<thead>
<tr>
<th align="left">正常模式</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">h j k l</td>
<td align="left">光标上下左右移动操作</td>
</tr>
<tr>
<td align="left">yy</td>
<td align="left">单行复制</td>
</tr>
<tr>
<td align="left">3yy</td>
<td align="left">多行复制，复制 3 行</td>
</tr>
<tr>
<td align="left">y$</td>
<td align="left">复制光标到该行结尾的所有内容</td>
</tr>
<tr>
<td align="left">p</td>
<td align="left">将复试的行粘贴</td>
</tr>
<tr>
<td align="left">dd</td>
<td align="left">剪切光标所在的行</td>
</tr>
<tr>
<td align="left">d$</td>
<td align="left">剪切光标到该行结尾的所有内容</td>
</tr>
<tr>
<td align="left">u</td>
<td align="left">复原前一个动作(撤销)</td>
</tr>
<tr>
<td align="left">ctrl + r</td>
<td align="left">重做上一个动作</td>
</tr>
<tr>
<td align="left">x</td>
<td align="left">删除光标当前字符</td>
</tr>
<tr>
<td align="left">r</td>
<td align="left">替换光标当前字符</td>
</tr>
<tr>
<td align="left">^</td>
<td align="left">光标移到该行开头</td>
</tr>
<tr>
<td align="left">$</td>
<td align="left">光标移到该行末尾</td>
</tr>
<tr>
<td align="left">g</td>
<td align="left">光标移到文本第一行开头</td>
</tr>
<tr>
<td align="left">G</td>
<td align="left">光标移到文本最后一行开头</td>
</tr>
<tr>
<td align="left">5G</td>
<td align="left">光标移到指定的第 5 行的开头</td>
</tr>
<tr>
<td align="left">:set nu</td>
<td align="left">显示行数</td>
</tr>
<tr>
<td align="left">:set nonu</td>
<td align="left">不显示行数</td>
</tr>
</tbody></table>
<h3 id="3-命令模式"><a href="#3-命令模式" class="headerlink" title="3.命令模式"></a>3.命令模式</h3><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">:w</td>
<td align="left">保存文件（ :w &#x2F;root&#x2F;a.txt 适用于直接 vi 文件没保存的）</td>
</tr>
<tr>
<td align="left">:q</td>
<td align="left">退出</td>
</tr>
<tr>
<td align="left">:q!</td>
<td align="left">表示强制退出，不对文件进行保存 等于<code>ZQ</code></td>
</tr>
<tr>
<td align="left">:wq</td>
<td align="left">强制性写入文件并退出。即使文件没有被修改也强制写入，并更新文件的修改时间。等同于<code>ZZ</code></td>
</tr>
<tr>
<td align="left">:wq!</td>
<td align="left">保存并强制退出</td>
</tr>
<tr>
<td align="left">:! 命令</td>
<td align="left"><code>:!ifconfig</code>临时退出去看 ip 地址</td>
</tr>
<tr>
<td align="left">&#x2F;word</td>
<td align="left">向光标之下寻找一个名称为 word 的字符串。（多次按<code>n</code>向下查找 &#x2F; 按<code>shift+n</code>向上查找(反向查找)）</td>
</tr>
<tr>
<td align="left">?word</td>
<td align="left">向光标之上寻找一个字符串名称为 word 的字符串。（多次按<code>n</code>向上查找 &#x2F; 按<code>shift+n</code>向下查找）</td>
</tr>
<tr>
<td align="left">:n1,n2s&#x2F;a&#x2F;b&#x2F;g</td>
<td align="left">部分行内替换， <code>:3,5/s/7/8/g</code>在第三 3 行到 5 行将 7 替换成 8</td>
</tr>
<tr>
<td align="left">:%s&#x2F;a&#x2F;b&#x2F;g</td>
<td align="left">全文替换，将 a 替换成 b</td>
</tr>
</tbody></table>
<h3 id="4-可视模式"><a href="#4-可视模式" class="headerlink" title="4.可视模式"></a>4.可视模式</h3><table>
<thead>
<tr>
<th>正常模式进入可视模式的命令</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>v</td>
<td>进入字符可视模式</td>
</tr>
<tr>
<td>V（shift+v）</td>
<td>行可视模式</td>
</tr>
<tr>
<td>ctrl + v</td>
<td>块可视模式，配合 d 和大写 i 命令进行块的操作</td>
</tr>
</tbody></table>
<blockquote>
<p>举例；块模式，先按 ctrl+v,用光标移动选择对应的块（每一行相同位置组成的块），再按 shift+i，回到所选快位置的第一行光标处插入 XXX，再按 2 下 ESC，这样所选块的每一行开头都插入了 XXX 内容。或者选中了块后按 d 删掉该块</p>
</blockquote>
<h2 id="5-用户和用户组管理"><a href="#5-用户和用户组管理" class="headerlink" title="5.用户和用户组管理"></a>5.用户和用户组管理</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">useradd 新用户名</span><br><span class="line"><span class="built_in">id</span> 用户名</span><br><span class="line">passwd 用户名(修改用户密码)</span><br><span class="line">userdel 用户名(删除用户但是会保留该用户的家目录)</span><br><span class="line">userdel -r 用户名（删除用户不会保留用户的家目录，删得比较干净）</span><br><span class="line"></span><br><span class="line">groupadd 用户组名 （新建用户组）</span><br><span class="line">usermod -g 目标用户组 用户名 （将用户加入到目标用户组中）</span><br><span class="line">useradd -g 目标用户组 新建用户名 （新建用户并直接加入到目标用户组中，常用，一步到位）</span><br><span class="line">su 用户名（切换用户）</span><br><span class="line"><span class="built_in">sudo</span> (以其他用户身份执行命令)</span><br></pre></td></tr></table></figure>

<h2 id="6-文件和目录的权限"><a href="#6-文件和目录的权限" class="headerlink" title="6.文件和目录的权限"></a>6.文件和目录的权限</h2><p>1.文件类型:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- 普通文件</span><br><span class="line">d 目录</span><br><span class="line">l 符号链接</span><br><span class="line">b 块特殊文件（设备文件）</span><br><span class="line">c字符设备文件（设备文件）</span><br><span class="line">f命名管道（网络中的）</span><br><span class="line">s套接字文件（网络中的）</span><br></pre></td></tr></table></figure>

<p>2.权限表示方法</p>
<table>
<thead>
<tr>
<th align="left">普通文件字符权限表示方法</th>
<th align="left">数字权限表示</th>
<th align="left">目录文件权限表示方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left">r 读</td>
<td align="left">r&#x3D;4</td>
<td align="left">x 进入目录</td>
</tr>
<tr>
<td align="left">w 写</td>
<td align="left">w&#x3D;2</td>
<td align="left">rx 显示目录内的文件名（可进可查看）</td>
</tr>
<tr>
<td align="left">x 执行</td>
<td align="left">x&#x3D;1</td>
<td align="left">wx 修改目录内的文件（可修改可删除）</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left">rwx 修改目录内的文件（可进可查看可修改可删除）</td>
</tr>
</tbody></table>
<blockquote>
<p>创建新文件有默认权限，根据 umask(022)来计算，属主和属组根据当前进程的用户来设定，默认的普通文件权限应该是 666，减去 umask 等于 644，则默认文件权限都是 644</p>
</blockquote>
<p>3.修改权限命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1. <span class="built_in">chmod</span> 修改文件，目录的权限</span><br><span class="line">修改权限： 属主权限（u） 属组权限(g) 其他用户权限(0)  3个一起修改(a)</span><br><span class="line">例子；</span><br><span class="line">		<span class="built_in">chmod</span> g+x afile</span><br><span class="line">		<span class="built_in">chmod</span> o-r afile</span><br><span class="line">		<span class="built_in">chmod</span> a+w afile</span><br><span class="line"></span><br><span class="line">2. <span class="built_in">chown</span> 更改属主和属组</span><br><span class="line"><span class="built_in">chown</span> user1 /test (更改目录<span class="built_in">test</span>的属主为user1)</span><br><span class="line"><span class="built_in">chown</span> :group1 /test (更改目录<span class="built_in">test</span>的属组，属组前面要加上:)</span><br><span class="line"><span class="built_in">chown</span> user1:group /test (同时更改属主和属组)</span><br><span class="line"></span><br><span class="line">3. <span class="built_in">chgrp</span> 可以单独更改属组（不常用）</span><br></pre></td></tr></table></figure>

<p>4.特殊权限</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SUID （用于二进制可执行文件，执行命令时取得文件属主权限，如/usr/bin/passwd ; -rwsr-xr-x）</span><br><span class="line">	<span class="built_in">chmod</span> 4XXX /afile (给文件设置SUID，用数字权限前面加个４)</span><br><span class="line"></span><br><span class="line">SGID (用于目录，在该目录下创建新文件和目录，权限自动更改为该目录的属组，文件共享的时候经常用到)</span><br><span class="line">	<span class="built_in">chmod</span> １XXX /afile (给文件设置SGID ，用数字权限前面加个１)</span><br><span class="line"></span><br><span class="line">SBIT （用于目录，该目录下新建的文件和目录，仅root和自己可以删除，如<span class="built_in">ls</span> /tmp ; drwxrwxrwt.）</span><br></pre></td></tr></table></figure>

<h2 id="7-进程和文件系统"><a href="#7-进程和文件系统" class="headerlink" title="7.进程和文件系统"></a>7.进程和文件系统</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1.查看进程</span><br><span class="line">ps -e</span><br><span class="line">ps -ef</span><br><span class="line">ps -eLf|more  (分页查看更多进程)</span><br><span class="line">top</span><br><span class="line">top -p 进程号 (只动态查看一个进程)</span><br><span class="line">pstree</span><br><span class="line"></span><br><span class="line">2. 内存查看</span><br><span class="line">free -m</span><br><span class="line">top</span><br><span class="line"></span><br><span class="line">3.磁盘查看</span><br><span class="line">fdisk -l (分区磁盘的查看)</span><br><span class="line">parted -l</span><br><span class="line">dh -h</span><br><span class="line"><span class="built_in">du</span> /etc/passwd (查看文件实际用量)（<span class="built_in">ls</span> -lh 中的h查出来的文件有空洞大小，不是文件实际的大小）</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建一个有空洞的文件（linux 虚拟化就是创建一个非常大比如 1T 大小的文件，实际占用大小可以很小）<br>dd if&#x3D;&#x2F;dev&#x2F;zero bs&#x3D;4M count&#x3D;10 seek&#x3D;20 of&#x3D;bfile<br>count 就是记录一块是 10M，seek 时跳过 20 块 X4M<br>ls -lh bfile -&gt; 120M (记录从看似 hi 到结尾写了多少字节)<br>du -h bfile -&gt;40M(真正统计实际的文件长度)</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">常见的文件系统，linux支持多种文件系统：ext4/xfs/NTFS</span><br><span class="line">ext4中</span><br><span class="line">超级块</span><br><span class="line">i节点（inode），记录每个文件权限信息，文件名存在父目录中，<span class="built_in">ls</span> -i查看</span><br><span class="line">数据块（datablock），记录数据信息</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">用i节点的角度来解读下面几个命令：</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> afile afile1</span><br><span class="line"><span class="built_in">ls</span> -li afile* 复制文件，会生成2个不同的i节点</span><br><span class="line"></span><br><span class="line"><span class="built_in">mv</span> afile afile2</span><br><span class="line"><span class="built_in">ls</span> -li afile* 重命名很快，是因为两个文件对应的i节点没变</span><br><span class="line"></span><br><span class="line">vim编辑文件保存后会改变i节点，因为每次使用vi编辑一个文件，它会在缓冲区新生成一个afile.swp的隐藏文件，改变的数据存在swp文件中。</span><br><span class="line"><span class="built_in">echo</span> 123&gt;afile 追加不会改变i节点，只会改变数据块的内容</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> afile 删除文件，准确来说是将i节点和文件名之间的链接断开</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ln afile bfile</code> 给 afile 创建一个<em>硬链接</em>，硬链接的两个文件是<em>同步更改</em>的，这两个文件名指向同一个 i 节点</li>
</ul>
<ol>
<li>硬链接:两个文件指定的是同一个 inode</li>
<li>硬链接不能跨分区存在</li>
<li>硬链接不能链接到目录(要避免循环引用)</li>
<li>删除硬链接只会减少文件被硬链接的次数,源文件不会动.<br>删除源文件，硬链接不受影响。</li>
</ol>
<ul>
<li><code>ln -s afile aafile</code> 给 afile 创建一个<em>软链接（符号链接</em>），aafile 文件的 i 节点和 afile 是不一样的。<br><code>ls -li aafile -&gt; 3799 lrwxrwxrwx ... </code>(会多一个<code>l</code>表示它是一个符号链接)</li>
</ul>
<ol>
<li>软链接:是一个独立的文件,有自己独立的 inode，和源文件不一样。</li>
<li>软链接没有存储任何数据，只是存储了访问文件的另-种路径，所以对软连接修改权限是不会生效的.<br>软链接可以对目录创建也可以跨分区</li>
<li>删除软链接,跟源文件没任何关系。<br>源文件被删除,软连接将不可用.</li>
</ol>
<h1 id="shell-脚本"><a href="#shell-脚本" class="headerlink" title="shell 脚本"></a>shell 脚本</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">##1.计算1-100的和</span></span><br><span class="line"><span class="built_in">sum</span>=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 1 100`;<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">sum</span>=$[<span class="variable">$sum</span>+<span class="variable">$i</span>]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$sum</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">##2.编写shell脚本，要求输入一个数字，然后计算出从1到输入数字的和，要求，如果输入的数字小于1，则重新输入，直到输入正确的数字为止</span></span><br><span class="line">n=0</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$n</span> -lt 1 ] ;<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">read</span> -p <span class="string">&quot;请输入大于或者等于1的数字：&quot;</span> n</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">sum</span>=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 1 <span class="variable">$n</span>`;<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">sum</span>=$[<span class="variable">$sum</span>+<span class="variable">$i</span>]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$sum</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">##3.编写shell脚本，把/root/目录下的所有目录（只需要一级）拷贝到/tmp/目录下</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">ls</span> ./demo`;<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">	<span class="keyword">if</span> [ -d <span class="variable">$i</span> ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$i</span>是文件&quot;</span></span><br><span class="line">	<span class="built_in">cp</span> -r ./demo/<span class="variable">$i</span> ./tmp</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;cp复制&quot;</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">##4. 编写shell脚本，批量建立用户user_00, user_01, … ,user_100并且所有用户同属于users组；</span></span><br><span class="line">groupadd <span class="built_in">users</span>;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 0 9`;<span class="keyword">do</span></span><br><span class="line">	useradd -G <span class="built_in">users</span> user_<span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 10 100`;<span class="keyword">do</span></span><br><span class="line">	useradd -G <span class="built_in">users</span> user_<span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">##5. 编写shell脚本，截取文件test.log中包含关键词’abc’的行中的第一列（假设分隔符为”:”），然后把截取的数字排序（假设第一列为数字），然后打印出重复次数超过10次的列；</span></span><br><span class="line">awk -F <span class="string">&quot;:&quot;</span> <span class="string">&quot;<span class="variable">$0</span>~/abc/ &#123;print <span class="variable">$1</span>&#125;&quot;</span> test.log &gt; data.txt</span><br><span class="line"><span class="built_in">sort</span> -n data.txt |<span class="built_in">uniq</span> -c|<span class="built_in">sort</span> -n &gt; res.txt</span><br><span class="line">awk <span class="string">&#x27;$1&gt;10 &#123;print $2&#125;&#x27;</span> res.txt</span><br><span class="line"><span class="comment">#uniq -c 检查文件并删除文件中重复出现的行，并在行首显示该行重复出现的次数。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">##6. 编写shell脚本，判断输入的IP是否正确（IP的规则是，n1.n2.n3.n4，其中1&lt;n1&lt;255, 0&lt;n2&lt;255,=&quot;&quot; 0&lt;n3&lt;255,=&quot;&quot; 0&lt;n4&lt;255&lt;=&quot;&quot; span=&quot;&quot;&gt;）。</span></span><br><span class="line">？？？</span><br></pre></td></tr></table></figure>

<p><img src="/images/commandshell1.png"><br><img src="/images/commandshell2.png"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## 7.批量重命名</span></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> `<span class="built_in">ls</span> *.mp3`; <span class="keyword">do</span></span><br><span class="line"><span class="built_in">mv</span> <span class="variable">$filename</span> $(<span class="built_in">basename</span> <span class="variable">$filename</span> .mp3).mp4</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#实用场景，递归删除一个文件夹下指定后缀名的文件</span></span><br><span class="line"><span class="comment">#! /bin/bash</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">deletefiles</span></span>()&#123;</span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;1##*.&#125;</span>&quot;</span> = <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;后缀名是 <span class="variable">$2</span>, 删除 <span class="variable">$1</span>&quot;</span></span><br><span class="line">		<span class="built_in">rm</span> -f <span class="variable">$1</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">listfolder</span></span>()&#123;</span><br><span class="line">	<span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ] || [ <span class="string">&quot;`ls -A <span class="variable">$1</span>`&quot;</span> = <span class="string">&quot;&quot;</span> ]</span><br><span class="line">	<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span>不存在或者是个空目录&quot;</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		flists=`<span class="built_in">ls</span> <span class="variable">$1</span>`</span><br><span class="line">		<span class="built_in">cd</span> <span class="variable">$1</span></span><br><span class="line">		<span class="keyword">for</span> f <span class="keyword">in</span> <span class="variable">$flists</span></span><br><span class="line">		<span class="keyword">do</span></span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">test</span> -d <span class="variable">$f</span></span><br><span class="line">			<span class="keyword">then</span></span><br><span class="line">				listfolder <span class="variable">$f</span> <span class="variable">$2</span></span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				deletefiles <span class="variable">$f</span> <span class="variable">$2</span></span><br><span class="line">			<span class="keyword">fi</span></span><br><span class="line">		<span class="keyword">done</span></span><br><span class="line">		<span class="built_in">cd</span> ../</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">dir</span>=./demo</span><br><span class="line">listfolder <span class="variable">$dir</span> txt mp3</span><br></pre></td></tr></table></figure>

<h1 id="Linux-awk-用法"><a href="#Linux-awk-用法" class="headerlink" title="Linux-awk 用法"></a>Linux-awk 用法</h1><h2 id="1-awk-和-sed-的区别"><a href="#1-awk-和-sed-的区别" class="headerlink" title="1.awk 和 sed 的区别"></a>1.awk 和 sed 的区别</h2><ol>
<li>sed 的核心是正则，对于 sed， 基本的两个概念是匹配和行为。 1. 匹配是通过区域选择加上正则表达式实现，比如“3 到 6 行以 This 开头的” 2. 行为是增删改查。可以在某个位置新增或删除一行，可以通过正则表达式进行变量替换，可以显示满足某些条件的行。配合 shell 的批处理就会很强大， 比如我想把所有文件的开头添加一个注释，比如我想把所有文件的某一个变量进行替换，比如我想把所有文件满足某些条件的行进行合并和拆分。 3. 同时，sed 提供了一个保持空间（hold space）可以实现逆序输出等操作。 4. 另外，sed 的用法非常灵活，你可以将匹配和行为进行不同的嵌套，举个复杂的例子“将第某行到某行之间的满足 A 条件的里面满足 B 条件的行进行 C 操作和 D 操作并且将 E 条件的行进行 F 操作”这样的灵活组合方式怕是也只有 sed 了</li>
<li>awk，经常用于格式化输出，也就是将数据按照我们想要的方式来显示，并且可以做一些基本的统计工作。 1. 它的运作模式是“预处理+逐行处理+最终处理”。一般我们只用“逐行处理”比如对于满足条件的某些行，我们打印某某列。通过指定分隔符，我们很容易的对列进行操作。 2. 预处理来定义变量，逐行处理来修改变量，最终处理来打印变量。</li>
</ol>
<h2 id="2-awk-使用"><a href="#2-awk-使用" class="headerlink" title="2.awk 使用"></a>2.awk 使用</h2><p><code>awk &#39;BEGIN&#123; commands &#125; /pattern/ &#123;commands&#125; END&#123; commands &#125;&#39;</code></p>
<blockquote>
<p>1、<code>BEGIN&#123; commands &#125; </code>开始块就是在程序启动的时候执行的代码部分，并且它在整个过程中只执行一次。一般情况下，我们可以在开始块中初始化一些变量。<br>注意：开始块部分是可选的，你的程序可以没有开始块部分。<br>2、<code> /pattern/ &#123;commands&#125;</code>pattern 部分匹配该行内容成功后，才会执行 commands 的内容。<br>3 <code>END&#123; commands &#125;</code>结束块是在程序结束时执行的代码。<br>注意：结束块部分也是可选的</p>
</blockquote>
<h2 id="3-awk-基本用法"><a href="#3-awk-基本用法" class="headerlink" title="3.awk 基本用法"></a>3.awk 基本用法</h2><table>
<thead>
<tr>
<th>选项</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td>-F</td>
<td align="left"><code>-F &#39;,&#39;</code>或者 <code>-F &#39;正则表达式&#39; </code> -F 选项来改变字段分隔符</td>
</tr>
<tr>
<td>-v</td>
<td align="left"><code>-va=1</code>赋值一个用户定义变量 a 的值为 1</td>
</tr>
<tr>
<td>-f</td>
<td align="left"><code>-f scripfile</code>，从脚本文件中读取 awk 命令</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> 1.txt</span><br><span class="line"> 2 this is a test1</span><br><span class="line"> 3 Are you like awk1</span><br><span class="line"> This<span class="string">&#x27;s a test1</span></span><br><span class="line"><span class="string"> 10 There are orange,apple,mongo</span></span><br><span class="line"><span class="string">------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">$ awk &#x27;</span>&#123;<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$4</span>&#125;<span class="string">&#x27; 1.txt    # 每行按空格或TAB分割，输出文本中的1、4项</span></span><br><span class="line"><span class="string"> 2 a</span></span><br><span class="line"><span class="string"> 3 like</span></span><br><span class="line"><span class="string"> This&#x27;</span>s</span><br><span class="line"> 10 orange,apple,mongo</span><br><span class="line">------------------------------------------------------------------------------------------------------------</span><br><span class="line">$ awk <span class="string">&#x27;&#123;printf &quot;%-8s %-10s\n&quot;,$1,$4&#125;&#x27;</span> 1.txt  <span class="comment"># 格式化输出</span></span><br><span class="line"> 2        a</span><br><span class="line"> 3        like</span><br><span class="line"> This<span class="string">&#x27;s</span></span><br><span class="line"><span class="string"> 10       orange,apple,mongo</span></span><br><span class="line"><span class="string">--------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">$ awk -F, &#x27;</span>&#123;<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$2</span>&#125;<span class="string">&#x27; 1.txt   # 使用&quot;,&quot;分割。-F相当于内置变量FS, 指定分割字符</span></span><br><span class="line"><span class="string"> 2 this is a test</span></span><br><span class="line"><span class="string"> 3 Are you like awk</span></span><br><span class="line"><span class="string"> This&#x27;</span>s a <span class="built_in">test</span></span><br><span class="line"> 10 There are orange apple</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; &#123;print $1,$2&#125;&#x27;</span> 1.txt   <span class="comment"># 或者使用内建变量</span></span><br><span class="line"> 2 this is a <span class="built_in">test</span></span><br><span class="line"> 3 Are you like awk</span><br><span class="line"> This<span class="string">&#x27;s a test</span></span><br><span class="line"><span class="string"> 10 There are orange apple</span></span><br><span class="line"><span class="string">-----------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">$ awk -F &#x27;</span>[ ,]<span class="string">&#x27;  &#x27;</span>&#123;<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$2</span>,<span class="variable">$5</span>&#125;<span class="string">&#x27;   1.txt   # 使用多个分隔符.先使用空格分割，然后对分割结果再使用&quot;,&quot;分割</span></span><br><span class="line"><span class="string"> 2 this test</span></span><br><span class="line"><span class="string"> 3 Are awk</span></span><br><span class="line"><span class="string"> This&#x27;</span>s a</span><br><span class="line"> 10 There apple</span><br><span class="line">-----------------------------------------------------------------------------------------------------</span><br><span class="line">$ awk -va=1 <span class="string">&#x27;&#123;print $1,$1+a&#125;&#x27;</span> 1.txt  <span class="comment"># -v  设置变量</span></span><br><span class="line"> 2 3</span><br><span class="line"> 3 4</span><br><span class="line"> This<span class="string">&#x27;s 1</span></span><br><span class="line"><span class="string"> 10 11</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ awk -va=1 -vb=s &#x27;</span>&#123;<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$1</span>+a,<span class="variable">$1b</span>&#125;<span class="string">&#x27; 1.txt</span></span><br><span class="line"><span class="string"> 2 3 2s</span></span><br><span class="line"><span class="string"> 3 4 3s</span></span><br><span class="line"><span class="string"> This&#x27;</span>s 1 This<span class="string">&#x27;ss</span></span><br><span class="line"><span class="string"> 10 11 10s</span></span><br><span class="line"><span class="string">-----------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="string"> $ awk -f cal.awk log.txt #  awk -f &#123;awk脚本&#125; &#123;文件名&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-awk-常用系统变量"><a href="#4-awk-常用系统变量" class="headerlink" title="4.awk 常用系统变量"></a>4.awk 常用系统变量</h2><table>
<thead>
<tr>
<th align="left">变量</th>
<th align="left">描述（列举常用的，还有很多其他的没怎么常用）</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$n</td>
<td align="left"><strong>$1 当前记录的第 1 个字段的内容</strong>。<strong>和 sed 中的$1 不同,sed 表示第一个参数</strong></td>
</tr>
<tr>
<td align="left">$0</td>
<td align="left">整行数据的内容</td>
</tr>
<tr>
<td align="left">FS</td>
<td align="left">字段分隔符 (默认是空格)</td>
</tr>
<tr>
<td align="left">OFS</td>
<td align="left">输出字段的分隔符（默认是空格）</td>
</tr>
<tr>
<td align="left">RS</td>
<td align="left">行分隔符（默认以\n 作为一行的结尾），单行分割成多行用到</td>
</tr>
<tr>
<td align="left">NR</td>
<td align="left">行号，从 1 开始，多文件时候也是连续接着计数</td>
</tr>
<tr>
<td align="left">FNR</td>
<td align="left">各文件分别计数的行号，多文件的时候会和 NR 不同，它会重新计数</td>
</tr>
<tr>
<td align="left">NF</td>
<td align="left">一行中字段数量，最后一个字段内容可以用<code>$NF</code>取出</td>
</tr>
<tr>
<td align="left">ARGC</td>
<td align="left">命令行参数的数目</td>
</tr>
<tr>
<td align="left">ARGV</td>
<td align="left">包含命令行参数的数组，第一个参数是命令 awk</td>
</tr>
</tbody></table>
<p><img src="/images/commandawk1.png"><br><img src="/images/commandawk2.png"><br><img src="/images/commandawk3.png"><br><img src="/images/commandawk4.png"><br><img src="/images/commandawk5.png"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> log.txt</span><br><span class="line"> 2 this is a test1</span><br><span class="line"> 3 Are you like awk1</span><br><span class="line"> This<span class="string">&#x27;s a test1</span></span><br><span class="line"><span class="string"> 10 There are orange,apple,mongo</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ awk <span class="string">&#x27;/re/ &#x27;</span> log.txt    <span class="comment"># 输出包含 &quot;re&quot; 的行</span></span><br><span class="line">---------------------------------- -----------</span><br><span class="line">3 Are you like awk</span><br><span class="line">10 There are orange,apple,mongo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;IGNORECASE=1&#125; /this/&#x27;</span> log.txt <span class="comment">#忽略大小写</span></span><br><span class="line">---------------------------------------------</span><br><span class="line">2 this is a <span class="built_in">test</span></span><br><span class="line">This<span class="string">&#x27;s a test</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ awk &#x27;</span><span class="variable">$2</span> ~ /th/ &#123;<span class="built_in">print</span> <span class="variable">$2</span>,<span class="variable">$4</span>&#125;<span class="string">&#x27; log.txt  # 输出第二列包含 &quot;th&quot;，并打印第二列与第四列  ~代表模式</span></span><br><span class="line"><span class="string">---------------------------------------------</span></span><br><span class="line"><span class="string">this a</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ awk &#x27;</span><span class="variable">$2</span> !~ /th/ &#123;<span class="built_in">print</span> <span class="variable">$2</span>,<span class="variable">$4</span>&#125;<span class="string">&#x27; log.txt      #模式取反</span></span><br><span class="line"><span class="string">---------------------------------------------</span></span><br><span class="line"><span class="string">Are like</span></span><br><span class="line"><span class="string">a</span></span><br><span class="line"><span class="string">There orange,apple,mongo</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ awk &#x27;</span>!/th/ &#123;<span class="built_in">print</span> <span class="variable">$2</span>,<span class="variable">$4</span>&#125;<span class="string">&#x27; log.txt   #模式取反（和上面一个是一样的效果）</span></span><br><span class="line"><span class="string">---------------------------------------------</span></span><br><span class="line"><span class="string">Are like</span></span><br><span class="line"><span class="string">a</span></span><br><span class="line"><span class="string">There orange,apple,mongo</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -l *.txt | awk <span class="string">&#x27;&#123;sum+=$5&#125; END &#123;print sum&#125;&#x27;</span>  <span class="comment">#计算文件大小</span></span><br><span class="line">--------------------------------------------------</span><br><span class="line">666581</span><br><span class="line"></span><br><span class="line">$ awk <span class="string">&#x27;length&gt;80&#x27;</span> log.txt <span class="comment">#从文件中找出长度大于 80 的行</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">seq</span> 9 | sed <span class="string">&#x27;H;g&#x27;</span> | awk -v RS=<span class="string">&#x27;&#x27;</span> <span class="string">&#x27;&#123;for(i=1;i&lt;=NF;i++)printf(&quot;%dx%d=%d%s&quot;, i, NR, i*NR, i==NR?&quot;\n&quot;:&quot;\t&quot;)&#125;&#x27;</span> <span class="comment">#打印九九乘法表</span></span><br></pre></td></tr></table></figure>

<h2 id="5-awk-循环和数组"><a href="#5-awk-循环和数组" class="headerlink" title="5.awk 循环和数组"></a>5.awk 循环和数组</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;for(c=2;c&lt;=NF;c++) print $c&#125;&#x27;</span> 1.txt</span><br><span class="line">awk <span class="string">&#x27;&#123;sum=0;for(c=2;c&lt;NF;c++)  sum+=$c; print sum/(NF-1)&#125;&#x27;</span> 1.txt <span class="comment">#求每行的平均值</span></span><br><span class="line">awk <span class="string">&#x27;&#123;sum=0;for(c=2;c&lt;NF;c++)  sum+=$c;average[$1]=sum/(NF-1)&#125; END&#123;for(user in average) print user,average[user]&#125;&#x27;</span> 1.txt  <span class="comment">#用数组的方式求每行的平均数</span></span><br><span class="line">awk <span class="string">&#x27;&#123;sum=0;for(c=2;c&lt;NF;c++)  sum+=$c;average[$1]=sum/(NF-1)&#125; END&#123;for(user in average) sum2+=average[user];print sum2/NR&#125;&#x27;</span> 1.txt <span class="comment">#求总数的平均值</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/images/commandawk6.png"><br><img src="/images/commandawk7.png"><br><img src="/images/commandawk8.png" alt="求每行的平均数"><br><img src="/images/commandawk9.png"></p>
<blockquote>
<p>命令行参数数组<br>ARGC 命令行参数的数目<br>ARGV 包含命令行参数的数组</p>
</blockquote>
<p><img src="/images/commandawk10.png"></p>
<h1 id="Linux-sed-用法"><a href="#Linux-sed-用法" class="headerlink" title="Linux-sed 用法"></a>Linux-sed 用法</h1><h2 id="1-sed-和-vim-的区别"><a href="#1-sed-和-vim-的区别" class="headerlink" title="1.sed 和 vim 的区别"></a>1.sed 和 vim 的区别</h2><p>sed（Stream Editor）是一种非交互式的行编辑器<br>vim 是交互式的文本编辑器</p>
<ul>
<li>sed 是以换行符以分隔单位，对文本进行逐行的处理。处理时，把当前处理的行存储在临时缓冲区中，称为『模式空间』（pattern space），接着用 sed 命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。</li>
<li>文件内容并没有改变，除非你使用重定向存储输出。</li>
<li>sed 主要用来自动编辑一个或多个文件，简化对文件的反复操作，编写转换程序等。</li>
</ul>
<h2 id="2-sed-参数"><a href="#2-sed-参数" class="headerlink" title="2. sed 参数"></a>2. sed 参数</h2><h3 id="用法：sed-选项-动作-filename"><a href="#用法：sed-选项-动作-filename" class="headerlink" title="用法：sed [选项] [动作] [filename]"></a>用法：sed [选项] [动作] [filename]</h3><table>
<thead>
<tr>
<th>选项</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td>-n</td>
<td align="left">组织默认输出，一般和动作 p 一起使用打印模式空间的内容</td>
</tr>
<tr>
<td>-e</td>
<td align="left">多个操作</td>
</tr>
<tr>
<td>-i</td>
<td align="left">直接修改源文件</td>
</tr>
<tr>
<td>-r</td>
<td align="left">动作中支持扩展正则表达式</td>
</tr>
<tr>
<td>-f</td>
<td align="left">将 sed 脚本卸载一个文件中， sed -f sedscript filename 可以加载执行 sed 命令</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>动作</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td>s</td>
<td align="left">直接进行替换（搭配正则表达式），例如 1,20s&#x2F;old&#x2F;new&#x2F;g 一般是替换符合条件的字符串而不是整行</td>
</tr>
<tr>
<td>a</td>
<td align="left">append 后面接字串，在下面新增一行</td>
</tr>
<tr>
<td>i</td>
<td align="left">insert 后面接字串，在上面插入一行</td>
</tr>
<tr>
<td>d</td>
<td align="left">delete,删除行，后面不接任何参数，直接删除地址表示的行</td>
</tr>
<tr>
<td>c</td>
<td align="left">取代行后面接字串</td>
</tr>
<tr>
<td>p</td>
<td align="left">print，打印模式空间的内容，通常和选项 <code>-n </code>一起使用</td>
</tr>
<tr>
<td>w</td>
<td align="left">write，将模式空间的内容写入到文件</td>
</tr>
</tbody></table>
<h2 id="3-sed-使用"><a href="#3-sed-使用" class="headerlink" title="3.sed 使用"></a>3.sed 使用</h2><h3 id="1-替换行内部分内容"><a href="#1-替换行内部分内容" class="headerlink" title="1.替换行内部分内容"></a>1.替换行内部分内容</h3><ol>
<li><code> sed  &#39;s/old/new/【参数】 &#39;  filename</code></li>
</ol>
<blockquote>
<p>替换命令中一般用<code>/</code>作为分隔符，也可以用其他符号替代，s 后面就是分隔符，例如<code>sed -i &#39;s#11#99#&#39; 1.txt  </code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -i 选项是直接修改了源文件</span></span><br><span class="line">sed -i <span class="string">&#x27;s/af/bbbb&#x27;</span> 1.txt  <span class="comment">#每一行中只替换第1个af，该行后面的af不替换</span></span><br><span class="line">sed -i <span class="string">&#x27;s/af/bbbb/2&#x27;</span> 1.txt <span class="comment">#每一行中只替换第2个af，该行后面的af和第一个不替换</span></span><br><span class="line">sed -i <span class="string">&#x27;s/af/bbbb/g&#x27;</span> 1.txt <span class="comment"># 每一行中所有的af都将被替换成bbbb</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#替换中有普通元字符</span></span><br><span class="line">sed <span class="string">&#x27;s/^root//&#x27;</span> 1.txt <span class="comment">#匹配以root开头的那一行，并将root删掉</span></span><br><span class="line">sed <span class="string">&#x27;s/ab*/5555/&#x27;</span> 1.txt <span class="comment">#匹配一行中a开头后面的b出现0次或者多次，将其替换成5555</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#替换中有扩展元字符(+,?,管道符)，需要加上-r</span></span><br><span class="line">sed -r <span class="string">&#x27;s/ab+/5555/&#x27;</span> 1.txt <span class="comment">#匹配一行中a开头后面的b出现1次或者多次，将其替换成5555</span></span><br><span class="line">sed -r <span class="string">&#x27;s/ab？/5555/&#x27;</span> 1.txt <span class="comment">#匹配一行中a开头后面的b出现0次或者1次，将其替换成5555</span></span><br><span class="line">sed -r <span class="string">&#x27;s/a|b/5555/&#x27;</span> 1.txt <span class="comment">#匹配一行中的a或者b，将其替换成5555</span></span><br><span class="line">sed -r <span class="string">&#x27;s/(aa)|(bb)/5555/&#x27;</span> 1.txt <span class="comment">#匹配一行中的aa或者bb,要用括号括起来表示分组，将其替换成5555</span></span><br><span class="line">sed -r <span class="string">&#x27;s/(aa)|(bb)/\1\2/&#x27;</span> 1.txt <span class="comment">#分组还有个sed回调的功能，\1,\2就是再次引用aa和bb，放到被替换的位置</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/command1.png"></p>
<ol start="2">
<li>寻址匹配替换（默认是对每行进行操作，增加寻址后对匹配的行进行操作）<br><code>sed &#39;行号s/old/new/[参数]&#39;  filename</code><br><code>sed  &#39;/正则表达式/s/old/new/[参数] &#39;  filename</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1.行号</span><br><span class="line">sed <span class="string">&#x27;1s/af/bbbb/&#x27;</span> 1.txt <span class="comment">#只在第1行匹配做替换</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-n选项和标志位p,只打印替换成功的行</span></span><br><span class="line">sed -n <span class="string">&#x27;1,3s/af/bbbb/p&#x27;</span> 1.txt    <span class="comment">#第1至3行匹配做替换</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#标志位w将替换成功的行写入到a.txt中</span></span><br><span class="line">sed <span class="string">&#x27;1,$s/af/bbbb/w&#x27;</span> 1.txt /tmp/a.txt <span class="comment">#第1行到最后一行做匹配替换并将替换成功的行写入到 a.txt中</span></span><br><span class="line"></span><br><span class="line">2.正则表达式</span><br><span class="line">sed <span class="string">&#x27;/root/s/af/bbbb/&#x27;</span> 1.txt <span class="comment">#匹配有root的一行将改行的af替换成bbbb</span></span><br><span class="line">sed <span class="string">&#x27;/^bin/s/af/bbbb/&#x27;</span> 1.txt <span class="comment">#匹配以bin开头的那行，将该行的af替换成bbbb</span></span><br><span class="line">sed <span class="string">&#x27;/^bin/,$s/af/bbbb&#x27;</span> 1.txt <span class="comment">#匹配以bin开头到最后一行的，每一行第一个替换成bbbb</span></span><br><span class="line"></span><br><span class="line">3.寻址可以匹配多条命令</span><br><span class="line">sed <span class="string">&#x27;/bin/&#123;s/a/b/;s/1/2/;=&#125;&#x27;</span> 1.txt <span class="comment">#匹配有bin的行，将该行中a替换成b,1替换成2</span></span><br><span class="line"><span class="comment">#打印行号命令=</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/command2.png"><br><img src="/images/command3.png"></p>
<h3 id="2-删除"><a href="#2-删除" class="headerlink" title="2.删除"></a>2.删除</h3><blockquote>
<p>删除模式空间内容，改变脚本的控制流，读取新的输入行<br>意味着 d 后面的脚本不会被执行</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed <span class="string">&#x27;[寻址]/d&#x27;</span> filename</span><br><span class="line">sed <span class="string">&#x27;/ab/d&#x27;</span> 1.txt  <span class="comment"># 删除的是有ab一整行，并不是删除ab两个字符</span></span><br><span class="line">sed <span class="string">&#x27;/ab/d;s/a/n/&#x27;</span> 1.txt</span><br><span class="line"><span class="comment">#删除有ab的一行后，后面的将改行的a替换成n这条命令是不会被执行的，</span></span><br><span class="line"><span class="comment">#因为d删除过后就读取了新的输入行，改变了脚本的控制流，后面的命令不会被执行</span></span><br></pre></td></tr></table></figure>

<h3 id="3-插入和改写"><a href="#3-插入和改写" class="headerlink" title="3.插入和改写"></a>3.插入和改写</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed <span class="string">&#x27;/ab/i hello&#x27;</span> 1.txt  <span class="comment">#在匹配ab的行的上一行插入hello</span></span><br><span class="line">sed <span class="string">&#x27;/ab/a hello&#x27;</span> 1.txt  <span class="comment">#在匹配ab的行的下一行插入hello</span></span><br><span class="line">sed <span class="string">&#x27;/ab/c hello&#x27;</span> 1.txt  <span class="comment">#将匹配的ab那一行改写成hello</span></span><br></pre></td></tr></table></figure>

<h3 id="4-读文件，写文件，打印退出"><a href="#4-读文件，写文件，打印退出" class="headerlink" title="4.读文件，写文件，打印退出"></a>4.读文件，写文件，打印退出</h3><blockquote>
<p>读文件命令 r<br>写文件命令 w<br>下一行命令 n<br>打印行号&#x3D;<br>打印命令 p<br>退出命令 q</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed <span class="string">&#x27;/ab/r afile&#x27;</span> 1.txt  <span class="comment">#如果想要改写的字符串很长，可以写在afile里面，用r将匹配ab的那一行用afile的内容改写</span></span><br><span class="line">sed <span class="string">&#x27;/ab/r afile&#x27;</span> 1.txt &gt; /tmp/2.txt  <span class="comment">#读取afile的内容来改写1.txt中匹配的ab的那一行，并将结果追加到2.txt中</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 打印文件中1-10行，用p和q，谁的效率更高？？</span></span><br><span class="line">$ <span class="built_in">seq</span> 1 1000000 &gt; lines.txt     <span class="comment">#seq指令创建1-1000000并递增</span></span><br><span class="line">$ <span class="built_in">wc</span> -l lines.txt      <span class="comment">#wc看文件行数</span></span><br><span class="line">1000000 lines.txt</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">time</span> sed -n <span class="string">&#x27;1,10p&#x27;</span> lines.txt    <span class="comment">#time查看运行时间  p打印1-10行，后面的还是会读入缓存区</span></span><br><span class="line">real	0m0.044s</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">time</span> sed <span class="string">&#x27;10q&#x27;</span> lines.txt       <span class="comment">#time查看运行时间   q是到第10行就退出，后面就不会再读取了</span></span><br><span class="line">real	0m0.004s</span><br></pre></td></tr></table></figure>

<h2 id="4-sed-多行模式空间"><a href="#4-sed-多行模式空间" class="headerlink" title="4.sed 多行模式空间"></a>4.sed 多行模式空间</h2><blockquote>
<p>为什么要有多行模式？<br>配置文件一般为单行出现，但是也有使用 XML 或者 JSON 格式的配置文件，为多行出现，例如 key 和 value，key 在一行，value 在另外一行。</p>
</blockquote>
<table>
<thead>
<tr>
<th>多行模式</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td>N</td>
<td align="left">追加下一行到模式空间,同时将两行看做一行，但是两行之间依然含有\n 换行符，如果命令未执行成功,则放弃之后任何命令</td>
</tr>
<tr>
<td>P</td>
<td align="left">打印模式空间中的第一个字符到第一个换行符</td>
</tr>
<tr>
<td>D</td>
<td align="left">删除当前模式空间开端至\n 的内容，放弃之后的命令，但是对剩余模式空间重新执行 sed。</td>
</tr>
<tr>
<td>n</td>
<td align="left">提前读取下一行 ，覆盖模型空间前一行，如果命令未执行成功，则放弃之后的任何命令</td>
</tr>
<tr>
<td>p</td>
<td align="left">打印当前模式空间内容，追加到默认输出之后</td>
</tr>
<tr>
<td>d</td>
<td align="left">删除当前模式空间内容，并放弃之后的命令，并对新读取的内容，从头执行 sed。</td>
</tr>
<tr>
<td>y</td>
<td align="left">字符转换：y&#x2F;abcde&#x2F;ABCDE&#x2F; ：将字符转换成大写</td>
</tr>
</tbody></table>
<p><img src="/images/command4.png"><br><img src="/images/command5.png"></p>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><ol>
<li>从文件中读取偶数行 <code>sed -n &#39;n;p&#39; 1.txt</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> 1.txt</span><br><span class="line">111</span><br><span class="line">222</span><br><span class="line">333</span><br><span class="line">444</span><br><span class="line">555</span><br><span class="line"></span><br><span class="line">$ sed -n <span class="string">&#x27;n;p&#x27;</span> 1.txt</span><br><span class="line">222</span><br><span class="line">444</span><br><span class="line"><span class="comment">#读取第一行111，执行n命令提前读取下一行就是222，此时模式空间的值为222，再执行p，打印模式空间的222</span></span><br><span class="line"><span class="comment">#之后读取333，执行n命令，此时模式空间为444，p打印444</span></span><br><span class="line"><span class="comment">#之后读取555，执行n命令，没有下一行了，n命令未执行成功，后面的p命令就放弃执行了。</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>从文件中读取奇数行 <code>sed -n &#39;$!N;P&#39; 1.txt</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sed -n <span class="string">&#x27;$!N;P&#x27;</span> 1.txt   <span class="comment">#大写的P哦</span></span><br><span class="line">111</span><br><span class="line">333</span><br><span class="line">555</span><br><span class="line"><span class="comment">#先读取111，$!(不是最后一行)条件满足，执行N命令此时模式空间值为111\n222，执行P命令，打印第一行到\n，结果为111</span></span><br><span class="line"><span class="comment">#再读取333，$!条件满足，执行N为333\n444，执行P，打印333</span></span><br><span class="line"><span class="comment">#再读取555为最后一行，$!条件不满足，跳过N命令，执行P，打印555</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">用d也可以实现读取奇数行</span><br><span class="line">$ sed <span class="string">&#x27;n;d&#x27;</span> 1.txt</span><br><span class="line">111</span><br><span class="line">333</span><br><span class="line">555</span><br><span class="line"><span class="comment">#先读取111，执行n，模式空间为222，执行d，删除此时模式空间的222</span></span><br><span class="line"><span class="comment">#再读取333，执行n，此时模式空间值为444，执行d，删除444</span></span><br><span class="line"><span class="comment">#再读取555，执行n命令，没有下一行了，n命令未执行成功，后面的d命令不执行</span></span><br><span class="line"><span class="comment">#因为没有-n参数，所以输入111\n333\n555</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>从文件中读取最后一行 <code>sed &#39;N;D&#39; 1.txt</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;N;D&#x27;</span> 1.txt</span><br><span class="line">666</span><br><span class="line"><span class="comment">#N将下一行追加到模式空间中</span></span><br><span class="line"><span class="comment">#执行N，此时模式空间为111\n222，执行D得222，</span></span><br><span class="line"><span class="comment">#执行N，此时模式空间为222\n333，执行D得333，</span></span><br><span class="line"><span class="comment">#执行N，此时模式空间为333\n444，执行D得444，</span></span><br><span class="line"><span class="comment">#执行N，此时模式空间为444\n555，执行D得555，</span></span><br><span class="line"><span class="comment">#再执行N，没下一行追加了执行失败，后面D不执行，无-n选项，最后结果就是555</span></span><br></pre></td></tr></table></figure>

<h2 id="5-sed-保持空间"><a href="#5-sed-保持空间" class="headerlink" title="5.sed 保持空间"></a>5.sed 保持空间</h2><blockquote>
<p>保持空间也是多行的一种操作方式<br>将内容暂存在保持空间，便于多行处理</p>
<table>
<thead>
<tr>
<th>保持空间</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td>h</td>
<td align="left">将当前模式空间中内容覆盖至保持空间，原来模式空间的内容被清空</td>
</tr>
<tr>
<td>H</td>
<td align="left">将当前模式空间中的内容追加至保持空间</td>
</tr>
<tr>
<td>g</td>
<td align="left">将当前保持空间中内容覆盖至模式空间，原来模式空间的内容被清空</td>
</tr>
<tr>
<td>G</td>
<td align="left">将当前保持空间中的内容追加至模式空间</td>
</tr>
<tr>
<td>x</td>
<td align="left">换模式空间和保持空间内容</td>
</tr>
</tbody></table>
</blockquote>
<ol>
<li>实现行数反转</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">head</span> -6 /etc/passwd | <span class="built_in">cat</span> -n | <span class="built_in">tac</span></span><br><span class="line"><span class="built_in">cat</span> -n /etc/passwd | head-6 |sed -n <span class="string">&#x27;1h;1!G;$!x;$p&#x27;</span></span><br><span class="line"><span class="built_in">cat</span> -n /etc/passwd | head-6 |sed -n <span class="string">&#x27;1!G;h;$p&#x27;</span></span><br><span class="line"><span class="built_in">cat</span> -n /etc/passwd | head-6 |sed <span class="string">&#x27;1!G;h;$!d&#x27;</span></span><br><span class="line"><span class="comment"># 1!G：第1行不执行“G”命令，从第2行开始执行</span></span><br><span class="line"><span class="comment"># $!d：最后一行不删除（保留最后1行）</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>行列转化</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> 1.txt</span><br><span class="line">111</span><br><span class="line">222</span><br><span class="line">333</span><br><span class="line">444</span><br><span class="line">555</span><br><span class="line">666</span><br><span class="line">$ sed -ne <span class="string">&#x27;H;$&#123;x;s/\n/ /g;p&#125;&#x27;</span> 1.txt</span><br><span class="line"> 111 222 333 444 555 666</span><br></pre></td></tr></table></figure>

<h1 id="git-常用操作"><a href="#git-常用操作" class="headerlink" title="git 常用操作"></a>git 常用操作</h1><h2 id="1-配置-ssh"><a href="#1-配置-ssh" class="headerlink" title="1.配置 ssh"></a>1.配置 ssh</h2><h3 id="1-1-本地上生成公钥私钥"><a href="#1-1-本地上生成公钥私钥" class="headerlink" title="1.1 本地上生成公钥私钥"></a>1.1 本地上生成公钥私钥</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t ed25519 -C <span class="string">&quot;email&quot;</span> -f ~/.ssh/filename</span><br><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">&quot;email&quot;</span> -f ~/.ssh/filename</span><br><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">&quot;email&quot;</span></span><br><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">&quot;email&quot;</span> -f <span class="string">&quot;/C/Users/.ssh/filename&quot;</span>  <span class="comment"># 自定义密钥位置和密钥文件名</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-公钥私钥放到对应-bucket-github-上"><a href="#1-2-公钥私钥放到对应-bucket-github-上" class="headerlink" title="1.2 公钥私钥放到对应 bucket&#x2F;github 上"></a>1.2 公钥私钥放到对应 bucket&#x2F;github 上</h3><h3 id="1-3-配置-config-文件"><a href="#1-3-配置-config-文件" class="headerlink" title="1.3 配置 config 文件"></a>1.3 配置 config 文件</h3><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">#公司电脑host可以任意取名，但是拉取时要更改为git@name1Bitbucket.org，IdentityFile为私钥路径</span></span><br><span class="line">Host bitbucket</span><br><span class="line">HostName bitbucket.org</span><br><span class="line">IdentityFile C:/Users/.ssh/filename</span><br><span class="line">User email</span><br><span class="line"><span class="comment">#公司电脑</span></span><br><span class="line">Host github</span><br><span class="line">HostName github.com</span><br><span class="line">IdentityFile C:/Users/.ssh/id_rsa_custom</span><br><span class="line">User email</span><br></pre></td></tr></table></figure>

<h3 id="1-4-将私钥添加到本地-ssh-代理中"><a href="#1-4-将私钥添加到本地-ssh-代理中" class="headerlink" title="1.4 将私钥添加到本地 ssh 代理中"></a>1.4 将私钥添加到本地 ssh 代理中</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-add id_ed25519_bucket_name1</span><br><span class="line">ssh-add id_rsa_github_name2</span><br><span class="line">ssh-add C:\Users\.ssh\id_ed25519_bucket_name1</span><br><span class="line">ssh-add C:\Users\.ssh\id_rsa</span><br><span class="line"><span class="comment">#若提示Could not open a connection to your authentication agent.意味着SSH代理没有正确运行</span></span><br><span class="line"><span class="comment">#a. 运行以下命令来检查SSH代理正在运行，这会启动 SSH 代理并输出相应的环境变量：</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">&quot;<span class="subst">$(ssh-agent -s)</span>&quot;</span></span><br><span class="line"><span class="comment">#b. 如果 SSH 代理已经在运行，但仍然出现问题，可能是因为 SSH_AUTH_SOCK 环境变量没有设置正确。你可以手动设置该变量：</span></span><br><span class="line"><span class="built_in">export</span> SSH_AUTH_SOCK=$(find /tmp/ -maxdepth 2 -<span class="built_in">type</span> s -path <span class="string">&quot;/ssh-&quot;</span> -name <span class="string">&quot;agent*&quot;</span> 2&gt;/dev/null | <span class="built_in">head</span> -n 1)</span><br><span class="line"><span class="comment">#c. 如果上述步骤都没有解决问题，尝试重新启动 SSH 代理：</span></span><br><span class="line">ssh-agent -k</span><br><span class="line"><span class="built_in">eval</span> <span class="string">&quot;<span class="subst">$(ssh-agent -s)</span>&quot;</span></span><br><span class="line"><span class="comment">#最后再次尝试运行ssh-add 命令，应该可以成功添加私钥到 SSH 代理中。</span></span><br><span class="line"><span class="comment">#为了检验本地是否添加成功，可以使用ssh-add -l命令进行查看</span></span><br><span class="line">  <span class="comment">#d. 测试连通性，如果host任务取名得使用 ssh -T git@host</span></span><br><span class="line">ssh -T git@bitbucket</span><br><span class="line"><span class="built_in">eval</span> <span class="string">&quot;<span class="subst">$(ssh-agent -s)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-5-配置全局-本地-name-email"><a href="#1-5-配置全局-本地-name-email" class="headerlink" title="1.5 配置全局&#x2F;本地 name&#x2F;email"></a>1.5 配置全局&#x2F;本地 name&#x2F;email</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#全局</span></span><br><span class="line">git config --global user.name <span class="string">&quot;name1&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#本地</span></span><br><span class="line">git config --<span class="built_in">local</span> user.name <span class="string">&quot;name2&quot;</span></span><br><span class="line">git config --<span class="built_in">local</span> user.email <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#清理全局</span></span><br><span class="line">git config --global --unset-all user.name</span><br><span class="line">git config --global --unset-all user.email</span><br></pre></td></tr></table></figure>

<h3 id="1-6-通过配置文件配置指定目录使用-local-配置"><a href="#1-6-通过配置文件配置指定目录使用-local-配置" class="headerlink" title="1.6 通过配置文件配置指定目录使用 local 配置"></a>1.6 通过配置文件配置指定目录使用 local 配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --show-origin --get user.name</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.找到C:\Users\.gitconfig文件添加</span></span><br><span class="line">  <span class="comment">#配置name1目录</span></span><br><span class="line">  [includeIf <span class="string">&quot;gitdir:D:/name1/&quot;</span>]</span><br><span class="line">  path = D:/name1/.gitconfig</span><br><span class="line">  <span class="comment">#配置name2目录</span></span><br><span class="line">  [includeIf <span class="string">&quot;gitdir:D:/name2/&quot;</span>]</span><br><span class="line">  path = D:/name2/.gitconfig</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.找到D:/name1/.gitconfig内容</span></span><br><span class="line">  [user]</span><br><span class="line">  name = name1</span><br><span class="line">  email = email</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-7-拉取代码的时候得用配置的-host"><a href="#1-7-拉取代码的时候得用配置的-host" class="headerlink" title="1.7 拉取代码的时候得用配置的 host"></a>1.7 拉取代码的时候得用配置的 host</h3><p><code>git clone [git@bitbucket.org](mailto:git@bitbucket.org):name1/reponame.git</code> &#x2F;&#x2F;原仓库地址<br><code>git clone [git@name1Bitbucket.org](mailto:git@name1Bitbucket.org):name1/reponame.git</code>  &#x2F;&#x2F; 使用时用别名</p>
<h2 id="2-git-操作"><a href="#2-git-操作" class="headerlink" title="2. git 操作"></a>2. git 操作</h2><h3 id="2-1-合并最近两次-commit"><a href="#2-1-合并最近两次-commit" class="headerlink" title="2.1 合并最近两次 commit"></a>2.1 合并最近两次 commit</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git rebase -i HEAD~2</span><br><span class="line">pick</span><br><span class="line">s</span><br><span class="line">f   跳过 commit 修改</span><br><span class="line">git push origin -f 强制推送</span><br><span class="line">只修改 commit 的内容 改成 reword</span><br></pre></td></tr></table></figure>

<h3 id="2-2-版本打上-tag"><a href="#2-2-版本打上-tag" class="headerlink" title="2.2 版本打上 tag"></a>2.2 版本打上 tag</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git tag project-0.8.0 f3bef68</span><br><span class="line">git push origin project-0.8.0</span><br><span class="line">git tag | grep <span class="string">&quot;0.8&quot;</span>   查看已存在的 tag</span><br><span class="line">git tag -d 0.8.0     删除 tag</span><br><span class="line">git push origin :refs/tags/0.8.0   并删除远程仓库一推送的 tag</span><br></pre></td></tr></table></figure>

<h3 id="2-3-服务器上更新最新代码"><a href="#2-3-服务器上更新最新代码" class="headerlink" title="2.3 服务器上更新最新代码"></a>2.3 服务器上更新最新代码</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git remote update</span><br><span class="line">git pull</span><br><span class="line">丢弃服务器上的的所有更改,这将重置仓库到最后一次的提交状态，并且删除所有未跟踪的文件和目录。</span><br><span class="line">git reset --hard</span><br><span class="line">git clean -fdx</span><br><span class="line">git pull origin main</span><br><span class="line">频繁需要这样的操作，您可以编写一个简单的 Git 别名或脚本来自动化这个过程。例如，您可以在 Git 配置中添加一个别名：</span><br><span class="line">git config --global alias.pull-reset <span class="string">&#x27;!git reset --hard HEAD &amp;&amp; git pull&#x27;</span></span><br><span class="line">之后，您可以通过 git pull-reset 命令来执行上述步骤。这个别名会先重置本地更改，然后拉取远程分支的最新内容。</span><br></pre></td></tr></table></figure>

<h3 id="2-4-解决冲突"><a href="#2-4-解决冲突" class="headerlink" title="2.4 解决冲突"></a>2.4 解决冲突</h3><p>1.保存本地修改：如果你希望保留这些本地修改的话，可以先将这些文件备份到其他目录中，然后再进行拉取操作。你可以使用如下命令将这些文件移动到其他目录：<br>mv Dockerfile &#x2F;path&#x2F;to&#x2F;backup&#x2F;location<br>mv docker-compose.yml &#x2F;path&#x2F;to&#x2F;backup&#x2F;location<br>2.丢弃本地修改：如果你不关心本地所做的修改，你可以直接丢弃它们。运行以下命令来清理未跟踪的文件并拉取最新代码：<br>git clean -f<br>git reset –hard HEAD<br>git pull</p>
<h3 id="2-5-替换远程仓库-url"><a href="#2-5-替换远程仓库-url" class="headerlink" title="2.5 替换远程仓库 url"></a>2.5 替换远程仓库 url</h3><p>git remote set-url origin new_url.git<br>git remote -v</p>
<h3 id="2-6-将-public-仓库提交自己-private-仓库并接收-public-仓库更新"><a href="#2-6-将-public-仓库提交自己-private-仓库并接收-public-仓库更新" class="headerlink" title="2.6 将 public 仓库提交自己 private 仓库并接收 public 仓库更新"></a>2.6 将 public 仓库提交自己 private 仓库并接收 public 仓库更新</h3><ol>
<li>本地拉取 public 仓库，改名为 my-full-stack<br>git clone <a href="https://github.com/tiangolo/full-stack-fastapi-template.git">https://github.com/tiangolo/full-stack-fastapi-template.git</a> my-full-stack</li>
<li>设置 private 仓库为新存储库<br>git remote set-url origin <a href="mailto:git@github.com">git@github.com</a>:MyName&#x2F;my-full-stack.git</li>
<li>查看是否关联 git remote -v</li>
<li>将此存储库添加为另一个“远程”，以便稍后获取更新：<br>git remote add upstream <a href="https://github.com/tiangolo/full-stack-fastapi-template.git">https://github.com/tiangolo/full-stack-fastapi-template.git</a></li>
<li>将代码推送到新 private 存储库：<br>git push -u origin master</li>
<li>一些搞好之后，在私有的 my-full-stack 上进行开发更改了模版之后，还希望从原始模板 public 仓库中获取更新，在不合并的情况下拉取最新更改：<br>git pull –no-commit upstream master<br>这将从此模板下载最新的更改而不提交它们，这样您就可以在提交之前检查一切是否正确<br>如果存在冲突，请在编辑器中解决。完成后，提交更改<br>git merge –continue</li>
<li>本地仓库提交到远程仓库<br>git add.<br>git commit -m “commit message”<br>git remote add origin <a href="mailto:git@github.com">git@github.com</a>:MyName&#x2F;repo.git<br>git push -u origin main</li>
</ol>
<h3 id="2-7-分支管理"><a href="#2-7-分支管理" class="headerlink" title="2.7 分支管理"></a>2.7 分支管理</h3><p><code>git branch -a</code> 查看远程分支<br><code>git branch</code> 查看本地分支<br><code>git checkout 分支名</code> 切换分支名<br><code>git checkout -b 分支名</code> 创建并切换到分支<br><code>git branch -d 分支名</code> 删除分支名<br><code>git branch -D 分支名</code> 强行删除分支名<br><code>git merge 分支名</code> 合并某分支到当前分支</p>
<p><img src="/images/gitmerge.png"></p>
<h2 id="3-commit-规范"><a href="#3-commit-规范" class="headerlink" title="3. commit 规范"></a>3. commit 规范</h2><p><img src="/images/gitcommit.png"></p>
]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Shell</tag>
        <tag>Redis</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>接口攻击</title>
    <url>/post/attack.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉，您输入的密码错误，请检查后重新输入。" data-whm="抱歉, 当前文章不能被校验, 不过您还是可以看看解密后的内容。">
  <script id="hbeData" type="hbeData" data-hmacdigest="8be329738d606ed298838e89c3ced67f2bcc99e1c990578af0f67fc951c7e2fa">dcc4350ee32b97b121eee5e44c759b1256788a5c4e4ba0bca6150f2c0741224f3692d7be738420eaa7aa528b6980e9fc0a6670c1743613c862de80cc0c5c58f6b9b6e029ea81a803cef9f9c953876ddb75c97312b640244dfb62d135a170e7dd19cb906e94f42ef1883fbd8e3b5a113cc19e5c1a8156a913b9aa50cadcf8229b95499eca663d37aff537c4db98d98413c3a25f76b7af0dfb09ed65ed7e8c48bae348635fe55cd7a1ee16c42a959cb23c7f14fedc042a03a499b169b425daf9abb1955ce945890c128bcdbe5d605003a1c6abccd96f42fe00fb89912c496389d77063ca5dd734413198aca70a30633f19c3149e542963e291c54c6811098e8c0b1c94d930e55497f2304840cb7db16a0a40d9f6ee34c00cd8d6fbc118736291b0972e3c928eecbc3827902328695a20c94164328182841c9c04f862d2c6e3e0606ea510ce633a4fe9a57e2560035ed0f99585f987b748b4863715df7e3267ccf02f11ef5bc37520305def10cbddcfd73c0a6861f896f206ed16881d98922466b56f24349b896159f5a1ada694ff3b6392c2e7ed715c3db4f873d3cabf8d03696aab1a22a588eca9f2f9e5b52fd3e7056458fa2fbf030d1113cb290cef90ca6bf10fb8ab3bc59622d32a5bab64be9ebd45b10c82e88d646f227e1c8ecdbc2ec537e7fa8b27e77a6800f1a0b1f300ac73ca9f2af6ddda0c557a2f1823ac2b8839faca8df85b588c30756d71977413b7020c9e7a9df8f0161f2f3c1d6fcd769f7efc121fab3a8f470faac84c4cb4c274008cad1cdf728df86962dd9e7977611edee0f7ffcb093e58e734e1b7828650a1b3c7b63d7f00321cbe3f62eec56faec4bfe78488dbd1dc08ddb7ab536e6aa8fa64058bcd35a6010753ef583da015c5e9e112a585e9976cc247299f5396f26396fb9c795fc26fab0af86e615cad5bdd98c255fc6a67fd1ec6a0094e83baf113d908fe9d6d44060f0368cf365abc2fab20f4c3141d4c82ad466f4832d5de443f5916ff09cd62e5b6c4f11b12db1d747550cf5da5e13e75ff8b0f4f425095978a03d843563bfecc09efdae6d8d041e4b43e11f171dac07d9dbac478251b729e3308850270cd1286246b3c46dd66fdfc23d2675587f184ac76cff2362588fbad96bf4ab612cef73af13268971c2420edc0b6266a1e52eb1eadbd4f7aa7f9cbd3c8c560976b221cd877701d8e408d984d8a09ad3dfb971e7977f6df8755b9c6fb219b231238cdcd43cd463b2c6010b24f37b15a93b88f160abb76865b2ca0242dcd67f003f4e7d8e7c0ec8c40de135fd3544eb2a901824afabf1ab785cff14f4a9ade01a3c83c8537e97cd734de0af7536ded66c948e252c9034676ae059d3b487b66c2aee496e91748b28cb6ea662ad86b0d0807d48f80b21b4ed8d5588fb649eda8fe343fa001c4c346e66ab41d884166acbb1f09fc2788207ae80b30669f1d11954c8e5914db51421a62d65fa1234632fbf1a609882220df1a17c2650c17df60d38fa4444525000ec230cb422054fd30b4dbb65cabfd86013f9d8fb97eb7b127993a460e5de3823ff9681137192dc386ee38e4f3af279735c66045046533e3c796b2b423f2c1bc8c34dc0786c2f6499979fc8a2c7a6cd823310bfc88c71ccd231bd86f4fef157c55f421c489a7ab57936d3ff253c161150903a8fdcb0259fc0539813757d4ac3e8baaba5540693b815d5a0c346c8457912f70bfbac3b5beb9f2f7ef8c916e8badf7aa779711abffb5047310367593d8e81257dcf4355e7295d1cddb926052eed0804a409fbb3e13d4356fa35651985ec463d3688ff8c7798434bef418c77c91222ba19279ce7c9a4b61f6cd5d44b72a04bef46f6299839554bf23104b9941d6a59f8bef1c2c20c440ef91a6d30797a1fbc46d2345384e3e5fcba4136a212a30106d3f8cbccbc841cdf3bcd1510dac807e76da2530a6f18c7f0b37fad4536da3a90cb6b48299b9d0d022e92cdb935adba246ee623efb9642b2712293cbfcf9590b37c8eabe66655ab589e74ca8b6044bc726f1ab875147695d8423965b7651b30598e6f66abc5b293cdb38beed0f663111268346f890dbb6709820d9ec70a31dc30d9f3fd82a6ec13d5684ea61aa8cb597516c48edae97e96ddd5c2298c576995c27fe62a335847333e82a7e7d3e141f1d20b7fe1238c303f0205b8e6f29eb4b27bf75ad4eb749cb3cf627ee42ec1e341a96133ad58242db02520df69167b78cd8cf46524d6cca60de15bacb7a287ccba7569ce3323a5bbf6b9f4ce3a6a3d555fa9b1f18a4c065d4b5afcbf0b7abd1b40fa5d8e1b17939dd81679358028730ba3dfa0cf08f2aab64cbfbde794dc358beee596580c4e06e74c64b9941a3d1b407c02b268dc88e8ab68c17461caae68858ca2108c710039dad52c92e07072216245660f383130f6181588b95f09ec732f49c0cb1350cd26bd8d588bbbb4eafda338e794f6bc5cb65777da6ae668bcb4fc992470bf603745460f172d97fa2d1b3ca4105c3dcd5cdccb1cf1f0e84cf192e187268e3e1a902df8578832547e39dced10f773776eb1f682969e6df1d96fda9fb29205840a48e25be91ad6dc9fe092231776ea3a7f5eba200f228d9ad82271e447286c1ed0f4f6a8e3c6b67bd87b09ea54786df64d21cbd9fa3a5bb331257b42a771cc32dc9ede0db88ea17750b6595c96e34fcba606bfc94e1e1d96da4cd6daadcfeb2066b2aeb8fbc1d6b416f6c9707c93ce1555e97ed1ad3fbc0fbcd23b057dc4423de58f80bb4e814bab208704f0980ef8b764b836c7a99b42d59263f3cc1412f08c334d8e82e678ef8bbf0edb69c88a18d4b40db05c1371012a5a8f5f3b388591d4e9acf9854951aa1c93a75a2756631642ee922f1b64ee243c42ddd81b8e96c63b4a252c0be3a78d52fd4f59b9eb01e37851e4e3a1cb4462e805f8e674c1e01bdcf76f4a75aed2a211dede11a5acf09bb914649968c28a8a39384e64c749463a9487346388dab83092623b110f66013bf32cd34000e1c17ef2c8d8f777507c23b862d38bf7d7166eb18e3a3a6aab12205750a27f9a4d9d0cd0050174b288e7b7eadf59bebb689156a5ced5e6e06a0c0b3811481ff09cb58373d82f15993e23b3eabf0df6e2d395277534223dcb759f19396a32af24485995ff2c675b3720cc018ef95dbb47271022746d9f483cb22abf7bb56cdf3f106fe616500b3dedac3b69967027ff23b57d4cc7e7086164b446979dd6effda55a8afbb704e8b06a6b062ac40832777014ae4e3056c9479ec0a08e346f5d3be703fdde3c7698d7907099ed5d771b261c1d680305e99732b798040afef74adf311c2a8862ab3d0cbf693d852114aa6a6955b95a5462d9af86f2f92aa5db7c062860ad82729dc24eee7bbf4a20eb188c9d441eecd6056515470105ad935bc9eb45fee096d8f15ecb36c379e99a67fa9bb0e60579ecdc0f272295c633a00aedd7c5f56a6c3bc42bb8d7c2a6a745204a414a77cfa27459ec95952ed3c1413a89e5dbd39421c1f9b1674b89782699c30ab015bb268a0ea5d1fa7a399fb19688382ea1c0e553149ec6f7ed69d5204f382afb8b9ae18f2f1ee1a5d3e91c59a02daac756f35e83130913bd4069bce89583650eb6d0143aa40dbaff699260570721a6fa202a02818cc060f809b7cad571c76bd077e06ce305d6e35069899bb4fbedbac964e792a5e68521616cff646624cfb249f94f3448ba3462adaf16dce7d94dc860725c217fa5b36010cbae1560a4116827bc19ede96b441646f3c5ffe429f4abbeab5d9abbabc624a61112c59bdf60cdf1172ee1eae9232644737a1b17b6354ed030809dd685d1bb36a9fbd0ccf5857e932a8819b9a27274ec2e3875bb14ab20e86d64c6b7bf524310e9bbe89f0a168d5bab2fdd35170bf62b79d430f8b0efce29c7eae2bc1d202909a3c83af26fd9f20e7a2dca9e39c52d98c472ea0c5a42a2bf13c2e20033dabc697a6dfcb5d849f6415a3b3e3047855f90ef68005ccc3ddb715d8e45a76d02828f181ddcb8ab6ed6dcd35b14cdbee0ee535d9a8437b4e6bfedfb35fb121fa1bf16f71f7cc7c00de98de17f78dc7748cee468d7ff767fbc80cb46695853367b8ef3df71fa0f0f899c45302dc40e9c4e5757f17e498f45d9912c506fbb0d47371933e45b07b8ec161ab024830ffc04dbf73cce10f5bad2a82e185ec0aa11bf5d3496b91700d7f8d98869f3d97586562dcce3beb16a77b8996f6f9f50ec2a74c7d24d3764c10923f98c0a9c51e3ee0c8c65c8553c64bc9e31fbd94b54095a5ada4d32fa7a1fe43c0a11c2dad5b76c81595c2d02c88dfb1231e8bc60bc6c4651538922dbb2a88ed31b4ce50c16abe99cf0e3b2b411d261fb3b3b2023d7a610a963da10177c84e3b23da791268366d29d3edd95b108f5a1884ee3f3d4e47d39449df2baae38b5c85cfd6f772de7885750666db1a4e1871b2655bf449e5ca707ecbb0859c805615967be476ae966e49a88fa438d69290bdb2efc379cdd42cd410586665e89d8400d3a803361c03794902eb1dd380231f0ae2235e183032a4ffe76c5f948bcaaf25bb0875268fd7e7a651380032b2a0216e322ab49b8640e50c4acc81d55adb2f71635a9359e3c67caa6358f2b01549e45b59dbb2c4a30627e6b1d14b4f7eec3646ff436e4ee17f16e805b7bb9dd495901822ae42828cd0359831a19d7e206092e523c503b3dfe7f53270a5ada6b99a7b706dfa4f823b8be7695b1ef8b4840d4da45df885c7ad7f8d1225087ec7ff2df03ab7d8e13b0f8326256af51cf664446a5385b269a1a933b9acf160a9c370ba1ccb4648f9fad1c5f51e0e31cc88556054438e6bc4e87e65aa71bcda44521551aaad6005ab2f7c36602eb26875dd150b136f434727c851a046e13969cda31d20513256de446d1f08704c220acf33d5bfc397ad2a6fcc75bfb0cb66020eb72f03baee6b8f731017da63cffb89880ed310c336e0896a5feacabe069361f7e44ca813957de9473816d9a2fa1b4b5faa2003fc8f9e9878a38d4afc1c3be0f1e15c2501e6d32678f3603d395634a15769ea830161455f68073435280454c1e1b5f41cacf7d30de932ae91ad0aee783a8b311d79a5363b94489bbe5c8acbd0b5a15551cf28500c5da2cbce22de8adcf42e8ea4cd5db45b3c5e39c0d73567d620579d4e2c3616e276de2ae292ed012bc9cf142fd196afb1868fd7387818145d71133e7d37858e28006c52237ac3cc435c0037283c7e88ad91c73c7f20d10dd2e6828866c838547617ab815fd96394ba256a79ecd3902f59c75690543a62a4857f395b3f5763c3732adb6966bf5b9eda6ec7e06fba85758b9a36a47ea121f72119b6486c52a569520fe1ae52d2eb83849b1f7c79f10a6b9ebd589f023a87cd5a0c2366a619d0d9c89469d04d9f9fa41c37652bf46bba83f5a394ad6f528be4ec9bbb16c45f16c9c089c8a5c0fc9d7f761d7b22dbc72cd2d71a334315483645653e817576e278302ca318b93ed8e0683371e547f5ac43c067c345441edb41bc30afc1e0939847d04862224cb5aea40bbc73854e6800d94b2c47792ffc777ea9893db1d078e4710c881fd75fec0877a400ce7e50cae18a6612c525af3435d86ea228a23c094318e330407722e7082e874e912c7bece61a376870cac55c00f9f198ee421c125a1a04be3aa2c6c612052a6d10ca05ea86666c918dd19065d6a10f50567a07915de9a61369020e2667bcd1236d770785a30850ee1cdb887296dbb54e8d8a40b04155a6ab2286bd2d53a6f20aafd8832079cd02477f38eeada37b6497e2776bb90b2b4b4d45dcbe94c94ed3d5b496ecde810c495d611d04c72564544e1e5e91bb4c6e3a75e52999cdb9b18dd9687c58701028949678e98d10249d81540f331308484067a5938b73c07e57b1034996f173a67fff2e320687b43c6889e8fd11a846c966c9feaa0b95da98fe215f198ed1c2fc196e05b0621547339e0c520f7f2d2b52450637d040e5a5954052f1cd264631a50096c0c5342a5f4ffb94d829b05666a6378eef32e7a68362499eabefc1f0ebc7300e28fe8f83bd26144a363e6bf2731d0c18a6d6191d2dd9d42ad6675ef22dd7eef70b60c9bb37c2327f8963892410cad067a1ba1628fa1d6482b42d9d79af54ecb3d8acddc20ce67ce3c562027c0ef2d55351d504cb940b876ddf4cab9b77a84e2c586d1c9b5776b360e5dfff8c2ed818316e35cdcfdba18721813ae51ca7e2015fe9a2eb881477ec7ff0e332e6c2146fc8c1dca269cc307e02bcd6a58f3b1445053c358bffa7c7771b2a943c74384b88dae43569469475d39d4729b8b951408fa26eab5899873ab3189d27a61e5eec16c5d7f8729cd11dd383f1ff03f2b164cd2d9257bb743c6a586c2ad630536e7324ec8648aab0cd2c0d99c8b3bb1323a8a4a396194156bc5885afb75d95079963b41ce7c566b2c0e5302b30706fa67ae7b81718e8bc104f8247691df10b67ac90bcc7e021f1d6fe8cb874a3040571b93a2abcae9d81e36fd12bd08f91fdcf1ab863f3328be1981be74840e96a65eb7104f66c45480bada7fa48e467f1f9bfaf114a189f1626a91212474788051e660952b00efe7d5af4c0d5d04eeb32b4a6595f9432478201d5617512370124ef25346dd54332760f7fefb1743ff3d60b4a728e77dae399c1bc934dc31d0a763a69e0b302f165e98f3fa83de5005f1220e88195bdc738f7d8a2c6d1d49f33f5627d75a2233f7624ea1640e41ed8e4a34c6a73e4d14613dbba5c314b77b1e4e9de363376d85e1b8d972afeba215dcd445be01a7e48c9839a5b07559fa12c116a0c7dd0583ea346320635b1f7db7c37b3253f1b5ac6447c268a11a3c498b0767a40f4634dcfb9971be2ebfc59abdc8204e26bfa7b586b45b5de8769fd26eeaa4244c304277f4e8bcab3715a59a976749bae9776fde9f69681dad9d895742924d93eb2dca8572d046972c4136b688a8ffbb10be445f6c7fca753e3be8953e69cb1412e46237ffb64f2b7467c830f0ae018ffe9857b4f88ea72b73f513ca55e0cd1a2c06e941ad798e1d260b327f1d74a2467d84ce7f89634760e5246f085d4d2299c2ad6f69081592de0c1f0fbc6c0371270f84efb3209532029222c7f6896de62f7dd742800c44e161113b9ee869b546eabae36d7a9c1cccbd56fca71f96c6781a2e3177431b0b79d795ac2bdd8d32b9757418bdc7d82a2e33906975e8496d5d0032e3267629932e78113f52ed5ce5ca05837debc6686fa11e5477028ff9185226894c92bb73bece3a5878ddd810720376c6c57e14474e8a3881dc8e30eed34e9f086a0a60e67aa899cef894728e02831141ae49dd34672a31072ec38ba2deaac5f1c87da3e63e61d31c4da6c9625e1981c2031878405e4ba4f7de9e2f9bfac17537e69f3c93366f02a66acc3e4ad8d5ca74ae4e9a4d11917440f01ee92a918ecac2c65068c0cfdb7ca8f59f09032c270248b1b87d9caaf021d3603932b1dd962e4fca1d9f500f9779200c140e6606613e875398a32b99312cfeb235f063eb8a2f5b86091bd4811d326f77ef8f934fe8fbcc943eb47c33819a7eb21b146cbabd446656c1d017c6d2aa1e177e6f1d13ea4ea4043a5698f5d692b09bf3c3a08a97a2840aa19ff278bd2821eec6ce594bc199f7f7b97ccbeb22823afbd8f262a175bd2e576bd6b799420077fe0c9d6d4df8fe7f768a21f51c4ed2f308844dadbecada2a1b90124412ab7274969594289c45acc457e9151041ed563045bb9717b2ab0</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>安全测试</tag>
      </tags>
  </entry>
  <entry>
    <title>并发编程基础知识</title>
    <url>/post/concurrent-programming-basics-1.html</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>并发编程</category>
      </categories>
      <tags>
        <tag>并发编程</tag>
      </tags>
  </entry>
  <entry>
    <title>docker搭建Grafana监控平台02-监控Fastapi应用程序</title>
    <url>/post/grafana-1-fastapi.html</url>
    <content><![CDATA[<h1 id="1-背景"><a href="#1-背景" class="headerlink" title="1. 背景"></a>1. 背景</h1><blockquote>
<p>监控 fastapi 应用程序：grafana+prometheus+grafana+loki+promtail+fastapi</p>
</blockquote>
<ol>
<li>FastAPI<br>角色：作为应用程序服务器，处理客户端请求并返回响应。<br>功能：FastAPI 可以通过 Prometheus 的中间件（如 prometheus_fastapi_instrumentator）暴露应用程序性能指标（如请求数量、响应时间、错误率等），以供 Prometheus 抓取。</li>
<li>Prometheus<br>角色：用于收集和存储时间序列数据的监控系统。<br>功能：定期从 FastAPI 应用程序抓取性能指标（通过 HTTP 请求）。<br>使用 PromQL（Prometheus 查询语言）进行数据查询和聚合。<br>保存时间序列数据，以便后续分析。</li>
<li>Grafana<br>角色：用于可视化数据的仪表盘工具。<br>功能：从 Prometheus 中读取性能数据，并通过图表、仪表盘等形式进行展示。<br>提供可视化界面，帮助用户分析 FastAPI 应用的性能指标，识别潜在问题。</li>
<li>Loki<br>角色：用于聚合和存储日志数据的系统。<br>功能：接收来自 FastAPI 的日志信息，通常这些日志包括请求日志、错误日志等。<br>Loki 是按日志流进行索引，因此可以方便地查询和检索特定的日志信息。</li>
<li>Promtail<br>角色：Loki 的日志收集器，负责收集和转发日志数据。<br>功能：从 FastAPI 应用程序的日志文件中读取日志信息。<br>将日志数据格式化并发送到 Loki 进行存储。<br>支持标签和元数据的添加，以便在 Loki 中进行高效查询。</li>
<li>整体工作流程：<br>FastAPI 应用程序处理请求，并记录相关的性能指标和日志。<br>Prometheus 定期从 FastAPI 应用中抓取性能指标，并存储在其数据库中。<br>Promtail 从 FastAPI 的日志文件中读取日志，并将其发送到 Loki 进行存储。<br>Grafana 从 Prometheus 和 Loki 中读取数据，提供可视化的监控界面。<br>用户可以通过 Grafana 仪表盘查看 FastAPI 应用的性能指标和日志，帮助进行故障排查和性能分析。<br>这种架构能够帮助开发和运维团队实时监控 FastAPI 应用的性能，快速发现和解决问题。</li>
</ol>
<h1 id="2-fastapi-应用程序暴露指标数据给-prometheus"><a href="#2-fastapi-应用程序暴露指标数据给-prometheus" class="headerlink" title="2.fastapi 应用程序暴露指标数据给 prometheus"></a>2.fastapi 应用程序暴露指标数据给 prometheus</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> app.main <span class="keyword">import</span> app</span><br><span class="line"><span class="keyword">from</span> prometheus_fastapi_instrumentator <span class="keyword">import</span> Instrumentator</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    Instrumentator().instrument(app).expose(app, endpoint=<span class="string">&quot;/metrics&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;metrics init success!&quot;</span>)</span><br><span class="line">    uvicorn.run(<span class="string">&quot;app.main:app&quot;</span>, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<h1 id="3-grafana-上导入-fastapi-监控面板"><a href="#3-grafana-上导入-fastapi-监控面板" class="headerlink" title="3.grafana 上导入 fastapi 监控面板"></a>3.grafana 上导入 fastapi 监控面板</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;annotations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;builtIn&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;datasource&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;grafana&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;enable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hide&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;iconColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rgba(0, 211, 255, 1)&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Annotations &amp; Alerts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;limit&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;matchAny&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dashboard&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dashboard&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;editable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;fiscalYearStartMonth&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;gnetId&quot;</span><span class="punctuation">:</span> <span class="number">16110</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;graphTooltip&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;links&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;liveNow&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;panels&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fieldConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;defaults&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;thresholds&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;absolute&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">80</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;overrides&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;h&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;w&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;y&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;colorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;graphMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;justifyMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;orientation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;percentChangeColorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standard&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reduceOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;calcs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;lastNotNull&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;values&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;showPercentChange&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;textMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;wideLayout&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;pluginVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;11.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;editorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;code&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;exemplar&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sum(http_requests_total&#123;job=\&quot;qblingserver\&quot;, handler!=\&quot;/metrics\&quot;&#125;)&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;instant&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;timeFrom&quot;</span><span class="punctuation">:</span> <span class="string">&quot;24h&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;请求总数&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;transformations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;seriesToRows&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sortBy&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Time&quot;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stat&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fieldConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;defaults&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;thresholds&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;absolute&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;overrides&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;h&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;w&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;y&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;colorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;graphMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;area&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;justifyMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;orientation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;percentChangeColorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standard&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reduceOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;calcs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;p75&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/^Value$/&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;limit&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;values&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;showPercentChange&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;textMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value_and_name&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;wideLayout&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;pluginVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;11.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;editorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;code&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;exemplar&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sum(http_requests_total&#123;job=\&quot;qblingserver\&quot;, handler!=\&quot;/metrics\&quot;, handler!=\&quot;none\&quot;, handler!=\&quot;/openapi.json\&quot;&#125;) by (handler)&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;table&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;instant&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;handler&#125;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;timeFrom&quot;</span><span class="punctuation">:</span> <span class="string">&quot;24h&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;请求数量&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;transformations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sortBy&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Value&quot;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stat&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Request Per Sec 表示每秒钟系统处理的请求数量，常用于衡量系统的吞吐量或流量。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fieldConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;defaults&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;palette-classic&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;custom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;axisBorderShow&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisCenteredZero&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisColorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisLabel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisPlacement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;barAlignment&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;barWidthFactor&quot;</span><span class="punctuation">:</span> <span class="number">0.6</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;drawStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;line&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fillOpacity&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;gradientMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;hideFrom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;viz&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;insertNulls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineInterpolation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linear&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineWidth&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pointSize&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;scaleDistribution&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linear&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;showPoints&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;spanNulls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stacking&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;thresholdsStyle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;absolute&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">80</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;unit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;reqps&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;overrides&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;h&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;w&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;y&quot;</span><span class="punctuation">:</span> <span class="number">7</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;calcs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;displayMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;list&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;placement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bottom&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;showLegend&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;single&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;editorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;code&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;exemplar&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rate(http_requests_total&#123;job=\&quot;qblingserver\&quot;&#125;[60m])&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;handler&#125;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;每秒请求率（Request Per Sec）&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;timeseries&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Requests Average Duration 表示处理请求的平均耗时，通常用于衡量系统处理请求的速度或性能。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fieldConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;defaults&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;continuous-GrYlRd&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fieldMinMax&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;absolute&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">80</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;unit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;overrides&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;h&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;w&quot;</span><span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;y&quot;</span><span class="punctuation">:</span> <span class="number">7</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;displayMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lcd&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;maxVizHeight&quot;</span><span class="punctuation">:</span> <span class="number">300</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;minVizHeight&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;minVizWidth&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;namePlacement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;orientation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;horizontal&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reduceOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;calcs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;lastNotNull&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;values&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;showUnfilled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sizing&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;valueMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;color&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;pluginVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;11.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;editorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;code&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;exemplar&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http_request_duration_seconds_sum&#123;job=\&quot;qblingserver\&quot;&#125; / http_request_duration_seconds_count&#123;job=\&quot;qblingserver\&quot;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;instant&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;handler&#125;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;请求平均时长（Requests Average Duration）&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bargauge&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fieldConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;defaults&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;palette-classic&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;custom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;axisBorderShow&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisCenteredZero&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisColorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisLabel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisPlacement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisSoftMax&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;barAlignment&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;barWidthFactor&quot;</span><span class="punctuation">:</span> <span class="number">0.6</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;drawStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;line&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fillOpacity&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;gradientMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;hideFrom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;viz&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;insertNulls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineInterpolation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linear&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineWidth&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pointSize&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;scaleDistribution&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linear&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;showPoints&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;spanNulls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stacking&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;thresholdsStyle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;area&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;absolute&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">0.8</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;unit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;percentunit&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;overrides&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;h&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;w&quot;</span><span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;y&quot;</span><span class="punctuation">:</span> <span class="number">14</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;calcs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;displayMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;list&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;placement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bottom&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;showLegend&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;single&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;disableTextWrap&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;editorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;code&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;exemplar&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sum by(handler) (increase(http_requests_total&#123;job=\&quot;qblingserver\&quot;, status=~\&quot;2..\&quot;, path!=\&quot;/metrics\&quot;&#125;[30m])) /\nsum by(handler) (increase(http_requests_total&#123;job=\&quot;qblingserver\&quot;, path!=\&quot;/metrics\&quot;&#125;[30m]))&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fullMetaSearch&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;includeNullMetadata&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;path&#125;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;useBackend&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;正确率 (Success Rate - 2xx)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;timeseries&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;loki&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;P8E80F9AEF21F6940&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Log Type Rate 表示不同类型日志的生成速率，通常用于监控系统中各类日志（如错误日志、访问日志等）的产生频率&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fieldConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;defaults&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;palette-classic&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;custom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;axisBorderShow&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisCenteredZero&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisColorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisLabel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisPlacement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;barAlignment&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;barWidthFactor&quot;</span><span class="punctuation">:</span> <span class="number">0.6</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;drawStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bars&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fillOpacity&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;gradientMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;hideFrom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;viz&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;insertNulls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineInterpolation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;smooth&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineWidth&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pointSize&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;scaleDistribution&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linear&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;showPoints&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;spanNulls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stacking&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;normal&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;thresholdsStyle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;absolute&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">80</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;overrides&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;matcher&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;byName&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ERROR&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;color&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;fixedColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fixed&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;matcher&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;byName&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;color&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;fixedColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fixed&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;matcher&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;byName&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CRITICAL&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;color&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;fixedColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;purple&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fixed&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;__systemRef&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hideSeriesFrom&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;matcher&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;byNames&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;exclude&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;names&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;Value&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;All except:&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;readOnly&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;custom.hideFrom&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;viz&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;h&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;w&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;y&quot;</span><span class="punctuation">:</span> <span class="number">17</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;calcs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;displayMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;list&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;placement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bottom&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;showLegend&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;single&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;pluginVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;11.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;loki&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;P8E80F9AEF21F6940&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;editorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;code&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sum(rate(&#123;job=\&quot;qblingserver\&quot;&#125; |~ \&quot;INFO|ERROR|WARNING\&quot;[10m])) by (level)&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;level&#125;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;queryType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;range&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;step&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;日志类型速率（Log Type Rate）&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;timeseries&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fieldConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;defaults&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;palette-classic&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;custom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;axisBorderShow&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisCenteredZero&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisColorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisLabel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisPlacement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisSoftMax&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;barAlignment&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;barWidthFactor&quot;</span><span class="punctuation">:</span> <span class="number">0.6</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;drawStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;line&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fillOpacity&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;gradientMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;hideFrom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;viz&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;insertNulls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineInterpolation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linear&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineWidth&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pointSize&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;scaleDistribution&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linear&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;showPoints&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;spanNulls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stacking&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;thresholdsStyle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;area&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;absolute&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">0.1</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;unit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;percentunit&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;overrides&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;h&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;w&quot;</span><span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;y&quot;</span><span class="punctuation">:</span> <span class="number">20</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;calcs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;displayMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;list&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;placement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bottom&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;showLegend&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;single&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;editorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;code&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;exemplar&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sum by(handler) (increase(http_requests_total&#123;job=\&quot;qblingserver\&quot;, status=~\&quot;5..\&quot;, path!=\&quot;/metrics\&quot;&#125;[30m])) /\nsum by(handler) (increase(http_requests_total&#123;job=\&quot;qblingserver\&quot;, path!=\&quot;/metrics\&quot;&#125;[30m]))&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;path&#125;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;错误率 (Error Rate - 5xx)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;timeseries&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;loki&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;P8E80F9AEF21F6940&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;h&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;w&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;y&quot;</span><span class="punctuation">:</span> <span class="number">26</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;dedupStrategy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;enableLogDetails&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;prettifyLogMessage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;showCommonLabels&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;showLabels&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;showTime&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sortOrder&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Descending&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;wrapLogMessage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;pluginVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8.4.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;loki&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;P8E80F9AEF21F6940&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;direction&quot;</span><span class="punctuation">:</span> <span class="string">&quot;backward&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;editorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;code&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;job=\&quot;qblingserver\&quot;&#125; != \&quot;Request: GET http://qblingserver:8000/metrics\&quot; != \&quot;Response: 200\&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;hide&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;queryType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;range&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;日志&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;logs&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;99%的HTTP请求的响应时间低于某个阈值，帮助你了解系统在高负载下的性能表现。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fieldConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;defaults&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;palette-classic&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;custom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;axisBorderShow&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisCenteredZero&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisColorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisLabel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;axisPlacement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;barAlignment&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;barWidthFactor&quot;</span><span class="punctuation">:</span> <span class="number">0.6</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;drawStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;line&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fillOpacity&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;gradientMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;hideFrom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;viz&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;insertNulls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineInterpolation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linear&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineWidth&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pointSize&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;scaleDistribution&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linear&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;showPoints&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;spanNulls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stacking&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;thresholdsStyle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;absolute&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;steps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">80</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;unit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;overrides&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;h&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;w&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;y&quot;</span><span class="punctuation">:</span> <span class="number">26</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;calcs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;displayMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;list&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;placement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bottom&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;showLegend&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;single&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;pluginVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;11.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;editorMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;code&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;exemplar&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;histogram_quantile(.99,sum(rate(http_request_duration_seconds_bucket&#123;job=\&quot;qblingserver\&quot;, handler!=\&quot;/metrics\&quot;&#125;[60m])) by(handler, le))&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;handler&#125;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;响应时间 (99th Percentile Response Time)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;timeseries&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;refresh&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10s&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;schemaVersion&quot;</span><span class="punctuation">:</span> <span class="number">39</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;templating&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;now-24h&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;now&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timepicker&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timezone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qblingserver-dashboard&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qblingserver-dashboard&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;weekStart&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="4-监控面板"><a href="#4-监控面板" class="headerlink" title="4.监控面板"></a>4.监控面板</h1><p><img src="/images/grafana-fastapi-01.png"><br><img src="/images/grafana-fastapi-02.png"></p>
]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>jenkins</tag>
        <tag>CICD</tag>
      </tags>
  </entry>
  <entry>
    <title>docker搭建Grafana监控平台01-安装基础监控服务</title>
    <url>/post/grafana-0-docker.html</url>
    <content><![CDATA[<blockquote>
<p>搭建 grafana 监控平台</p>
<ol>
<li>监控 fastapi 应用程序：grafana+prometheus+grafana+loki+promtail+fastapi</li>
<li>监控 jmeter 压测数据：grafana+prometheus+influxdb+jmeter</li>
<li>监控 mysql 数据库：grafana+prometheus+mysqld-exporter</li>
<li>监控 宿主机 性能： grafana+prometheus+node-exporter</li>
</ol>
</blockquote>
<h1 id="1-新建目录"><a href="#1-新建目录" class="headerlink" title="1.新建目录"></a>1.新建目录</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> 65534:65534 ./prometheus.yml</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> 644 ./prometheus.yml</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> 644 ./promtail-config.yml</span><br></pre></td></tr></table></figure>

<h1 id="2-新建-docker-compose-yml"><a href="#2-新建-docker-compose-yml" class="headerlink" title="2.新建 docker-compose.yml"></a>2.新建 docker-compose.yml</h1><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">monitor:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">monitor</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">grafana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">grafana</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">grafana_data:/var/lib/grafana</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GF_PATHS_PROVISIONING=/etc/grafana/provisioning</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GF_AUTH_ANONYMOUS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GF_AUTH_ANONYMOUS_ORG_ROLE=Admin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GF_SECURITY_ADMIN_PASSWORD=****</span></span><br><span class="line">    <span class="attr">entrypoint:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sh</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-euc</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">        mkdir -p /etc/grafana/provisioning/datasources</span></span><br><span class="line"><span class="string">        cat &lt;&lt;EOF &gt; /etc/grafana/provisioning/datasources/ds.yaml</span></span><br><span class="line"><span class="string">        apiVersion: 1</span></span><br><span class="line"><span class="string">        datasources:</span></span><br><span class="line"><span class="string">        - name: Loki</span></span><br><span class="line"><span class="string">          type: loki</span></span><br><span class="line"><span class="string">          access: proxy</span></span><br><span class="line"><span class="string">          orgId: 1</span></span><br><span class="line"><span class="string">          url: http://loki:3100</span></span><br><span class="line"><span class="string">          basicAuth: false</span></span><br><span class="line"><span class="string">          isDefault: true</span></span><br><span class="line"><span class="string">          version: 1</span></span><br><span class="line"><span class="string">          editable: false</span></span><br><span class="line"><span class="string">        EOF</span></span><br><span class="line"><span class="string">        /run.sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">  <span class="attr">prometheus:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/prometheus:v2.54.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9090:9090&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">prometheus_data:/etc/prometheus</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./prometheus.yml:/etc/prometheus/prometheus.yml</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">loki:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/loki:2.9.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">loki</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3100:3100&quot;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">-config.file=/etc/loki/local-config.yaml</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">promtail:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/promtail:2.9.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">promtail</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">-config.file=/etc/promtail/promtail-config.yml</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./promtail-config.yml:/etc/promtail/promtail-config.yml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/log/qblingserver:/var/log/qblingserver</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">node-exporter:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/node-exporter:v1.8.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">node-exporter</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">node-exporter</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9100:9100&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mysqld-exporter:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/mysqld-exporter:v0.14.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysqld-exporter</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DATA_SOURCE_NAME=root:rootroot@tcp(my_mysql:3306)/</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9104:9104&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">alertmanager:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/alertmanager:v0.25.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">alertmanager</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9093:9093&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./alertmanager.yaml:/etc/alertmanager/alertmanager.yaml</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">influxdb:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">influxdb:2.6</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">influxdb</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8086:8086&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DOCKER_INFLUXDB_INIT_MODE=setup</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DOCKER_INFLUXDB_INIT_USERNAME=admin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DOCKER_INFLUXDB_INIT_PASSWORD=********</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DOCKER_INFLUXDB_INIT_ORG=my-org</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DOCKER_INFLUXDB_INIT_BUCKET=jmeter</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">influxdb_data:/var/lib/influxdb</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">grafana_data:</span></span><br><span class="line">  <span class="attr">prometheus_data:</span></span><br><span class="line">  <span class="attr">influxdb_data:</span></span><br></pre></td></tr></table></figure>

<h1 id="3-新建-prometheus-yml"><a href="#3-新建-prometheus-yml" class="headerlink" title="3.新建 prometheus.yml"></a>3.新建 prometheus.yml</h1><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">15s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&quot;prometheus:9090&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;loki&quot;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&quot;loki:3100&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;mysql&quot;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&quot;mysqld-exporter:9104&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;node-exporter&quot;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&quot;node-exporter:9100&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;alertmanager&quot;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&quot;alertmanager:9093&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;influxdb&quot;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&quot;influxdb:8086&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;qblingserver&quot;</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">10s</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">/metrics</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&quot;qblingserver:8000&quot;</span>]</span><br></pre></td></tr></table></figure>

<h1 id="4-新建-promtail-config-yml"><a href="#4-新建-promtail-config-yml" class="headerlink" title="4.新建 promtail-config.yml"></a>4.新建 promtail-config.yml</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">server:</span><br><span class="line">  http_listen_port: 9080</span><br><span class="line">  grpc_listen_port: 0</span><br><span class="line"></span><br><span class="line">positions:</span><br><span class="line">  filename: /tmp/positions.yml</span><br><span class="line"></span><br><span class="line">clients:</span><br><span class="line">  - url: http://loki:3100/loki/api/v1/push</span><br><span class="line"></span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: qblingserver</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">          - localhost</span><br><span class="line">        labels:</span><br><span class="line">          job: qblingserver</span><br><span class="line">          __path__: /var/log/qblingserver/*.<span class="built_in">log</span> <span class="comment">#容器运行时挂载日志的路径</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="5-alertmanager-yaml"><a href="#5-alertmanager-yaml" class="headerlink" title="5.alertmanager.yaml"></a>5.alertmanager.yaml</h1><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">resolve_timeout:</span> <span class="string">5m</span></span><br><span class="line"></span><br><span class="line"><span class="attr">route:</span></span><br><span class="line">  <span class="attr">group_by:</span> [<span class="string">&quot;alertname&quot;</span>]</span><br><span class="line">  <span class="attr">group_wait:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">group_interval:</span> <span class="string">5m</span></span><br><span class="line">  <span class="attr">repeat_interval:</span> <span class="string">12h</span></span><br><span class="line">  <span class="attr">receiver:</span> <span class="string">&quot;wechat&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;wechat&quot;</span></span><br><span class="line">    <span class="attr">webhook_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">url:</span> <span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=******&quot;</span></span><br><span class="line">        <span class="attr">http_config:</span></span><br><span class="line">          <span class="attr">headers:</span></span><br><span class="line">            <span class="attr">Content-Type:</span> <span class="string">application/json</span></span><br><span class="line">        <span class="attr">message:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            &quot;msgtype&quot;: &quot;markdown&quot;,</span></span><br><span class="line"><span class="string">            &quot;markdown&quot;: &#123;</span></span><br><span class="line"><span class="string">              &quot;content&quot;: &quot;### 告警信息\n告警名称: &#123;&#123; .CommonLabels.alertname &#125;&#125;\n状态: &#123;&#123; .Status &#125;&#125;\n主机: &#123;&#123; .CommonLabels.instance &#125;&#125;\n描述: &#123;&#123; .CommonAnnotations.description &#125;&#125;&quot;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="6-关闭-启动容器"><a href="#6-关闭-启动容器" class="headerlink" title="6.关闭&#x2F;启动容器"></a>6.关闭&#x2F;启动容器</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose down</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h1 id="7-配置-grafana-上的数据源"><a href="#7-配置-grafana-上的数据源" class="headerlink" title="7.配置 grafana 上的数据源"></a>7.配置 grafana 上的数据源</h1><ol>
<li><p>新增数据源选择 prometheus，<br>name: prometheus (注：导入 json 文件的时候需要检查是小写开头的 prometheus)<br>url：<a href="http://prometheus:9090/">http://prometheus:9090</a><br>点击 save&amp;test,提示成功</p>
</li>
<li><p>新增数据源选择 Loki，docker-compose.yml 中默认配置好了，检查是否正确加载</p>
<p>grafana： <a href="http://192.168.14.102:3000/">http://192.168.14.102:3000/</a><br>prometheus: <a href="http://192.168.14.102:9090/">http://192.168.14.102:9090/</a><br>influxdb: <a href="http://192.168.14.102:8086/">http://192.168.14.102:8086/</a></p>
</li>
</ol>
<h1 id="8-搭建-mysql-监控面板"><a href="#8-搭建-mysql-监控面板" class="headerlink" title="8.搭建 mysql 监控面板"></a>8.搭建 mysql 监控面板</h1><ol>
<li>导入 grafana labs 中的 dashboard:14057</li>
</ol>
<h1 id="9-搭建-Node-Exporter-监控面板"><a href="#9-搭建-Node-Exporter-监控面板" class="headerlink" title="9.搭建 Node Exporter 监控面板"></a>9.搭建 Node Exporter 监控面板</h1><ol>
<li>导入 grafana labs 中的 dashboard:8919</li>
</ol>
]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>jenkins</tag>
        <tag>CICD</tag>
      </tags>
  </entry>
  <entry>
    <title>docker搭建Grafana监控平台03-监控jmeter性能测试</title>
    <url>/post/grafana-2-influxdb-jmeter.html</url>
    <content><![CDATA[<h1 id="1-背景"><a href="#1-背景" class="headerlink" title="1. 背景"></a>1. 背景</h1><blockquote>
<p>监控 jmeter 压测数据：grafana+prometheus+influxdb+jmeter</p>
</blockquote>
<ol>
<li>JMeter<br>角色：性能测试工具，用于模拟并发用户并发送请求，以测试系统的性能和稳定性。<br>功能：生成各种负载（如 HTTP 请求），并测量响应时间、成功率、错误率等性能指标。<br>可以通过监听器（Listeners）收集测试结果。</li>
<li>Prometheus<br>角色：用于收集和存储时间序列数据的监控系统。<br>功能：定期抓取 JMeter 的性能指标，通常是通过 HTTP 接口暴露的。<br>存储时间序列数据，以便后续分析和查询。</li>
<li>InfluxDB<br>角色：高性能时间序列数据库，用于存储和查询时间序列数据。<br>功能：从 JMeter 或 Prometheus 中接收并存储压测结果。<br>提供灵活的查询功能，以便分析 JMeter 测试的性能数据。</li>
<li>Grafana：<br>角色：用于可视化数据的仪表盘工具。<br>功能：从 Prometheus 或 InfluxDB 中读取压测数据，生成可视化仪表盘。<br>允许用户实时监控 JMeter 的测试结果，帮助分析系统性能。</li>
<li>整体工作流程：<br>JMeter 执行性能测试，生成请求并收集性能指标（如响应时间、吞吐量、错误率等）。<br>JMeter 可以使用插件（如 JMeter 的 Prometheus 插件）将测试结果暴露为 Prometheus 可以抓取的指标，或者将数据直接写入 InfluxDB。<br>Prometheus 定期从 JMeter 的 HTTP 接口抓取性能指标并存储在其数据库中，或者从 InfluxDB 查询相关数据。<br>InfluxDB 存储来自 JMeter 的压测数据，为后续分析提供支持。<br>通过适当的查询工具（如 Grafana），用户可以从 Prometheus 或 InfluxDB 中可视化性能数据，以监控和分析 JMeter 的压测结果。</li>
</ol>
<h1 id="2-配置-influxdb"><a href="#2-配置-influxdb" class="headerlink" title="2. 配置 influxdb"></a>2. 配置 influxdb</h1><ol>
<li><p>新建一个 buckets,名称为 jmeter<br><img src="/images/grafana-influxdb-01.png"></p>
</li>
<li><p>新建一个 telegraf,bucket 选择刚才的 jmeter,source 搜索 docker[不影响]</p>
<p><img src="/images/grafana-influxdb-02.png"></p>
</li>
<li><p>新建一个 api tokens,选择 custom api token,buckets 和 telegrafs 按照下图，生成后保存 token,后面配置到 Prometheus 和 jmeter 上<br>（第 2 步 telegraf 创建成功后会自动生成一个 INFLUX_TOKEN,但是权限不够，也不能更改权限，所以需要创建一个自定义的 token,给读写权限）<br><img src="/images/grafana-influxdb-03.png"></p>
</li>
</ol>
<h1 id="3-配置-jmeter"><a href="#3-配置-jmeter" class="headerlink" title="3. 配置 jmeter"></a>3. 配置 jmeter</h1><h2 id="1-使用-jmeter-自带的插件"><a href="#1-使用-jmeter-自带的插件" class="headerlink" title="1. 使用 jmeter 自带的插件"></a>1. 使用 jmeter 自带的插件</h2><ol>
<li><p>选择插件 org.apache.jmeter.visualizers.backend.influxdb.InfluxdbBackendListenerClient</p>
<p>缺点：不太友好，grafana 没有合适的 dashboard 能展示多个请求，需要自己制作 panel</p>
<p><img src="/images/grafana-jmeter-01.png"><br><img src="/images/grafana-jmeter-02.png"><br>influxdbUrl： <a href="http://192.168.14.102:8086/api/v2/write?org=my-org&bucket=jmeter">http://192.168.14.102:8086/api/v2/write?org=my-org&amp;bucket=jmeter</a><br>application： jmeter_test<br>influxdbToken： ****</p>
<p>配置好运行的时候查看 jmeter log 有没有报错，没有报错，再查看 influxdb 中的 jmeter bucket 有没有收到数据</p>
</li>
<li><p>导入 jmeter dashboard ID 为 19950<br><img src="/images/grafana-jmeter-03.png"></p>
</li>
</ol>
<h2 id="2-安装使用第三方插件-jmeter-plugins-influxdb2-listener-2-4-jar"><a href="#2-安装使用第三方插件-jmeter-plugins-influxdb2-listener-2-4-jar" class="headerlink" title="2. 安装使用第三方插件 jmeter-plugins-influxdb2-listener-2.4.jar"></a>2. 安装使用第三方插件 jmeter-plugins-influxdb2-listener-2.4.jar</h2><ol>
<li><p>下载插件<a href="https://github.com/mderevyankoaqa/jmeter-influxdb2-listener-plugin/releases">jmeter 插件地址</a>，</p>
</li>
<li><p>解压到 jmeter 的 lib&#x2F;ext 目录下: mac brew 安装的 jmeter,位置在&#x2F;usr&#x2F;local&#x2F;opt&#x2F;jmeter&#x2F;libexec&#x2F;lib&#x2F;ext&#x2F;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> /Users/tisha/Downloads/jmeter-plugins-influxdb2-listener-2.4.jar /usr/local/opt/jmeter/libexec/lib/ext/</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启 jmeter</p>
</li>
<li><p>配置 jmeter<br>选择 插件 io.github.mderevyankoaqa.jmeter.influxdb2.listener.Influxdb2BackendListenerClient<br><img src="/images/grafana-jmeter-04.png"></p>
</li>
<li><p>搭配 <a href="https://grafana.com/grafana/dashboards/13644-jmeter-load-test-org-md-jmeter-influxdb2-visualizer-influxdb-v2-0-flux/">13644</a>的 dashboard<br><img src="/images/grafana-jmeter-05.png"></p>
</li>
</ol>
<h1 id="4-配置-grafana-dashboard-新增数据源-influxdb"><a href="#4-配置-grafana-dashboard-新增数据源-influxdb" class="headerlink" title="4. 配置 grafana dashboard &amp; 新增数据源 influxdb"></a>4. 配置 grafana dashboard &amp; 新增数据源 influxdb</h1><ol>
<li>新增数据源选择 influxdb<br>name: influxdb<br>query language: flux (influxdb2.X 都得选这个)<br>HTTP URL: <a href="http://influxdb:8086/">http://influxdb:8086</a><br>Auth 打开 basic auth<br>Basic Auth Details: User&#x2F;Password 填写 docker-compose 中 influxdb 设置的<br>Organization：my-org<br>Token：填写 influxdb 配置的 custom api token<br>Default Bucket: jmeter<br>点击 save &amp; test ,显示 datasource is working. 1 buckets found 表示配置成功</li>
</ol>
]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>jenkins</tag>
        <tag>CICD</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo-cli</title>
    <url>/post/hexo-cli.html</url>
    <content><![CDATA[<h1 id="1-安装-hexo-next-简易操作"><a href="#1-安装-hexo-next-简易操作" class="headerlink" title="1.安装 hexo+next 简易操作"></a>1.安装 hexo+next 简易操作</h1><h2 id="1-安装-hexo-next"><a href="#1-安装-hexo-next" class="headerlink" title="1. 安装 hexo+next"></a>1. 安装 hexo+next</h2><blockquote>
<p>themes&#x2F;next 作为子模块加入到项目中来，需要先 fork 下 next 官方的主题，然后 clone 到 hexo 项目中，这样后续推送部署的时候会自动拉取自己的 fork 的仓库</p>
</blockquote>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> hexo-blog</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> hexo-blog</span><br><span class="line"></span><br><span class="line">hexo init</span><br><span class="line"></span><br><span class="line">pnpm install</span><br><span class="line"></span><br><span class="line">git init</span><br><span class="line"></span><br><span class="line">git commit -m &#x27;initial hexo-blog&#x27;</span><br><span class="line"></span><br><span class="line">git submodule add git@github.com:TishaQin/my-hexo-theme-next.git themes/next</span><br><span class="line"></span><br><span class="line">cat .gitmodules</span><br><span class="line"></span><br><span class="line">git status</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-配置-hexo-next"><a href="#2-配置-hexo-next" class="headerlink" title="2. 配置 hexo+next"></a>2. 配置 hexo+next</h2><ol>
<li><p><a href="https://pengtech.net/hexo/hexo_advance_apply_next_theme.html?t=1724564732250">配置 next 主题</a></p>
</li>
<li><p><a href="https://analytics.google.com/analytics/web/#/p455834610/reports/reportinghub">开启 google Analytics</a></p>
</li>
<li><p><a href="https://tongji.baidu.com/web5/welcome/login">开启百度统计</a></p>
</li>
<li><p><a href="https://pengtech.net/hexo/blog_seo_optimize.html?t=1724564819227">SEO 搜索引擎优化</a></p>
</li>
<li><p><a href="https://homulilly.com/post/hexo-next-add-code-folding.html">配置 code block</a></p>
</li>
</ol>
<h2 id="3-使用-github-pages-部署博客"><a href="#3-使用-github-pages-部署博客" class="headerlink" title="3. 使用 github pages 部署博客"></a>3. 使用 github pages 部署博客</h2><ol>
<li><a href="https://juejin.cn/post/6943895271751286821">配置 github pages</a></li>
<li>两种部署方式<ol>
<li>本地通过 actions 直接 delpoy 到 github pages 公开仓库，需要设置仓库的 Build and deployment Source<ol>
<li>缺点：本地文章丢失或者换电脑没办法同步文章</li>
</ol>
</li>
<li>本地推送文章到私有仓库的 main 分支，触发构建到 github pages 仓库自动部署，直接访问<a href="https://tishaqin.github.io/">tishaqin.github.io</a><ol>
<li>优点：保留本地源文件不丢失，和换设备后拉取同步</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="4-日常新建文章命令"><a href="#4-日常新建文章命令" class="headerlink" title="4. 日常新建文章命令"></a>4. 日常新建文章命令</h2><ol>
<li>草稿状态发布流程<ol>
<li>创建新建草稿单<br><code>hexo new draft title</code> title 含空格要用引号包起来</li>
<li>本地预览草稿<br><code>hexo g --draft</code><br><code>hexo s --draft</code></li>
<li>草稿完成后发布到本地正式:<br><code>hexo publish draft title</code></li>
</ol>
</li>
<li>新建文章直接发布流程<br><code>hexo new title</code>，默认就是新建到_post 下</li>
<li>本地预览可清空缓存重新构建<br><code>hexo clean &amp;&amp; hexo generate &amp;&amp; hexo server</code><br><code>http://localhost:4000</code></li>
<li>本地推送代码到私有仓库时，如果 next 主题有修改，需要先提交子模块，再提交主仓库<ol>
<li>提交子模块<br><code>git submodule foreach git add . &amp;&amp; git commit -m &quot;Update submodule&quot;&#39;</code></li>
<li>提交主模块<br><code>git add .</code><br><code>git commit -m &quot;Update submodules,add pages&quot;</code></li>
</ol>
</li>
<li>推送构建部署后，如果访问出现空白页，注意查看产物中 index.html 文件是否是 0KB，如果是，需要检查子模块是否已经 push 到远程仓库，如果未 push，需要先 push 子模块</li>
</ol>
<pre class="mermaid">sequenceDiagram
    　　　participant local
    　　　participant private.blog
         participant public.fork.next
         participant public.github.io
         local->public.fork.next: 1.submodule push
         local->private.blog: 2.push
         private.blog-->public.github.io: 3.github actions deploy</pre>

<h2 id="5-相关文章"><a href="#5-相关文章" class="headerlink" title="5. 相关文章"></a>5. 相关文章</h2><p><a href="https://juejin.cn/post/6844903751908605965">https://juejin.cn/post/6844903751908605965</a></p>
<p><a href="https://pengtech.net/hexo/hexo_cli#3-Hexo-new-%E5%91%BD%E4%BB%A4">https://pengtech.net/hexo/hexo_cli#3-Hexo-new-%E5%91%BD%E4%BB%A4</a></p>
<h2 id="6-拉取本仓库之后的配置"><a href="#6-拉取本仓库之后的配置" class="headerlink" title="6.拉取本仓库之后的配置"></a>6.拉取本仓库之后的配置</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#一次性递归克隆所有子模块（推荐）</span><br><span class="line">git clone --recurse-submodules &lt;repo-url&gt;</span><br><span class="line"></span><br><span class="line"># 后续更新</span><br><span class="line">git pull</span><br><span class="line">git submodule update</span><br><span class="line"></span><br><span class="line"># 或一步完成更新</span><br><span class="line">git pull --recurse-submodules</span><br><span class="line"></span><br><span class="line">#查看状态</span><br><span class="line">git submodule status</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>jenkins拉取bucket仓库运行接口自动化</title>
    <url>/post/jenkins-1-bucket.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉，您输入的密码错误，请检查后重新输入。" data-whm="抱歉, 当前文章不能被校验, 不过您还是可以看看解密后的内容。">
  <script id="hbeData" type="hbeData" data-hmacdigest="f1da408e5c6a7e12ed8b0f5865a25f1e4ad305a6efb3282fc3752b0d6e5a94fc">dcc4350ee32b97b121eee5e44c759b1256788a5c4e4ba0bca6150f2c0741224feacdf617c6fca90452ac3d5fbf55ebb59b8658b3d99bd46d87b0155b5b1ef11c0bc482b0bfd4dbfea91ee20b70874ba6e925943b1392d7cb5aabe72389b3f9df5e559bf55df1ca8deccb9ef91f2604576e04f515e8d6ab75490f7b38abf32b071ecc25443af7a91c2d0d44c697a6f77aeae2312c8c5441468738029b483a83b17a3822a88ba5a1d53abf804145e53014b2a78465b1a5803b7d64b9e33041e7966eaf012ea5104b413273f2f3d54457198b526fe3112e5c499ed47b4be18be682f30002bdb6fe66486bd4b1e1724c962a2dc161bd42b3d72898d4686394dfe274d2ba2630e37013b76413c2c0872e05782c92cddba4bd4999f8ff5bd78a052f9d489c3d06ee70688b3365dc64475e4acedc958d8156b5fc982bd773b27080d2598b07ca01fffe8621963b8dc2b90c9ccf3afddfc92eea01ccc045cd27cc9ba403f95c382f014cd31b6f005c294864eafec90cb984ac595d4cfd85da84bbe9c3c464b0680e222c0ba642f8907bc2aea3deebdd551ed962f728180ca6cf390651526c46086f76e75cd436e3e8a2b7ec19f8037a296a1b8fe63af356cff496c199a3f4febe1daa104901257a22d3eb5e21e4e514413f2890fe5cd527a051a80ad2c39f8b8389d4627a41b90609828acba971742d91f04bded4d0585dc5ce273ae3453f299e6f00be297314ec4de15186c0c0e89fc2247077cf2b5f1e0d7da69b205e51486a238f056c540ee7761f964b469e1652874b062c605519b8365bcc1ed21f0d4a339a0fdc742acbc8307872a8c159c2d869dbe74273c459ea15589725645027924fcae3c7249e932b3d56a51ea449bfcf7350c939dbfdea64f6b6b8222593ecc0600641499761dcfb7466b1798edc39873f01035ae93fde86dfc60996caf0f2e2c0efbde6813f2a5ad17ab12cd3c888c788c7b8ddf9afe4d8efe0ad0789222b932cd6e48fb3aefbe497e3e0da30f5302e09df36f088c775c4d69160835842355e7c39a2519a8053793f21eb35a83545df0ec5b7322eeb3cf887860ed51cf0d217c6d4d3a74d0ec284626e9ac142ffbfeee21c104aae3ca8b1fb774e0ed25bbeea86b417435965e46abb74d7071656aa1deb0a7f177cd7c03338fa2c0b17f3ddead798a9a2151de15a27e6aee46d837bf54b4080917fc80876faafcec53196d152d2ef80883163887d9fa362cbad6b52f2af7db85a2989fbe786c326be0bb8a1abb41ec95b40fe539d2177157c96397fd1e95c116489626672d7e875868e985654966fc27a39b3f046f6f6060b1af9e69523aa89cc965866d6b89737c0f744277448df13974f73bd1c323cd2e1b5b468a7d8b031905c40fefcf9f663b10c83e7db9908a4e1336867b90b9962ad986935437b074a6a3ff70d4074115226e379c5d8885c9304153d8cb630324b4cdfa2f85f4c372440e738c3af13610d6aff8863f4a9c10390b5f48b16c49235b0bf25d844a7b10556443deecec7533f8891b0b8c40d9beb921a053f803b78708dbb151498b3d3af7d45c33f018fd2d2fcc263f82bfac32fa303e6555d6a9a1409b717c7e09c29ae06a3ad4c8af64a02e30fde2b0f3a53bacd2e004aebaf50ea360c2a228302baf9b08c66263a8e88f4490c9a302978be83b8047925396d9344f73291b9f7ea06bece1dddc0fc4b13105435c6e7d3299b2615f06ed5c6b3e930459e8d7607f34f36bb65ee6f8e64b73a0e2ba0525fed05ec4783e5cbaeb8c40ef1eb474547e681f8cf9402006ae6d3795a6bad8f8a08e7d56377ddd057b32aa70be6fa83aef86e15b14cd6cd02d838f2010f803ebdc4c4e460f3be2eadda011c31251c0f1afb9ed75015846bfa725f7fb7575a754312bba4f3b7cacd5d0e0c4a272f116a2adacce6b2c8aa62217f8884d74ad89809cae26182f400059b7fad4ddba54ee6624018d96f5cd6a3b36f173322dc530d14f382276d931adaacf4241607d51666e9a547ba82efeb035a1d3a5f0e3f73c421a2ffbe162b04cb4a92c9eebe2d2c8073fba6bc943afae0acb042cc1ac80e5d275d5e6723eca1345f0e36563dc298fbb8d906ae142e7db12dc550673c3feb6f215739dd88f2ef7610d0f846caa50befea614c6d0de584bc8999d0e7c2b910d59ac4054d9a5fe4876af73c0be0e8d9c7958dda0a426745148546298376607f54b50a7ef4b85f65a3c85ccbe9ba199d6605df22eb38ce7585e8dd0231c5d9250d6cbcb66ac58a66d3a5825ff36b0cfc3418c16b1a2146ed582f12556c5b519f953ffa0d481388b7180c6da5e47880729ab8a484704f3e8d8f14d4fdc245767bbd8b0f6ca8a466ac30167a5debfdef11c5278deb2b2764047f0999dd09519b5559c4e36a79e8cdcbf801a9d6def33be7cab0b29c89387953066c69bf35eb20e8855a9791b53b7677809ade34ad619874054c26e6eca68d48c28a8365159160c04a399661095e409ca9f2d46cfe1c5e170619ea8bb22ec679a42b7e88b8c6f5c6b260a8d7403dcab7ea93bde94c4bd5958ab5b52c586b98fb9788098e5fca52a6f12bbd47dbc594908434fba23de7da2e31303affb61370ed19270eea008f4491f324d312898f00364cfe6353322c882952d38f6feae5f93f93eb33f55dcbf31a4a970f5d7c48685d9ad471f6547da83bd9659603f5fe8609cdbc36a7e81898770b2b49d9ff249dd241d5735fa6967ff9f0cf2c672224ed148f6a50a4ef5f010163514391f1ea1b3dca8c9ce80ce2eeb22d179911ad2e4aa9d61523546d99aaf0f089f0d53d346c336b58c309deafc9365d2053c6d4ecefa0463fb84e5d2eb1636d489663f1893378dcc23b06be16488dfc26b5fc2b77341559516e367128bfd14a0407d2adc56c7dabb335c53300b2a933e4cdce9f8e82f996678be76a760fdaaca547a0f5ba9195500f7b2bc4880c13842b11e5d7b34438be57ed67826ad4bf68dcd5ded605ca2bb42585f3bf923ae48e68cf5c3094cda270a364a8cbf2963431cacad560eef33546ec69a4df50878c0bec4e6edaaccf032829df05d42697a83f00ed1217c6d57cffe93a336c03e578a7a8bee866c8a2a3063079fa060b2e2c05c766fdfede6316b88aadb0b8f8fbdfff40fab08fabba1a66382a1e022ff3d69e2d4ff643733ffa1da261427c7b46cf7bc3add5cd9e9024e5bb2a5bf92308e90d1def2d7672e9ef3cbd23bbab2e36a64c7a3ef2df22123e47f9a00349089eb4406aa97fb74c4d4e828cc9170d61717e3fa804601397945c9442dccbd43aa0b20acd32f1a5837b8d546464e222ca58547402b0dc3dbd2f16ad4b538b3199dfb5cc572c24403e6578cf6619f1287c4744e53c35f047c633258a6ec2ac6c05d2f9b00c007397d3da9b1768fa993b7b2e34bc45b6e02f05cd816953bfc61edcacd1077a5ca9414e4f2215dd37474124af7812170064dcdb5797060a0cee937c5afbc544b0fb5f2dd3e908812bdf7a3f83b99130b50b250a3e94f1950ba3a600f26bec5cf8dda9d1b2f6289c7985ea1d12c652c1be49d5b4db048945043a7e333f15038046d5a1c71a54e4c2150744bb50c4a04687abfacdda0d761fea9ca7ac29b9e18cde23c05191803f00850cb310014c50bcd84cbe9fa37b282803adb57c2cda2efdd11a660c1bb64a9589a7f9153fe9e940666a4496281dc85d51272064dc36a7c441f1a75a23759cfd35e8e12daded0fcc920841eeb1f82e0f00c0f1859415667b2896b652428f2220be87637cfc204c7e7c73a22c02f39a0d08e44c0e3bcbc7dfea0b38e1fb9890ea5055716a28bfd81d61b12e03ab06c624758d84a900d7b1623878b02de0bd977696bb076f97dc59b15e7430982b417a22c0386f57644f25b93382bba1f452edfdcd3d1d2508cbdb4fcf82836d31ba5d03bdce3f7b1e33bf96d472ff4440419e0954151efcbc195d208aca87b2384bf53f74f8b432146d913c676f1915786839d8f46edf52b4f5287dbe7c22a06dfc395e5729a744340699c7a7e65689bc41e54a46693a4cb37f686874a87206fb04650cb48e3460f3278be8ae74cb346676ba91995975d57ae8aaa798c06a096b718b28a12f2619acccff147c85966c731c48a14973f167c2e58c672fcb6cdab762051bd4d8edc030f54cc7c8014f8e7c80eb9f67cd5b86722b146e18c0d04127bfe8f8ca29822c673a9e4226283b57870bdc0a38ae39f43d826f449667e6a5965f86003ce85e92c80419670b9a69d721b9e9a4e0fbce63fa90f88e57e90329a663fcce0fe724e9ae760ff23c13005c2680a10f672658ea36cd579ba323f40f442b795bee7a4468dd43eaf81cecd91d2c7818acbf71ed1daf9a48b69743fd76082809cc2d816953c4778ecbf763d3d0d046619b3ad83da1b4676d7fefa6096744fc3a378568aa381670051ac5896688956f535f63b1ffe373317e7a74743743e64508a7b630ebdee5174de01e00eeff9a998e9513710194be7fc978825b1a4fdb24056454f57ccf3eb7a9ba6bafe7fda20b8eee7d64150ffbf9140098870478f018f7cd71ea4cde151581aff7576856c0bf7f85bcf2d97b3bdfc2b52367ef5b5987cf255d287d9dbe0a591f2272091ea73665495a03db7c39d3170e8242ab3a4be933f501bccbf3e50ef222062f29ee89a1a73ac63fdfe4c8aa0bcd26c90a937bef84e20c21ead9fefe020156b114998723c61051259d2ee03d1232638a050bb38cababc629a12838a4891c93755eae09b0d6643b52063e8f8aaf220b873ac2f2f17bf22583dd2120627780f40e569dc312b592ed3d379ecfbe4204130bf987e6ad68857c0623bdd1b12d623b0f49ed8f6be251fdae53b9f8f72a55d6cd888f34032e8f25f0e124a91ec2f79d4d10eaedc9b19c773a1c7c2bacbc6f05338a963e13cb7e913bc90cfc11e1c800cf6f1c49cd38eeac048045e5c71e0b521a03b2de4e8cc7df50cdea308aeb37509746df7eabe34b28d08f12b488a9050b87802bc52e0556e862fe582b9002395ceaf2be6b9c4012679b445790410a75a3ed06488621c40f96686e35a8c938f4262f777f1d4d99e90a25bec52ec2fcad8615b38054f2fc31ba5b6ca8b216f3a4171a4eed55fe34862adb9b622dd1d9c18d9d997de506a0e7cc3fe224775080f7d92b27885563b1b696198fe95950d5e992f2254ef1fa4c86fd28aa453e2ba9be2302966bb483e207141cc5e7f28e40c3a3ecb969bab302e9773fb76eb94a13874ed92b9dd3149653e3776e3eca6cf5f5921e47e89dbe1ed510dcf606186c8d79f928bda9a74a9949653466808703aa108035301d6b29d125e5066e20fe6167fd8a9c250d71b574ab38a93fe08975fe53a4bc439c1212b137e7d027ac535ee1322ff0bb93e4509419cf6ca0154d5083b07e8a610d56a73d7e78ba5c10b7f7e5fd4ea802db96dafc25eef5c951aa4de74c8e78df8cc32b287d82ba4ba8ad6a5a484bf9d3b3d836af1cdeb5df0b6aa2a7252a26a626856df7bf780381715c4922d8a6a0f08e079bbf2cf9d89eeb61128b139972214a65bf6f0ea4ebf403d6adabe44ab46e429a83161a944895f2cacff902ffde8b9a90a7a1f87e360a41e93dcc373d898fffddcd5f85d63d4d5d582549549d182f1351cd7f3765f86baa75bed7f2c14172e52097ca5366fc30434f7da4441df564b03b089f368948f86ab71ddbfc0bc3434595739a7abc0c0e4bc194a1fe97c360cd6bad2b2ae5a0e655f5749d4937d7cf0641676586ed1ef70e5514ea9e45ce4c8643fe51477fef01bfd07a938db0735252cdc5bb7e772e002855dabcf76ecd9e89155a0052d323b0374ebea93a7643c6fa1783a80d4e16279b0594f4c147014bbccbc113bfcaa6ee9039116279ea112b6ef0d526a7480477fe99b0b101d3241e772fdc75220f90bb6d471487448f9e155b1368fb84babb037fd5579e120b423275ebe73138315fa0c3b172163611f43b2db28b60e37577864fad57712987c10f02b1e253b108a708ee9ff5f377df93bdedde93f4bd81b9c560148a4f0ae8fd97de86e8b8478e23fee8c5937b83c737649e543b556f94076235d3773822ece0f5782cae71c140f7fe3fca328177bc321319177389958b9c6437ce4b5b9bd1e1f5c8ff742e4cd5968b9fd6e8f8e3bdea05a7df16a1a243feded3f8162dac6471f0527ed305de7caa0e3fe84cb06c759d8c26f5da0868f93fb62a4bc930195784fca39a8ea1455b027d3eaef603f3ad43494af40a8fd7656399741cad28cfd79b56fb5c8ba4272c7039df0acf72a6791f44d301ef128ede98f68d464b87ad2016a56be7aa1061b2c0904515671344e183b555f9f92450f82a90859d3e14299aefc9b73347e6a2364425a84f46c8600ef91d777643bb3a1eb0b15446f13f751a27a36dd683930cb6e9c197f4f7da1d9d62de3cf0c784e63d9f38ae040e329ca4a56a66ef8c53ccb930844261154f59e205ea81fb5c3f2fcfea734ef91d036dcdec414f03b9512803ea6d9159c6114efd9c2b0c3ecab32f5be6d302fda8b40b36eb2044db772839429ac06f5e8e14c65c95044f2a322f2519027c7d5ca059f9db469c532968c276ec02c9836cbd91965328b14291a2e6dbb8a1bd4f11d5278088e321cea50ad37317ec41d60f6f6a255678d7c7a961864efd162e4fd16cec3121ec83f7c39155afa53a856f89eef690338bbc4cf65fdfc143116f64d380ccf1ab8a18ecc0313fe9d987ad07b7df891933a1d7706399b0f7cc175d2904d560554536f585c63fc5c732ef7f5b126aef6dde73a115b3fb827cf095be6fe6a37ecb90bbae62f1d7b956ce369c0075f868fa2cde5833f13b0eb9ee51556e189b080276608db40b4c1c17edf2b64eea8d7b00657186688cbbcae2d6bf672f67a5afe99b9ae88dc891a10a586388a6ef3d63a2779e89eff3055f60df33ba938ef2570a2f152a368ac726dd02ae37fc4d12fb51d71bc9f3f1c91d75c58e3e97441d615d425fb35fdeabda8614b05fbe48815a55fdad27190baaf3460bc1377a13a0e0fc8de2caddffdca2188cc15a8f0cc2c5574296f15b57da3d0632955f83891cc2d365a80f4a1070207e8249bdc55dc69f1f93857bd6de5ca33b8b04186cffa186f906e63f1afed2591d171b8d4d0fb64625474f5fd66f452ce70dc53b542bce6acdf8ee2cd63c8aa50ef426f6ebe5f2ea00adc86125f59016895b39ef8e8fec83d291d10a0a88bd7c661729af8220852d9bb09234b07a01ea5ba67c0a7aa3e5579aea407e91167e550bd7e7f904f77e26d0dfcd22f1139a4437ca18814153101093ab84c095c0a676b0105a20a54498d63dec073272624b6d0f54dfe04594d405126a20195a95fa4be1374866c6b1cba43418ddcca1086b3af57e7da37aac65ac77ecb4bb07ebe90422c97085eaa7c18b3b3fd5541dbaa34c9ef6e9e0683047010b2f2bd4e0f298460b67dc22667d5242de18eb3988f154033b3cf2d59bf99e4fa7918c5511bd922791336d43a8d053740de6776f4d3bdd7c388d9ed9236fdcde82b79e45689e37a308cb5ef803ebe09a4edd900e46f236c91d31c5411edab24a69ac4fac62261c1861d3c4faa6809619975efc00622ae219672db3b1a3162805c461aac1945cb0164f54bd2f67926ed99ff1e09828c64c15c334f69daacea4e78373fd0abdd001ce740bad3bc0b4de656f93316fee19f6edf8fa7d89ee16a9daa7c15f2dd0fde26e5ad24f43499c45beba8fbf7d031d7c29db97b7124e40e49f336839e2465f06a32523bb29cf6080b2891e2cea88837810d4e630fe9355a09db3bb6657d5e60733a351089a1790ef4308053b34f82a454801cfdd61cf1e5accb7077d0484bcbeb1d766419ae837de8541defceee77975a45349d99c77f5a982d979ff592d81daeef6ea86bc7fce7616b628a7dc383b90cddef529e3d2aaef4f7f1339d3373180ebfb19f2bb9bfa9b0a97ec46e00315484f2f0a62933c81ca86c541b20925fbe47401a4f9d7d54525ffd9cf250e52061d4decfee36b6b33e065fe74f0d46a2eb8b355fe9d7f75ef22d4bde741f4fa3695281454f835d88bc9d780a689022ddf2c0a816083376ec8887c0c94f1da661af3abc60733f1e5f1dc446e073adab5279a181685565c7860eccb2b50932e0dea0341850c77ee02a2419ac906de6c8c55ec0779411b17d318f2bd1664c0eaa9867a7aa0ccf568e9483e4796f5263f459d6a13af6d1a55587cb9b3f2c7e49bb6f58a68b8beff768a83a46ba973f2d3b1b15dc9d9337555990a069bba87e5357a8eef9e4eda87be816c8933c8de0ec45dfa0aeae15b2c2129ec01bdc69ebb76ebbc3bf423effc9feda857e9860029acac8795d70c89b133211130010f9a85b9eef3824f99978d2acfb851017b2786a07133f640ebacbfa6a51cc16e35c5e083d23ff6d21f7f5a453ea5c7d28053769a7146bf16e363f53ee62c4d634d6df1263c61c1851da4f4fe283522988dbc6b48ddc8a8a985fa8601ee001f866994043274a155917adf5bc5f89901a78d15de7eaa97eec625e7059b84064e2473e1aa4301b85726bc424ec3a7dd6d71a1e89d5313a446c7f3627ccb4b21446a9775af19a1c4454c339a08e527ffa3f458ac499fc63b7a87e451a5f0d27797f38f5116487a203b0c53dc89fa5f8f10cf2f552390711c50d314e13480e408fe44d7e19a7d84f81015127fc7e49c3f0639fa09741f668241de04bcdfc715b6c81cb6b1ffcada55b61ae02835a8ea2d5e8f43fd0472f9cb1480a2f003cfbc426136feeebdac3c65a8c705a0bf7d09538c00227701d51b098b12f2bc493484b40c34d6b1ebf6fb7379e418280d3a8ad45a7c7e95a904211fda1709bd09be8be78c5c0212894b44ef61921944edd18a7384ce032b21003483aa1f96f3478801edce5fcf6ff632b4b139f954ddb8cc3b1b5ce1e4e1fc3ce7f76150d8efdddb06d0144f5a004763286bd7efcc55d3b1ae407eeb2064ef27e64b7c31d06794801ad67c2496f8bc24898d7f8fe2483904226e4ada53f90ceccd30f3241f4be79f8b56d990eb1a9cb6594f24501405d1a56e669f9c56de1ee5d1b38e3b2accd574c79d18d5cefd4b77c41c29494a292ea4d41eed24a7b35b67ec7beab392f248662579beabe4a4ff08a6014af7b67e0436bff21c9be6f4baf5c185466bededa55e096ed1c04ed808532da01814abc2f7d95501c2ad0cd50d59ec5137e25181764bb1d0d188a530eac713e5e09b7427826feac51b2256baa4a0d0ad11fb334783f87a2011c1eb74f2d506c799c8b493c6bbf3a935088a6ca57bb749ff12dcc4306344b4ac2dd9a422b456d395b184d66bc4a38215ce91cd84c96ebd7266f51400994e3487916e643b69585c9aa76b4c30999bdf0d12f76b203dc4551d940151bd59e84db416c2cc8e046a96dd0ede8b966fb2ef1b959fa1d8f639667a66cb641d4bbf9ca09a397a9f3d6f917d2fd89b30eb06d9f3488039a98b792cdf9d007d5c1f07edcd90ebb1be1ba3d52e3078442d10e62ca8bb6babed2b726196d427a4f60d7ec6b61a5f0721c8a3b74243f1762a83debbe586f05a5fe75efea3092e5c81088b26da7638ca69cc521e3d811bbb8b943dea6da97131493f318210cdfe76aeaac388964f3a10d5b7fcb1a39d47e05d9c4f5bca1de1c8300d2422bf43621285902d01288196502a1fea62555ef1a20fc05f99904c8961ebf426fee9bc9778be7f7db9617a306567443f74905e539fdbe0d6d5ed5003e8fc784860b7d427dd1ea1fcc617c338899863f0c30dbc405b84f7a3f2751aa15045700dfecffa7d1e2bf96d542b5671ee8e4e58b3e83a9ff4a3af74d187684c321262aea18c83e4492c7b8e1975677daa0bd59515a981ece33b7762bf9a2c3acbcb888a37b84e224b02944c38a676f29eb020ee7b38ae1c4ded9d47bc29bb852bd79c6dd21f7f65f35557340b02de0ab4dccf555547fb3c8a93f84ebeb57089194e28a18fb1fe2317136255b1d01b53edca05086240ab033641aead1f6c4c8f9bd837917ac4c44f8bcf74820c144ea98ff8795b03db1ad59490deb06f3d08883b268e3a5a3917b53dd0f5dfd9e3ec91a5a7737e3d5574424992d2998782f82951f4ca7cea81a0dc9f9fff7822c415c8e279dfa34bece946392372b11ac65f83fb4b12cc243d5459387359c502ae17e9af44fbca279009bb049da03cf9c013635dbef28d14f84a867a6f37edcc9269fee210248152d2ed433c7e8d598d2d49f25d813866e1439c8228b6a0b8f9704685fb261aca108af58557698710d64cfc625187e181a7c5ea121aa57d68b6191826f1e4077f2a55a42c342761bcb95433fd4a62a0732d0d5c8cad0c73a9b3a0a51818a3959515d7818f99ffa1cda0d2804ccc4d92cd9a37bb892bb34df40ca0c5769d245def93f4c8d8013a3731e365162173530a265ff95e6cd73719d800c9de4f5d71366e0563ce949ab3f380f8e828bafeb3071270bfeb9eb957973a7646ba2054c3bb2b3b192abcced348c374283d2a1e48d8582b69b2548e14df0d298777f582bc51ce3592cce2a9921bf13c1bf91fadbd829225272401440a438dfb19f858b876f26616c7e51fa9dc91fbb27ed64379c49cc56256a18f0010d405106ac3b3afbda20b03501af15542bc6ba51655a62ef6c2ffa068618aab67c75bbdf0a0a05ecaa09ce4c61d4c4888b979ca0d27f163046de04fa1137bfb307f969f68c8a94f9e34f646b16f461357a406e8aaa19f39ee55b7ea8c27dfe16d4aee4839a412f9df3b17fe76d35ec73ab7ecbb1098eb8250d540879df6019d33d1162c4be24b8402c3d7ab16fa38c0da8a296b613990f5310f8aa096aab0cbfd6d0051abc45c8b57111f3dbd6e936898d54ea82ba5f4da6870f5ec1a47a52a408b317b185a94acd0ae55f6d2a2f0195ec995c99757115ebf0271c2f5607a67d5e811eb689344b00e199d1941d298812c8e402b574c40eb7aab5a2bcaf505656969db3ad0eb39565892f6d3d707d893989631f3b74c7bd70405d4145d7d53c192aa3a64b355c1cee2ba23e63cedb97717fc0d1249a4897ab36f7a3e28dc9667d3500e4e6ebccbe274361d1a82dcc197c6519ea20f3d60308c3c7f1ac7863b14ce9d215eb1d5711a25060451267c84ac3e491e1d5b05e16513f60c4ec04bb6d206c37eb42e414f905c2cdf17e8e99cf4f09eced7a980589079121b7c4c1c8c5763d9f28ad7bde0b859dcfd3433e8758afe57b3f9ba36ecdcd351fd2d2729bccf3dcc5b52d67850dccac7b60a729a73bdb0891e132bc9fb7becd6b3f5b42e62f90d835e2d3140ba177b83eb0efa26b6d647722c3d994a7a6466db75e59583b24a3ac95c91ddaad9a59fc257d607e68b1473ac384730d7a4c42d5375cd5785b2256c70a528e7457d91cb34ca21bd60088e2d719cc88a94f86a828c8b4b737fc38bae9b22f7c38fb604bf5e83424fd2219c87cf48c8e006248ffe11faf29370736dc6cbbe4363a5996465e19c299bbba106dd60c2bcf6bdc4df38ac0847bd5b7b45596abb2552b991d33e0d3e86a790a4a82822041289ca7ef9a24d7f9e50a522c92a8d1159f07b5c961a6c57ced9c5308d3fbb40fb4f80d80520fb944efca82380665eab8a0029d6cf79d8373c2f19c6ad67d3187766564a6fd0a93b83279decf5cf7f1b0e8df7e44d1691fd16c249bbb9a778984ffeeb1f1f1c97b43446918a4e3b5c5460084e520189fd7754e2a37884469ecf64284c90f481e0043891c07e6149e06d5e8417d06c953b59b851cd4934b1544305f337d5107d9b8ed8ab51d8d4a3204590e65b57ee3ac685cae21e624c2c41aa1722eabee4cb61a6f3d339e30c92797a572bdbffb835ff31195ea8baaa309412fffafda786a8aa310f6723d1cee5e70c21c586cd31199f7446e334a251481d4c170a3cdd7a7aab55803d6852d4f658d129a6c94fce50a6d7f4b8b04650d3660adeef5b57e727225c471fc5982701e7de3163166dd7ad6b2248bb7f45fb4f4b7bb9f239afe0cd1fa8767dfa27555a5df141f5e64f453391fe404f65763d4a61c7fb62d1b07218d109ec4f5260f82d358289bba02968371d238304e90f655a4796b1d1a798d8cf16b41033de70e5f5a0de43c5c9985dc5bea8af4e9942fcb581a1ffbefb4157d08bc515a715d34b6c98c899dc5d4082f5d54b65c7b4c02613ac3ba56ecb1635a67048dba86722b2c85e18145d2e20849c6caa0f7e1f0009b8df99b509ae165f0881aafffa118b5dccd8898a7e080eb9d3ad11db872817614489a8ae437756ebdbf40a4d357501fb33c94e36824dbdcecaf53afde58a06b56c47043b04b222a24d6b0ae8e4e54a12096d334b4d33f98e409b7ce759d4e68ae93075bc25dbfa3db8c200484e5713a7b16a971a914888a92423393c542a130ac81c96806a55d2791836d1ee527b7765d42d6b2e743fa316f899520fe7a78cc290657a199ad73874c3b412bd59350da36700075326a31bbc9bc9cb10ced49dc177eab7f7cd0a2e1909b930f86082000cd6e976be4104f8aafeac8f5700dda794ad334615bfe1751e1b5ece84ccaa037c92be43aa84f5992f7c95c84c57cc9fc485816e3641c1dd12e58c0ddbb1701c03fe10ae4567c4c09c0ce456d003ad10a73a6939f97f54053061c79a67c1d4270534ade18b061549846dc28a3c23bebf086bac36ed237da426c8ac81836416a704b34004e56845ac4a58967eecbb14485eacbefde79d7ebc38679438f1dc24e99cfb9eb6a3adf2fdef3db6be885e8a5ea745d0bc11798fba8b6a829fe19e2988263bc03871860bd09b0daa9b0f40cf54d917b5dcc157e0882e8d60af17d7c23fd0f59390348b5332925cd50542758475ed309bec371ada9b1e1f425fffffeb8c595c0ec16b7348fae37a1df0fc4c6a26ecf734ca43ff8e9ff229255bb791294c7b2454c614ecb83246daa63099a34edd783c67e953630c3a006ce2eaae2149704435e01423023d8bf9088af9570139b4ca967fd53be268458a0d19f87723f8d1aded3c8da269cf0620baa2ac9991b41148e53d83bf8efb1e5817361383e918014d22a1346c7432612a8ee50f142620fb695885896ef1b095ca388b1672a251cca8d113b1bf19d6fd45fdb54907959e9790e72bb0f51d118768adb437fe29a67147494569431175f74142a8d151bab48d3c666888ee3c126415984f8b33877918fe999010cf499b7a1864c3484017b2d5cbe0a438ecc4e418839decc4a6e0ef98c8097dff095c3e3309298d50efa5ccfa96a3e54daed740dea3a890e94876d93467dad255a879c40d100a24d867c7753138de2edb46a86692ca77a5ce826f8b8af37c9331bc4b847efcc21637359d71dd050944b16978dd5cf83372ecf709590162aa3d4296927b0e954d22dca55f66a42338b4c06981842d8d5165edd293cf68e59b566771f49cc0c2c43379dd416b9a60ef94552227a57b06690e03d4581e7426c85e1fb64de20ce08d6cf6e29386f6b9150d41eb9378cba88248b2c6c37a2bbfdbfcd65fda2182257fc440bfb8b4e82801b6589a22510a771dc4d7dc0013904ca7e76f6395b1f07bc86169cc240c3fb7e0e556483bd065c9bc97f44da2b192e784025826cc0cc27ab72a9fc52042f31bf2437a3f720c948641fbd8be238e13b746ec927acf543dd84a560ff2c9dd31d1e519c6426f9472e22763018ff1a59723d2f0aff7d8ecadab6753e368cbb452c068c93b8f4669502c07b58cd8041822631859f2b32b6b88e88904c39fc01567141ed40257a7c2c7bf0f65f81e60a34872ebeec86ca61dffffd1a6bff4aa58ed977f578af05dc27d18f6e090bbc4a312064819f9a38d0c1ec51274691d9725154936dd3ec1af21968be98bb66df81b88f4cd5c602b119973a0a90475789e951b87c4340a26a1f651558f47503b81fd325d7c7ac797e575ac2995fa5931aea4ce9b0da210fb0e6f82698f185d45944c5c9885dbf1a4ea3b3d1ec87b3b09c0444ed7cdca99b62050cfbba324fa646e89bc7a2677003fdffe7f6bf7f8bb2fe2b4935bf58d515f6c4a85b94e6aa1b8a44394aae04d7e73e2696e8dbab2fbeedefbd6e08729ddd0fdf321868bf4b8af070cb2967b692b2176a359d637ce0e39fa5a778c218f1fc13cc429d27393c690f5c7c9d81abb47153ed0706ae9d4ddba0919f6c7fa76957a11b2e5585dd9170ba83312db20f8085cab757c03571b29270ed9e1e49cbfe23c75d3ee7780efd238614f4d1aced648773ef4427c968999627e55819100cc749fefe51f74da702f05e3c6eba5e5e09b67ab34d596012e281d942b974dcee3a563469a6677b9a7beb2530d2d30480f9a149c7836a404bfcf121035222e7d973ab68e720528c91b3461332ee8b119335f4e7558a889e2f136227dd03ccfdef83bd9d8943577cb5ae5d3df6fb55e5772e2e2f1ee53a38e8bf4dd1bf28de31696ebf249a0c7dc1fbd61a5650185708fc547a94e69f86284a0324ac8848ce48ba1fb2283e1ccdad4c3a63beb67edaf26977eff4143fd0dfc9bd7a48fbfcfb5c5d90b1ee5bbd4dabcb2ebf6a8c9e96344c30e8cd9bcb78053491ad2a9d11366da9fc30d21f1ec43954bef4af19b5862fd7705dd8973280630533326cc1ed023a2b8a400639caa0ed0bc335815f141eefca952a6f0b32279ad1729283c6a0eff91098f04e1d815f56ab07435c281320f8bd2b11c1971d9cde9a3621fb4ce22ef7affe3b82a7d25a3823461db3c520ef1cc969ccdb4969aa03ec60f8d0d8539333aa71d724447ca28c8a21567725ac34b9df6529dd80d3a3ac60814fe494f0360ef0199d3b1ef2184120e1bbb6e84ccfb14f105134fa470eb28d8465068650c40e06ad177e5a4fff713b60a8f122ad48ca387bfa824832fe8792969979f10d9ab0fc0e765744b7d71c7027b4211550e619ebb8f5ac3d28214b2de7f3488bf3cda923d8e599d3f5f7e36c52c0c0c144e13debb8ebb4e45542875eb17fec05d3e369608b990f598c18d678c145d99f51e29a7b5aba900974ec9604b0da972800ef11c063f4b8b189da12be34b244de7be58eab1656861b809cbd113e59fdba012cbf4e3d7a12e5b25d4e8b3fed83bd8025c45782600062c3fd25fba0492b68af87e42491193d2378a6ff70a45ac0e9bf8ace500f2d4b172317f1ebf1e91aa2ca27630aca013d9f377428b5c495fc35a405f8b5e209b479294a87c0e4ff1495ae71a454dd9475ce8b48955a37f412a77b1c13d6c98e9bdf62e3b11a901e2f8da61e4a0e800d15673244917108a446d3fde5d197f41625b94f46152b04fd653e8ea60c76e6f0e0a894a964843be7491543b99f3a6dc561664fa5e314467343105846344c1df5e300728793afae80421ca0e14b57e49c75213514ea08e6c414e13ac1717e68bd82d012d52bafa1765b09be3fa9d6f147b8e5b0557ceedfb646b1809edfacbfb6ffea79e2365e1def6e8e428bf62703f8fe27c407f90c7e155de01f51572410369c8207096f26898401516e7922c84bff534f158897ab94e601ab0fbcaf7b79cce32a7012ece7239040d54950d5afebb73713c8b3b37f73f99f2e8b629221728a224e3503e9dd5075dbfc5cdc36b5b318a92cec05014387efa577cb781466bd44ad200653b0927d74a75863de9bf71ddefad469254ea54b1d34b842a802eb1db18356f560acd81961e6020562648958031d61c36d10b2d819b7f30ecedeedfddae4e1c60bbae8777fe0c24519ea720c7e0778279108b2a7c8985c82b794e3b3d372b4bf9bb75188ffd2b4661b96530d822747f9626abca01d274c64f4415e595966e93e636e0e44c433f42cd9fefbaf0087dcd748852bbd5362d532497374dba854eb9bf3820c5d82e2ed521da49de11b4310bf6be420ec846a0923e89bdcd325058b339fbb7c8f6c0e2a1ca1e783899a0d2dc5169c9f8baf8e2d81e0fdcf180a37f5e241893cfc26ae9b28623c081e82fb1f602ee22a68b410eb343378a7a062bf38cea5fc55f138afc6d6dd8fb2a80efcde026758fa3b7c97d5240ac711c5715b741234b458c957673190ed9af99cd1f34124537bedbeecbd79e3365c7ff1157a036b80e14b185d2c81deeea6a064e5bb5b0fbe857b10058d57bb2879e84ded1a47bea76d1c9c607e5741f25df6c3d4d65c348810ef3b4dc7b6c76232b80485c321f99a3dbc3a4fa027b144e9775fa3c31841e721ce0af3b59b0d17b1634e45d323cefd565ff7c71481c2bb356b1ecdad2bf3005cfbac80b9d62f421f81ee805c256a04bc43e8ccf4d9bd0be0d9ba7ea3544f8c79066c801f7bde79869189cd1e555d65cc6c45d2beab4db6441987cda0ebb11933676887da4683a81dd3f1d916bf22e71262368b6a23d83e515fb010d13ff74f7d173f4060410e1e0b4bd2fda03ceb02aab2baf580a1abaaba329758a082f3d92a4e74b896553ffc53548c0d2ee213ad3211c3df43f43d6a113d10743e1f4337863a49b6fb5f873724932c12c4ce7179364a2a54090f683564a7626a2318444ad418c7409f0f50043de3511b92d42089f4a7aa64aef681f55327eb6e9a2b389472b0ec72cf6b66972f642d8bb8100fa1200433e97c881b0878c068fa26cdd15873d79e4756ac5f6353383a99a282b76eef215ea3dd18cf473175fdf8cf776236ba257bd580949b60b51ca4a5ab2814deb8bedfca928b29f4ae7cb08f5f8632e743ca5a4db50802403d40dfcc4dc23fd618b4bf9be559105d80efbbc51ef93d69a38c17382ee83115028a81cdb6e43daf1e6fc589e6073467a4b746874acabcb9eb42973c55ce4a6f7aec7784c83e9e5a0e619842688e6e3fbd7dbb99bf700d0ef17bf519ff45aecd102bcd0a393e2590367829d1ec1311d8de6660837b0725ecef1f6767a802833402255fd677d10d6dc4a915d451853346346f07e9267e59909a4a26a96441f5a09bcf7594747c0b946c944756307bc49b30b6e5e159c7acb0058477dcf5ea6c31692afb70c0bea10e0632c56c7fb8a66a774c09c484e443ffcc3289c31040aee08a265005005a9f498dcbf4f079d602862f66af77a15c37adf2ade6c6c0116cc41960f3bd3f2e69ff58316623bd2cd047b4b27c223dfb4deced799e3c210f2cf66566d9667b41f41b896c612d1bb2ea67004ded2e731a0df9a1db1752f9a1d712abc578a01895056ddc92fbd4ae7091b8430ee0352302df71d1c315debb3580828320de91f4b240709421002cb055db0e70d37854f26083738e5c0c3dcb2898450a203ce6f7138cfc34781e6c9af5947355f3b79bff8a5b53a0b2049badf2597acca2c26f0623f05fe8014f85ad73451f078cacc32c5eaf700ebb1f347266523a728eaa112a5964b2c6f722bb49f202836b0771854901d47314afe34e1de17bcb767553be1f556509420a1251bd37b68f732f96fe1e29b4608a2adfed1c2aaab2160b6c4ebec9aac7169fa61138354f2b9f94e43cbd18c8a8cafc3921eb69afa2b04a50c8bf7b0b17709d646f4df94cdc30e054cf847265f3cda5d1412e7d085b60a10369908f7c22407ff40bcaa2e950bf8620f0f96aa1166d7009d7662f99b01fe72050c1862f4e9f4954c9969afd27128ccaa94e167f8edbc3d0fc0e0d594d9c1e7d52b32944795653daeea942c2170ad5e1e954a239ac8c6d130b75e368d09de73f560de753c3bc6d89083193797cc801fb9304f856ceef0b4c705a50db690912d2f079b516b00f91e33d37b64dfb1a09bdfa1436e4fc0242d5630a90ffcb70da56e8de08809df7375113e91f5cc80a52757bf0eda7205c5feb630e38e96a414a1ba50e01e62ed11395e37223a6c64a3c3b693c60df7445b15c3266bd4a8d74d09b5b415e9f8d280a65e70d2195a4780be1eff6080a5f1e2d593e23e8a0df4b833b0bebeaf9fbd81f3378c53815d9b95eed5eff02666dc893f8a0a9f24900b81a43e0384608be1df586cf77f644869e4637b1e676cec67d730a9b19f3a15a4aa90d1f2347b68e368fe8f8b4d1e98af422075baecfc50f3c3042cc4e9c9fb6a8b622ccc6bf910a9eff0270dade89f465eb9896f311d6473ac9072960a9d735dc4abff82bca3c74f5810bfb2104b8429dc1015c530c9097d0e348e72ed27a715941cce5a50e71d206d48f27b5d76dd973f73ef55589f6d9543524fe1927b296581980d6e8974157621801dd9709692a2412221be1dde19d088789a97a9f7c19f58da759cdf98e7a833e3b6cc21be61c2b940674dc384e80a881e1c22b4bee23e1cd7aee68e0ff54f7f6f871841487c909dde77c13658d9e3b854ad2d8ada71c79081397264116356e06872936f577c7228fb6a1f7c3fe5287b7c22582f1e7113382518cf77599240014c9aab7217417828e7e0e6823908f586eea2e3e18940d51271a1a15f1ac39b41c0840cd496595d86d9207ca61f39e579f962c1eeedb9f5279263684c37427610d68bed7219487ff082d9d0f20f4861e74bedef8b55f4d01169131bc4add43cbf4098df556b039f7a36c676ff3bec2f6c49f57f30b479fb77f7c8b3d8f177ba0cb55dc457e6434a8877af626818d8fc455279976c240183a5753616248718390b663ce91f69db949283f75ce9ea36add44f2802c1f131be66ae1c109a339cfd990a32afe0a910c54ebc588ac7f1272b669447a4dae1f9b81621994ceb289796b7ee92c539485ae8c446d7b3ff2ffe9f21bb839a5e9035ddb9145f9987c67d915018a77132195a7a905d59f2a59c8caf9216c09a4e109fc4e97e7896842237b7006a58ecfe190b7b552d64a04aa9a7fe861af61cdab2575a22d57f836374651707532692220f7da9f88709283fd563ab6752c6ae2431c15aa2f811d562f296dbcc7b7e8a97c4f5172f5bfe610931bb27cc9a483930f153245ba7cd1e25a6149270a221a6278b99cbb8f80116e57d195e0d98ca2aace585cc8a70afb545cd143c773d2e7d18d5fd0fe222fd0f8c0ec0558f7c361b5b13bf6af9b64bbaf8fac4cd5135fe8c09d6a03c0df6eb8ae46a8da00a8c9682853b9cc2292e8a39b25d1d2943eee7f7b584ac37a379546ad27c4b2c3dda4cf3ef2fc160b0ad7a0e382fc9e9aff34315b714e446db04ebebe92c05574971f1685165120fbde5c11206e1861d7aa4ad406689703e2375ab1c5171533d818aac4825144f891ab3ff12973c149f631d1afdde129bca45341f4de3e5665b953a140b43bada07fade7e69e2f0eef9de1b900943813b4db66ad88695194d81b43c34874bee92633603ba20644ac23a325989652cf6fee5a3ff2da0cdab07edb296b30a232e99ee7c9790929578823836aa37661bfca1ab4f305fd605b408354b7255c91a6693ccf22ab3333fbf460da7952e58722ad3cf4466e9542810b5caf5c4b7b2582b5ed3bbb12d35ed45a301d3ea2408debc6d199ae5af1a1ebeaf58ac290a5303518ca1e6c140aa45f7c282c32d0a00f7d8185bc879efdab43b958a63c4ff239ecb84cd5be0880c7a30ab8140e5e339ff385e8eb6cbc8a0f50d866a53253b2b9cee4cfa0c27dc31c994512b5359b777b12b369dcb963561ce99ac5712bb725bb5433faacd32c26c49fd603f258d22192781f79888ea3635ea7c7aa364c96efe4622930d873ccf015378a506ba89895e3c9c136db481b745f8a96e2f5e021596251f1b595222b379c93f87dc48a075dc8540f6886357a05161ade544ef09aa88ddfd073eb43041745455ec770e7854d6d76adec23909ce0c81c5dae650dda2eec65f5bda4c5654d963cee1f552e92ee3e4a74f131a13858ee056d711e962609d6bfef5ef1ef006039bfdda4630e2c77c822b5ac46c8a06de49cfcd1ec18086d8cd49347676d6ff112394b45c8bd2f38ac771ef25abd682fcab4da1fb7658a1512325ec3772d695b77ec8f743103d6005f5c4d2d8f847d6060aad4296debe6d9d81f2918db1e77ec8bf761571a265e158ae05976a12ab99367afe17af81174275cb0c4b7f264b1ced32786a0547121030a5b4a2509319f08ab6efcd6f541c8c17adbf0595660d838e61335cfd45b4dbe25892d92ca638f5684d2f80598cfa707bb5077802c594ebae607ded0299f301d79dc7bd19c63c17eb4c759260dfc4f9cda303a659ba0d4a626695cf4cc10c4b436c158973cf837a6f052508a1c329317f7eda47c16583258ff10a9c9e3857b6cee6f0c8966df3e5dd5f78a97cd052c93ecc42add55b1d6790acfaaff046d2e6045d463d0072afd5712adac0426bee6adbf46eab264f003715e7a51b3cfd2c918b5b408ae1644deed4013680fd75dffdc1d733102de7025cc8080cfd87f9164ce66132d77172d0994674edd1edab6ee46402b01ce98fed7af970f441639adbd8ff2f79ec2f798f7f7ac4879ed81f009abe4bc281b92017c9591dc920bda6b62ba6edab630ea2730e516a1e3052e4d925eafa4b4404c46c0c770ed87eed1f9c869d778af0edf9159717a6c5183b7f7f004ed563211886e260805e13d900bf81056975dbda9c3a91b673c775c0f60c6d1bb3a6c90c4809034c67bcafc5873b969c2cd4b346bb8a210d9495ed815d70f081f8d72f5e4924e9f768334a8151b3fff38056a13cb822120b99f9289959732516356a5a94b23c3fb3b90af03e689983fcba483449db24a750037ef813aa703d8648bb7191d04d4ffff48669c78ea06e4210e2d8a5913f1cacbc7750655c268f958e10e3ec7f5028d6298af45c8634de61e7eb290f27b91bc95d2d23078c511c247d4aa0e2d03d5cf0611bdeda1dbe40d4afcb5744480dc19ea90773bd8b94fea6f4c3823d886a2a33c44181f99c5cdb4f6edd9a4223e6cfce8d438e859d3f4a0facfd13a1f3b394182ec02e112aa5751ff5f05dc370e77a24caf1dc41f236601b63d63017188a44009e3b92f497e5aebf9341b7bcb44fc3e42772b30a0d2724561f98d8683d996c76d6a407673a19e494559920c39ac009143c95e74fca616609ce8360d6277fe988ef3555bb18bf4392f07617747e66b9becabe4ed692479193466601b6690db08dd496dd024d146a26c1f4a8f538b09e9ff132d51b4cf0ac02d1aab7c6f849c0969a70a22833d890a545ef055806d7b769de55049aa943d5724dc88a397ad6b95b59653aff07aba7935d5b6665b1925c6731b0fe70992874b50fac3285e99b70f25829ebd279f66712bd77233970de503e99463f73990441630c2c58a4944096cebc8c3d0285477d1e7ae7bb38de31f9261298356eeab5f3795298fc38829053daa73fb7ec2a147653309f11badc12b571a381c0600d50793a0aaa886514f61b2b35b76a4834a072ef7c9bcb18a8b911c572e851941fe4d47478ab71df541630153fc9433f314589c5f1bef7acf1c83fc54f5684079b06f7e2b48ce2c686545ab1c2829cb644b92cad8281c6730f9a6e874dda6650b6fb9c260599d36d0259c2176031e57b5cf1fd2742f1fb90fccdb743032605dfdddf01a4b800b79b651c1fda75b0aa4099390dff0c8abb09f91805d8fb2528e842faf753b67387eb5473e23cee22f2d3d994429a35184e648e33ecdb1f4da19c4ce2875ba012dd88fd000fe67a426b34de6df06d15575780fe83bb0745826e332f07874e66b863780449d8dc6390c304a1b83eea5504d9234206f4c58cc812c0410a05546d4659f526f1af167358ab60ab8962459444582902151617fcf83785d6ba5b8d4e807be126d79b7edffbaecf026d7c3f6953e1b687e964a778fcc0f41ee9ed0d4cd7785fcac227a9fdb96643e7320b20d646b73a78628189f0057d9d9e9493ff52a04309fee28e144ac4a05d54e301c72c038145e2890cb4d86d57bbb078b138f2ffff0e188c831c4dda01607d99ea4e7faf9edfa4ce2911a060a0d3ad0f566f8105882178997937afb8f99d64d73b97005852b92566060a4b80b21ed312bb0b013f1e71625ab310a4c6fd1b5ecfd4469e53f10f617d668f888ac2cc8b859cf8ef886b56f4ef481b74910fcdb649c508a7f9b0bfe280887d143e399c21b54866b1c36b879b0e8258be8287d277f9d8d66966b340c6bc86cfaecc60042c0b4f95d05427cb7bd692593a0e7c927f4c6b68399f90b5de716a6b880bd427764cee39facf530cc0f75cd36958ec6e82d7ad9ea0aaf2941a21b9eb30407b72b7402fe94bc255f2a126c6b16a6afdf5f77166c974718bfef502dffd31c1859c1c9c96c9dfa1e3146f973d3072d8851db8ba7636cf2d12d26a502d355f9528588d98b671350af76a3de991f5743e5d6815d7220ea7d0f53a1f40a26cfaccd4eceed2932924c95f80f54058d0a20e4e5141e6848163c9de97ea583778145719f1a2ea7352855bacb82c4c1d701e44e5b373fcc7c9a7f0921e24b825acb7ec029765639186604b51c81a66ba7e71be9bbc2eec88bf47c7a59b3b4b1da5fee43a982f1858bddfb64d35a2b5d489f0e69bd2bfe4a39fedb8340d8755f8ea61ed5f9881214f62477a5351a309e69c24c4245630a80bea2f7212aee92bbca22c2e826cc119ca1807b932bf4a0ce115e4cd4feeb6474a137d656789bfd17a9c9d3a550e297497f30664404187affc0c01d43b460ddf000ae6ca06a18896a6e861dad55da2928fecb1320c305b845fb51a0231462a2e58df7250854395550a4e74a8be80f54e8f682c5246bf5435dea2cce8d248f6ddf038948b82f7224150d586e56083f485e968630a6b4a5ebdddafa06584014ef5a6ba139e9317c8d9761cb236fdcd2313fbb6abecfb15cc91a7fcae458a131bad56fb6522e1a8b09965b12d157ec0fd5dc32da6b96d1570be012d7fb264f67233d7834f8f0075ddcd9c9f8fe0d84050f9a2537eb654d55e09b919d5311872007fe1788567598fab24af08b17c26fca54ec0fbf19e0f66c06191756008ce3ff2f6a47d3379ca4227b364f5221b216ece1913d4d24119dc34b0f327d4e6f73a24b27668fd523248084e2531efef398fafc00d8a5cb329a15cc0a8e35dfd8d9947e874d6ec1f6a050c804951b9be07064d2bfe9547897cc7155354e66a4d1749e6a814dce78a1874190c037b6666ce8af5fceabfe0dfa0e216209055850c1f9fbbb7435ba6c1ce5860ee3b532ce2857d66071cd854e96ca4eb36c524720991fed551492529f631daff1601de6edcd1b3d735fa43bee5056f8efd99ed2634beb7b8dfc2d474bb21944bdf735f1f6241d22c3ac02fbfebff249a4e232798b93f93528c7e9d23da002b8c9e2607832c50bd045fbae43539be352c8f398e1830529102b474534bd322347b9035b87febe4dc8def5987b084c5468c70d9e5ffb7d35bd817085412502cb4aff9fc7b332be0d507e90bb16f898f7ddf653ffaffe3c383ba3544baaf2f1a0446308ece3079467e11c984eb32e0c651db8b2bca1f23d1691ed01341ce9bc7e931e7c179ca64b529b9ad4b576363f7d9e7cf360122d7fcbf7cb0b3125e5429b066798951d77e25b7821a7c0d5cbcd07764a86381b8d753e40da146144c0115c5eb48fe39cd4d062f5d05910d7d0a0625f786aa02787d67ff40d7afb3172e054d780b1520316f757e93669c755f338af64e8052902a786668aaeee88048d67dee193d9001b30ad072357c28bd0917567ed41cb789c9038e2dc088d1cd6cbf5eecd2f65f9eef7425a4007b6c3c0af76c014df001e5907fc000ddf4f3885e3414b41faf4a7ad4ed0cf45821ee7e54b62300dbff65b0450c3c893e599e0114ae3f8a4080762a985e53c76214c88018fa9f369cf703750f0a8eb3224341b15ae0447cfdb8929ac6c0d7379aa3374540f3eeb02d6a2b68340811529a6cd4a4ce9c98b974a47be3ed65121dd4a242ca88e4345bd821ce9c951d4b4648d4e749a058cc404aeec1954d36aaa01fbb48b851f0e7be94a2400248a1171ac50bf8aa12d077fb5fb42cdd7b4e1091ed57169b9f709824c8886daccb921e0327e54f8f55a793bff6436087524fff12584565e6f6ff0deb8aecf4b5d4e783f2a188dc31bbb90827ce64d6a5c1eb634b75b112836b4965073fd25608128a1b0283230a9599c77c634f1f958de5022346548f9955dd44f8abf1712b20ff8b3a5ce07118ee93b5d96878405d8f941b6ab6a49d49464a99071179bc224dc1c49b62d4d41f485abe3dc6b8e314ebc8317c0e6109e3c1d26032dda55b21be2e434404ab746d5ef8eb1b3c13c990a92c9ce04d3cfb88213c74103201edf2e836b9f39a8b2a34ea61322bbdd0395a35f96173d01210f7db902ee18de7908dd83ed8089f4a430fed30b9827460061c9b22881c54175aa37a32f25169a18e1e4d455ba5b44d900f945fcf4ae1b96a19af4c4e1b8aefd9b215da1b14080d33aa9fd38f994e1619e8b512b944da252af8b6ac9246adbc4f93f34b1e9b6abd6f0a19aa2bd55574d899e199393e760369a1edc6119afcbddbae12fe8d047fa90c41f28b4d3e5c70f7909a4c25967db0bf9cffbaa524d7e1500dc7b8c2a14927e81ec68e0625d8e6d5ebd58dd844e1bd39ecbcaf1979a33709447fccfc53fd4c3a68e1623106eb43513c751bf58e36b2378cbf4c5d11475a25ddf5896e1d89065d91f2c61b7ae5911bcfadeb116c055e899356751688e4e4d5469ba04286aa109132b53c803416970f6564ce4612c605fb32357890242a3dab5391f4412f5211bf299fbe95492ef10f35b08e24eb067a4a173e7b31367d707c93ee98faa9df19c3eab52733159fa138320d1cacdc2a73e100ab92c032e4dc63e153dcd97bd5b2aeb8d0015fa0f066661240f6dd7ebed322bf065029468af4162a10fabb9c46ec5c2ea1676ede6ef7f87217b1c9cd696bb981724e117d276d02d2fb8dfe6788782841b859bf3943f97d460a327af6f903bed2a673073382b9291faebc673e94612a302ef32e3ecfecb6806f4582b0c05d8677fff00704ddddad6441d8c0c40f1e8739b0ba8e4b9142eef879e1ea29bf97e318fb778968afc391f444c9513138bc1228114d91689d47770249a8b1f57ef580c63d9d70139dfed0ea0814cecf1f33da22253f533bb93eb92bb67a83d2478030c5891ed933c01744834ff680e87e064b7222b9ca6d588b2bf3915cbe20cd3b4b3ed094ffc06314c00674d1974e84ee25f07935d9da7507e3595f6c65359061b8b8ce5fbefb28ffe71d6414f2706a49adaf65a3322956bef11dc5a85ee06bbeac1daf609d874efaa437cbfef55fc5e76c23d0b87bbbde3c80991426698490a6e016b117b30075cf4dec4735c878ce25d9a5beb8d8f6228c1433da9b7dc6085d099f56a2ec4d63f2ea0d598fa95631df3fd8403acd1cd1064e4bdef317b91bc36d760c23a49779465f7d982bdcfa60c52daf942ae2a73cfc28106e4473ec9200835aa1c32d97d125cb183d4599423937182022420a744712aa101e929f81bdfdd189a33a26d5c1ee74de4ba5dc66d5578a67ca5c413df84fe5d1237e6cbe223b2e47de883a0b891330b0651966f5c087662662efaea7b818ae0633af3a94eeb3826e2cbc7527d42d1bba81ed61d005209eedeb8ddf66f54f7a5249e4e2cf21b92490d22f4b444df047c16c8645cafcf296664d0bcd767a682fa56cc088f7305e3d09bd91d34378b291b55a8e971e2cc811483cd7ab2b54ead6d9e0c75a7331ffe956490f8db64b111b45dbf533606926f731c22416de547d3cbe94f0fb0c885fa91a72c5123f123da33dc2214aef3d521b443eaaa27e0df385198af3a1e467b0feab7dd79f8ebb4ce5176b97dfc4a9edc7ecc6d6973465889c4b63b5d790780893b18039f7170e9987e5b11fdc1265253aab7e7bc9809c48ac6c69d100081f0c087e6d8e0a13b67e55c015b9e8fc5afdb00bbc6a1b0de8ae2eeea3bd99cd9a075227077b0e9f959169adc98c1cc6b2654d0f310a1d1b56a2f0dcbbdda1c435bd7d0696be2a192fa0999f1b180dc8abdb1322d624261b98751ec793f2e432c628785773f7061a50b474c80dc718e010f4a574805d662e6a858ea5d7337859b59a06932443a4379d71308c048379e01612a72e2bf0713980236ca4d6b4c916566c43634368ff6ce7cc739f587e6e30cf1b704ac66df7e07cfa25e63efed1b91aefc8472fcb742d53ca513796de504405e0c8f0d8fb0b70cc144ff25fc5a5468587281223baa69d938dcb401914ca095e8ccad6899abf49c1094b61b81083fe1f82d59e0cef953b60c2b11864f771702daf748b3ed8fde7763e42a0a831cf5f8f986c2fafa69539741cfbbd9b2e8c8fe375d878b17fd44e87941ee7f2feaaae29eabe38c30279478fda6d6587beaebb3ab148eac4772740b7d1f1dec1dc3bf75a662a3cab7ed3d762ae15c301d1c1a20c324b996a94ee6ae8f4c9425a7fad4d9dac5051aafe5dea80212657d74cf44240b09f631a08e5c08e17abd6537c720165e1055024325a4011e2cb6d51036362d138c580d169eb2cb84b7e65fa44e23b3891fe45ff1f0abc461febb716b75ac219de1d95886a6a36f456353094ebc72df6abac017caf0f2cdb66ac25bbdfcfc05d1ca16f57d32fb1fed0fa498561203cca52f56a23eb9dd756517f9904935795fc9899c6f4ce7d7a6b52e6d85bbee90db1dadc2487139f45dcd5130f4168f8533d552629fe7f25f8bd94024ccd105e913d7628ba945c00d7cf57e1c8572a5a50737e0b44ab9ab1fc2f0262593ddc8df445cf46f6159fb13f68f04f29cd2fd2f5d822d68c14ce27bd157f636a7dd9bd3088e9e816d649d9a5858d9bd1e360a46215df9b72d6e306f212851b2e6c2c21a33c122df3a27cf648788f2b334241fb7de3ca48a2fee7994d11401ca7ca7365d4b02eff49e38ba9f04ab3520716cc2ca84a6aa6484c86ce1ad3fa39ff6f1f8051edf53bd9ebb84dba9f5c564db69b03a31b2e279e09a72a04dabe082f09d666382d84cc6effab5db50f14e026f2d6bc5daa4c22861a1b9de8a0b64d339e49f6032aab5cf2863cec671fb812bac52feeae93305f5c2e479ad71f1417f23c7ec10b1432ec3b29d5af2469a8e93a8d1e29f57615c1e730b470dce235e26d38404339dac3724deb7817d65c6803e079e92fe537d3256748aa6997bd38cb442dbd0e9e851dfe00a7cd994c43b13e250d5b78e82ffd80953497a0abf447e21a3d785698d596a2cbb26ea4c01e9fff91bf185e2dc979ee51a324a279a25ea9ea332a0408d6bc80293992e7acb2d87726672fc3c10c860b2512bf97aac98e513a1173ca5fdb1624a22a2e7d41a7b4479a110dfbcf51cd28f119bb9a4815bca54d4bda70a1c0ed81eb069669e4cb12303ee8d78332fd53f89e18fe997519ab7788d60b6d31003a8a819ce5bf70c11e93e088c2d6c6d67b961fc73b7745d0e884156a5b8118e532a1c609ace3f47e58429d8824f7d5dcaf810627829dc5886237e82e7880795ecfabf08389e0c4103c6734a5feefd78db8d8aa221d67f90ba6a4f6e91500503750e8e1c043439ead849be057edb8b520bbfae73981226076c6016014f570f5db1c73d8f8fc466b4083ee7a7892c34eb16d0bcaedd60e61356b9fdd94e4edef52cc5764a7593337279eb931756bf782d10a96a0639eefcfee5a3c99599a8078ea4e37f7389e44edf76516b00367e14a4a10536586eab5f61afcb2e8ec64341cfa78c92dc6eaa46a805a42931f4bfc1b6e7c5522ed270989e5e371442fe7aa737911ae70fb47a2d0fe005201ccef66ba3dc9f97e97166ebb4610ace41a16ad0a770b3561159529927b1bc81c781e9928c04c866e8ecfa5e1302fb2b0b15dd99772dbfebebf96d6196d96f17ca0f80e5b5782137303d2f431adf4cf73032a04390ec036c533883c79ce7e271ef31495a7ed0cf8173f2ac7e9a332dd997eba8d1b410ca95653fbcbfa2f9e208e5212e237f54d4ae2f2fa667078e76c4a4146aa9b22efb60b0172ccdcc46430b0079c8d1d542a6016cc27ad6b72744d415de8aa6b39828014019a97bb8df263012f80edb50d7e8524f2841efbb817d4627c92dad7188624e83581e200f167d27833d5d8b7e3bbc94b7c1a9c7ccb31e90daae2c665ff9d9b0c352b1973c84c2f5faa6ca5313e01a51b69fe4fa2f43d79825ef798bdcddba7e498e7bb4447f6117c4caffc1b17a381e0f6f041ef380ad6f9f0571f74fca4a2a0790016661669f09a8bb95d031ffa374a8905ddc258f5966ba13d8c92b929113a04aeeec774ace41b8aed94d5f892d6d9143450a9a414b1778c9c69b241c11bb38197ea7d3952bc5a2798c60ed270366b3ade493980097c14da893404626200747cf3465c8e0c8db40ebd79b028cb3d5dce97d0a88e70596219dccc2df6d040aa114b6b085da551719c7b16bcb60aceca815e20ffb4d622140eeea2afa0ed735a5a7a852e9e4533c1d5d882667099fbea9168ed95c5d4149442b0d60de87fd7d86bee7fa864557c1f8404ad596e8423562049b222c1ba644d59a43d5cd175cdadbf7b26f43597d8287c9a5d6992ed1cdea29f1cf293e75534273be770515e0ba9bec7fb29399c63e1b7972ba6ca58944d0cf3a5bff1a2ed23d1ff068e6437334f1057b9fd97cd3e0660cee8797f5718654f69cdfd908417d65f8636a78b9c570944b65810de3ef23a71036a57538b740841d1cf6cdc376abf36266aa5ca046207b5077afba7620184d016c4d9f00efada2a5d2bd1042da2901427a453b96f78822184f3fb61b338c2744f5ecac99e58ab5ab7883a32266f7f79ec080593a2f975e1f812842049d5bd02f0ce3d82edd36d5850a40a6ac2c9a5749b6d33c916dae918b4cc230dedaaac388c39685e5ed88fa6f4e2b613ac8ffe73bb1c13c75015f45a553889db16e5d08d2cfa5c586031bfa671de7b5721e95ac27c3b814afcc4da266310065055f39714056c52304dff5c82f6a9c19cb870496b13743bf4de705005cf3edfa20fd9ed4c534f36570b1cdf3f669fa12dff7a5efdddeb856bda999c118eef82c0ad9f7166280744676c472e3e6ce61e0be0b816e6949f8517337772fb5f6be1ea05a8463e0fccbb29e8896fd6973ed62ff946ed4e249eeaee6d3d128b656b26b44e9f33b6267c2356ef08f944dc0d5abda0c371d2753d0b25ccd7d80383f0ed320ae466d7d6c0348423d9ca2d204e9cf49cd6aec964e5a955fcb0a846af219dda011112193071d7dd9368b8bc4c35ee496f494307fad85b700bd6c838f17323db9d6656d0b7026d6cb9c34e1d16d04e836d3f87a86674ebf1b60a80fe679d28d33f5b873495e0bc1235a51ebccf3aa80d689c655271250f890569d5177f49d9debe530a8e5bf2ee1bb0ee32e8d792dda4465c32c06f02734807a206d4e63bc1f4185f587b03925deb57b373f1affef851be554a4ac53b59c6736d901c9c5eedc1d07d91f34bd18b112fd0de2e683e8c3f84ef78cb14bc21b88eef59a3c17accca699403a80f17396cdf143ef057ea6df6938d87d4ccde419194910444da11e055f4da481ea9398b966bd2b36632854b0ca878cd382024b1823465d36d3c483a79e1f8b032690e9dada776b8729d204322be9377719b74bc0b88568c6f9590faadc33ea31c6462c7de12076d7ba30c474ba41a8c1fc9df62cd55077edd450bd1b50abbb03a4446d88ba8d39bd9e648c81972376a16a0ac9e03a60d0fa2e5baaa91991494487cae2b1e83e3ae70957f40e89ba3112203b211bee11a1cbe25b8bd2bd716bb3a007f0ba7b3ea53d45306614a062649d199b712012d9c649ab6b445b9b4afb0ce8a38a9f9daf340ef121ac27b605b5bbcbb00116cf640062b118e9276621afa096ee0c46e499922426ba643d0c5ae38e0a576d550de4feb21be0a3b380f40efac31e956dadbcae9ed32fc7607ccfdf052703f2578cf348c9dd3903acedf623bfe910bc995184d348b793cf3308ef6dca0dfc78f9dc6f076e3fecfa910d9838dca5a1c1567925cef36fa1e31b86080c1313101461bc635e80b8cac4e81a415037d6f22484b694ca7b709f53069bd17f750ca55b55d17cfd4a4cc37dde97f61ce3d00acb5dea8724e91675862d0bb32ed7e443bbc6f52764cc59d67622a0e9d8d7fc190dd2c8e3045f89c5f5fb624c18acb516b64a7538c0f81b9b12f32828ddd42903018d0b3e29a9d08938d265a61c66fc113101485e880843fd5c10ac099a002a8a8f1c36d0b8a28cf5a59781ecb2315fadbe79809ea59271210216ac5ebf6238e528866380bdd8068385909da2d005d0ee36c991250a854eac160d5cb8303aece94c5c949700b594a09af17d21e8cdd7719eb265fdbd4ebf11e3af4b89bb4671c28bceff4f1eb43aed3ab6d2775a63ebb59c8aefbfc9dd90e9648d740acc947c1789c6ebc7c4448530f4b655d5330c1c6abc9e4385de9f90b5eda0b52193976b8c6c4653b9b16cacd954c754cdcd06910814e9b0a10eb409114c07218a5ef44ccb048ba0d104ad0ab3c52a7bcae8a5fe812cc0ede92cda354f3193896a07d2c67866fade725c371bf99836da4d49e5f124f36437da65495ac2e0da4ac3fe81be0af6ebaca99fc0af795acd7abb4da5c3f1669d540323e67bf0c6ac4eaff42362353debc1827d312e5a52446a1767ccb8d9db90092f694610eed6340b201368697e0f2ca8f733616dde99808f1473477cd1cee96e2b2ffd28cd0451693fb2e0c5fe7bbedd9ae72f56164a2e3d8a997f1f9b7a51aa6835239328a2b764c1f9639ae2ece6b87727022f67027c4e1456c97ce0c125441ff75e69fdf20431ae0d45354c44cf605e2f5d25fa13219168973e73aa6fbdd5d2bab08d4934505bc1d7471969e775d2bc724c1b4e050e6f732f56b96c7a1a0365e38515d2172583cc70705fa47f4040f5f5d3bce9cfc1dfa8d1a7e1f0745bc63ede1f73afebb106a74f7092d4462ad29ae2d60b0e4ba83784e619b2b5541efadcde37e1d670dd2b33b9ff3b902d9f09a2467fbe120a126517c8ad15850dab9d8bbc1ca5722fb12c6325a01e8814b29f04067eb41edd7e60e1147405030068b425c04db8f4da24ac88ebfdc8c227c59a32ba71c550c8ad07475cdfb7dfb2c262e103b41abdd0368885ae8d9df27b9c6160f63370cf6e2ef8133c6c67bea2ca520f7757fd8434339e52e501bf8c8eb94188dafa729e1f92b1243f99aefc981727fe5e2c4c37c6b0d40dfca88d5c5b5276f722118d2c0e5cb318b831ee1ff77342f93c50ec41661d66efb29208c129a2e4ceb7ef18940281c5bb41cc1f217f18c44bf4d1d5ca885230b26f8abcd5910c6ae40e73b826f81bf3ee6893850d361e38752433e1798ed550e80a3410f42f37ed37ffae4e3eb8c3ba4e61ef133a3800d4ee812191a4fafe0fe5f343fc816041b69938ec9a4767705911543dcf8daf5782b049c86b44a04546740377ce083aace6e23d091e45b3c4d8fe2dbb9ff60596d8db889515638c46ff57034ec7d4d897bf9b8b82da62b78028aa20809ef70587eb2d9178222f5acf4fa2b84ad8083cffb15129322d9f9fbdd9aba2b95ae27b497fd9164c520d2f8d3a60256f051756db07291fcf763cfb170ccd8c658b5a4fda25924a6079248035d711c842b6606c8d721975a5d5a3ff188f8882b5c3af282b8c0db1257abe4f1d86e92d172de93a4fa1309845d7a8683759ed05666d3497dd4a4ffccc8fa58422aeb61f7d6b67781b09e41695c95c83570c06437a63b81d8a03b627b25cf94803baba883628bac0dd2af5525280dbe52af5480020fe753508a94dd5ccd457665861566cf99b9a2b0ef37e2a6c9550083f45c3a60244160e55bfb1963f91d6baa10c27d40bea0f5460b4961df2aac40e52984345450ec8b41668afaf2cfe17aaa067d7bb3a8a0a4d51ee4ed508b573f4b463accf1cfd6a429014a29f68d0d08dce763e0dcbc534ba4733ac16fd2f1f62fda36e8b782bcd9c95c16d66c6acc8d2ad85930fbb42b162ad08a147a9fe21e66613a108f0c3cce93fce887d72a9156c764688f72741bebd7d7278b69b531adc02c4c65f67eb6f655ad111626dadf0ae40577ecaf9b6171b034a8bd9b9ace051f1038838ce48ae58e3f1838f53b4de56dfa1b212f55488a088837170ef31071c2a2e389f6ee6f61521cfe9fcf55d08b4f05efed3efd8b058db7ec1ca19c157009622e27d3ff2e5449ed8c476fbe0946c599f262875835184db2b61a00f75c16675af206e5e2ca8ea047aa2fba533c053c94a4d444067a52ebc2b3ceb7128ca0b01bb5b98542811c91a176bd8abd2608759ebe71a27b31c984beac1f5a74fe9c44a508d01bbfb153fee517bc83e850f52a641c3443be5ce7d5e2c881ec16795ff885f5f116eb15d4c0fc1c921ddfdfe221d183785593c8818ce604eb78053e08e5b6594ff784efde0a34b68375dd69f0cecc5efa2e6b0cd495cbf4d562e4742eb0a23b7c8c521bd5f9b8250b8f43a7e26132bc215d54e626f300a6ccbdbcda2384b185c62e7eb485cfdc0d69b10454a11c4f15769153207da4f76a42b40986c92f35140944ba0e8359f94127af19404e2f1e675e986365726a6b1d80c110703a3947f08438eff914b48f9156dde8e2a20d77380e0c4fecf847c7c371a6cbd0f95291eaf6f42ab6fe412ba4ea61ed15191c1055f0ed965a9aa6d2963ab3583ffc76af9cd32bc257f52623cb770affa344d0ffcbb9e3300478c80880672030a2c284c63a9f9bdbdbe5feaaedc4bd5cb3708992d955d23a5b112477e3941d7ffb8d26570ca19ab221459a799c9469f9fa0e487476acd6144162d0a131fbacee057b954d48f224bca42692e82361daa7c460932711fe47730706f12366d0022ce422d98739d5f4a7d160de96673c4de836dbfa186db26791cc71ec675e8515e3125e8fa8a5c3a6d8c4749af27d49329ab9932191f259c189108490aeaaa5e5bd1dbd4fc3382251e1829e09cc27c8875825909387357c3f59ecc182008a30e5ae5a550501caeee120e8c9807ef2150c794ff451279cb7da8a0040276a506d8821cb5355773aed3dd5c0a3f98846e7a1891f85404c16235cba3be21777c7701d9e9df9942dbc66343450418bcc30a65488efcc648c01849ca178ef5ce20358fc14577799cd8f31a7517c231c9ec9972c7146ae2e2101d3543b0b0f89a44d313c188e6aeaa80f8052c398ba3eb4be64485e0ef31c4f4eebc2bf7541705445ada0346b8153060e73272895c43ca888b5ac8ed8418a0dd24cb6c9035049a13fd7293ff979f0692a22f902a00e29a59b617b979739676d0bb12703c6c9528809932bfbae2db41d10f5d345552b8fd959bf56e3831ea5eb7941f743ffb0cd6512d3c2762267e0d814bf74fb47a42059aeac032a4de7704f35f0f71d060d01818c132600340660aa3df9bbb5381c3c60ac41f00a6f4dbd4d39ce6a072319564ba3e9a79602575d71f5f52e15f29d5140dfc5baa2dd15be4b586fd5aa8e0855a75fe340e3c60117dec275b94a04d2ac3ed3534bc3ccae41d9ee7ff0d64c5028600d223fa41ed323601749bb443d4a4917a824cd8ef239eaea2e5b2587f597a54582e02ec944bb6f765a79b54dd7f36b57f4153c18898deb3af38208771055a71b69413c02af91f58916c9357f22e957f7b00bea2d3776c875105e59359b401929f1faa576c2c135694c89081f7f46b59d5065b2d4df19d8deff5717ba54826da7af2e0e0c7fb5dd17272a1a3780b2492962e959e41c8c8bc8e93ad11c4d2d636e57cf480878aebf0c0c5a6042585a939f4387c123adb901c7af22f3e086553e83a0dcb572e57f3f677a3795a4403cb9921a31c3dee325d8933ba8af823d78bf72b2f058700fcbd96dce08660d31638ccdb24688ec1009160c0ceca8772d40d1903d0eab870e93d59c48cc1f1cc84f219c2fa2d5cdcf391bde80f381f845ec17021b85f6723db6fb0d63f33e27aa0f05e1385dc58df552d0a215b0d60fa23b029ee20050bdfd24a3d482989ae75c813f4ea6e5ec723a2d93188aded6d1e0b75bcd136aef76c71412858ed20958b3a0075734454560acbb9690bdb7889b21e06a31e799ec76fc741f44d6e16cfe4722296ef3b078e04047fa14a16012ddc0e30050d973e53ca862cedb441a4f0b7a4fc4cad5b54c35bd04885056ebda04f294ab10eee42f7d4299c4127ea66ac2471a597e476745a3001d97df9b39dab381aef3e60f34ffae1b4d2c93f3fea24b4125408a1955b8cf207326ea1d631eca349aa11978769007b620f0b22863c553c352d2803591866c2ec6abba3f9bd0c694e65c91c9c73b9e4ee78ea0b2c28c927dfc83222242f0710c828c19725a21d8d759f743d2a3c31a2244e2ae51b2f2bd157f70d686b9807a8b3cb41f9ac4099e16e8340851c2e893098493d716baaf2268442120da1006d65345efcd7fa1460585dbcd47e7ecd7119ad49e1154e794e0fe7ae0938aafa60f2879306e7ccca695c481b3f7d5191fca06c25cfc20c9098971d692351bbd364e9d85e93013623c450641f677f5353d8d42354bda2df7ac78b3fd1157818df16ac0d7f35ee755df4da8027cc64ce5c650b61aacdb8eaaef72141436de1470e829c785ff9a3963b41bec1505f5a253dc4c931515588f6d26552ed0c283eebdddb99cb8ce471a25d407625809ebd15771cd35507d8720639110b706a4054987351c1bf071d5daaa546deca700ad7be2fc5a6f0d7cf23a7d3a6e80a232404030dac65dfb327f46a211bdabbba037abaa4a76c22cf69a3e9905587ed3a59ad82b7e52e65cfa3522d3ef2156251c5868adcd5b1b07927e2de8c1fd627272adfee27d202a10fd62873cd9f2ca9a8c03221c69a9a547cfb0f944c48ec1dd38e896f75cb746460a65eec7fd7fa11ca91f3ddfe5164941b61b06e07c24f85398c29d0d7818a541a7daded454b09d73b0e327b42d3cd7ae0abaac27368585f77753d0a3e246df18db84bd3adb17c0217306eeb97f34cc1c2d60c4f5366314152988c39b362174ba16753bf48126976829b754e1ece612f6e1d8a32138df18839d92d6eb90a094084d3728f477e39a75ef4ff9c68899826cd44ecdf47122aafbb549c782e6e201249038e7a298dfca0431bdcf6176ec69bcfc5be492a5a3458345ad7e226f1af23dad134ae9d5303dadcc5460f6d0fc7ac81ec6bfcacc6bc9a73594f36135a648f4ebc6447a05ade5939b996c70b5d8c4686d5a2ae61697e750f0b2efe905ed082516030c525f177d28a8e426cc50f18b167105c80a139e16e1abbe8ba046d19af6a362561138a67f13b67df78e7cf990ec821509bad3f4ea465f3b493a1203d9825d0fbb7e542e969bbb03890c05e27c99ff60dd7a5967bbc2bcab816d8fca89c381b917929ecec0a9c534007bdfae68aba92229b56732cea7c9d7afd5f45b1cbf122e0435e613a099101937208daf471ad8cd87b3617819e19d415c3eaa7a99cd0920097e5134c79f01269dc9d2e91363471a8a9cced6baf957d9186fe8da48dac57f2a3c32b7838eea8aaae40b7ebdebd7676a30a607c355c7b26304479056222222b01e0a5e5d01234c9e1016307eadc9beb31c0abb99e743de6464d7e212a3c2d952de7b74929cf3a66a01327eea2740cc1ddb0a3cb51e018fa1f1bc3f199dc1050fe37efceea7835ecf6a65de7f27123c6d039053a86b6eebd6558c05d6242221ad3b7117fb0ad832c0cb92b468f68dca5d1273b840315e2e68e7ae8bd410421c303eb4b3f75193a8ecec680d7129ba1381c0aadfdf97da6c626766f6e72874a1d1d696e46921a82dbe9c48e68db1900f58c70815be3bf13005a340db4de95bcd1031564fb7f99d1147f64ca9c9217d4d8cc221bfaad68a502708cea737de0b802ffd45e8654e695c0cb7f93e68100f53f5d1c85aae685ab4d73ac184c23fad081b7db07b9cd743e43341e8d3aa1511e2868ef47f5a570d0f510771391bd6be2d623e1034026f1b9e66869659efa6f114839a09d808ecbe6e77a89d4eb8daa08ca908867ecff260129082d8b1bb1200516194709719ded7e69f9f738ad32b055306e9b212938152d008d2ec6a21ff24c1ed26ed3653a1ddbaab71fbd51132cc1f7aa0029d34da2fd090808fd83ce16bedff8584a3f4e7ac8e02f1de29d5ac2e110517ba707b8faece3b4a4ec50b8b1c86c6fabb6f4653c89ff6c906dd91ddf0b7b9b96e124001d8e5e1de6c28680f871b88e1321b242c8b81a509f31604a91c11c159498aa0c9564afe4e36095199c5664be70fff091aa6d42cf95114206685adc56c794a5e863fb7b9a39af3e3d66ff9245f01c0ec8125f681a2e88a60fbe9953c4ffc25847844334056b413febdee098c015d6ad66acebe8a5b8cad0f7da0b6cba757bf40cbb3b8fb0c82cfe130f174715795ceaea5600f917072c689d08083234a102618f4fe76079bf339a7794e4e2c1c2ac7c070288f610e456124d93853e96a7a247af4fa5ed48d1d140662bcef2dc4ed8a8fab4b9a560e9d84c3195fcbbffb4d4f848a6d08acea6da518f1ab70104c9e7eda9bb85f2d97630bd1333c5d7b36f168dabae651c19a89ab0554e20360f29c8e43e1c3ac3b5325474ba40ada2fd8587a913d34a6ab6d52d4b7adf7a7788114fbd3ee9f6050b0972fb69fe650ea7148730c9baf2ec673ff2c290e</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>jenkins</tag>
        <tag>CICD</tag>
      </tags>
  </entry>
  <entry>
    <title>jenkins pipeline中使用docker</title>
    <url>/post/jenkins-2-docker-pipeline.html</url>
    <content><![CDATA[<h1 id="一-搭建-Docker-Registry"><a href="#一-搭建-Docker-Registry" class="headerlink" title="一.搭建 Docker Registry"></a>一.搭建 Docker Registry</h1><p>开源的小型私有 Docker 镜像库</p>
<h2 id="1-docker-compose-yml-文件"><a href="#1-docker-compose-yml-文件" class="headerlink" title="1. docker-compose.yml 文件"></a>1. docker-compose.yml 文件</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry:2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">my_registry</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5000:5000&quot;</span> <span class="comment"># 将宿主机的5000端口映射到容器的5000端口</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">my_network</span> <span class="comment"># 加入名为my_network的自定义网络</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./registry_data:/var/lib/registry</span> <span class="comment"># 持久化数据，将本地目录映射到容器内部的数据存储目录</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./auth:/auth</span> <span class="comment"># 挂载认证文件目录</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">REGISTRY_AUTH:</span> <span class="string">htpasswd</span> <span class="comment"># 启用 htpasswd 认证方式</span></span><br><span class="line">      <span class="attr">REGISTRY_AUTH_HTPASSWD_REALM:</span> <span class="string">&quot;Registry Realm&quot;</span></span><br><span class="line">      <span class="attr">REGISTRY_AUTH_HTPASSWD_PATH:</span> <span class="string">/auth/htpasswd</span> <span class="comment"># 指定 htpasswd 文件路径</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span> <span class="comment"># 设置失败自动重启，确保容器常驻</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">my_network:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span> <span class="comment"># 使用桥接网络模式</span></span><br></pre></td></tr></table></figure>

<h2 id="2-配置凭证"><a href="#2-配置凭证" class="headerlink" title="2. 配置凭证"></a>2. 配置凭证</h2><ol>
<li>安装:<code> sudo apt install apache2-utils</code></li>
<li>确保 htpasswd 文件路径正确： 确保 Docker Compose 配置中的 REGISTRY_AUTH_HTPASSWD_PATH 指向的文件路径正确。你的配置应该类似于：<code>REGISTRY_AUTH_HTPASSWD_PATH: /auth/htpasswd</code></li>
<li>确认 htpasswd 文件内容： 确保 .&#x2F;auth&#x2F;htpasswd 文件中确实包含用户 username。你可以使用以下命令查看文件内容：<code>cat ./auth/htpasswd</code></li>
<li>检查文件权限： 确保 htpasswd 文件的权限允许 Docker 容器读取。可以尝试更改文件权限：<code>sudo chmod 644 ./auth/htpasswd</code></li>
<li>检查 Docker 组： 确保你的 Docker 进程可以访问 auth 目录和 htpasswd 文件。可以尝试将文件的所有者更改为 root：<code>sudo chown root:root ./auth/htpasswd</code> <code>docker login localhost:5000</code></li>
<li>使用完整的 curl 命令： 当使用 curl 进行测试时，请确保包括用户名和密码： <code>curl -u username:password http://localhost:5000/v2/_catalog</code></li>
<li>如果密码错误,可以尝试创建一个新的用户并测试是否能成功登录：<code>sudo htpasswd -B ./auth/htpasswd newuser</code>,然后尝试使用 newuser 登录。如果可以成功登录，问题可能出在原用户的密码上。</li>
<li>要清空 htpasswd 文件中的所有用户，你可以直接删除该文件，或者通过命令清空内容。以下是两种方法：<br>清空文件内容：<code>cat /dev/null &gt; ./auth/htpasswd</code><br>删除 htpasswd 文件后新建文件再新建用户: <code>rm ./auth/htpasswd</code> <code>touch ./auth/htpasswd</code> <code>sudo htpasswd ./auth/htpasswd username</code></li>
<li>修改凭证后重启下容器</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose down</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>目录结构如下<br><img src="/images/pipeline1.png"></li>
</ol>
<h2 id="2-给镜像打标签"><a href="#2-给镜像打标签" class="headerlink" title="2. 给镜像打标签"></a>2. 给镜像打标签</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker tag &lt;image_id&gt; localhost:5000/&lt;image_name&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-推送镜像到私有仓库"><a href="#3-推送镜像到私有仓库" class="headerlink" title="3. 推送镜像到私有仓库"></a>3. 推送镜像到私有仓库</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker push localhost:5000/&lt;image_name&gt;</span><br></pre></td></tr></table></figure>

<h2 id="4-验证推送成功-使用以下命令列出私有-Registry-中的镜像"><a href="#4-验证推送成功-使用以下命令列出私有-Registry-中的镜像" class="headerlink" title="4. 验证推送成功,使用以下命令列出私有 Registry 中的镜像"></a>4. 验证推送成功,使用以下命令列出私有 Registry 中的镜像</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -X GET http://127.0.0.1:5000/v2/_catalog</span><br></pre></td></tr></table></figure>

<h2 id="5-从-Registry-拉取镜像"><a href="#5-从-Registry-拉取镜像" class="headerlink" title="5. 从 Registry 拉取镜像"></a>5. 从 Registry 拉取镜像</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull 127.0.0.1:5000/my-app</span><br></pre></td></tr></table></figure>

<p>运行镜像,拉取后，你可以像运行其他镜像一样使用 docker run 运行它：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run localhost:5000/my-app</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="6-配置-HTTP-访问"><a href="#6-配置-HTTP-访问" class="headerlink" title="6. 配置 HTTP 访问"></a>6. 配置 HTTP 访问</h2><p>默认情况下，Docker 对非 HTTPS 的 Registry 访问是受限制的。如果你只是为了测试或在局域网内使用，可以通过修改 Docker 配置来允许 HTTP 访问。</p>
<p>在 Docker 客户端上（想要与私有 Registry 交互的每台机器上），你需要编辑 &#x2F;etc&#x2F;docker&#x2F;daemon.json 文件并添加以下内容：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;insecure-registries&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;127.0.0.1:5000&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后重新启动 Docker 服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure>

<h2 id="7-清理无用的镜像"><a href="#7-清理无用的镜像" class="headerlink" title="7. 清理无用的镜像"></a>7. 清理无用的镜像</h2><p>随着时间推移，Registry 中可能会存储大量镜像，导致磁盘空间占用增加。你可以使用 Docker Registry 提供的垃圾收集功能清理无用的镜像：</p>
<h3 id="1-停止-Registry-容器："><a href="#1-停止-Registry-容器：" class="headerlink" title="1. 停止 Registry 容器："></a>1. 停止 Registry 容器：</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker stop my_registry</span><br></pre></td></tr></table></figure>

<h3 id="2-运行垃圾收集命令："><a href="#2-运行垃圾收集命令：" class="headerlink" title="2. 运行垃圾收集命令："></a>2. 运行垃圾收集命令：</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run --<span class="built_in">rm</span> -v /path/on/host:/var/lib/registry registry:2 \</span><br><span class="line">  bin/registry garbage-collect /etc/docker/registry/config.yml</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-重新启动-Registry-容器："><a href="#3-重新启动-Registry-容器：" class="headerlink" title="3. 重新启动 Registry 容器："></a>3. 重新启动 Registry 容器：</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker start my_registry</span><br></pre></td></tr></table></figure>

<p>通过这些步骤，你可以保持私有 Registry 的整洁，并确保其高效运行。</p>
<h1 id="二-搭建-jenkins-pipeline"><a href="#二-搭建-jenkins-pipeline" class="headerlink" title="二. 搭建 jenkins pipeline"></a>二. 搭建 jenkins pipeline</h1><h2 id="1-自己构建含-docker-的-jenkins-镜像-Docker-in-D-有坑不建议使用"><a href="#1-自己构建含-docker-的-jenkins-镜像-Docker-in-D-有坑不建议使用" class="headerlink" title="1. 自己构建含 docker 的 jenkins 镜像 [Docker in D][有坑不建议使用]"></a>1. 自己构建含 docker 的 jenkins 镜像 [Docker in D][有坑不建议使用]</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建Jenkins目录文件夹并设置权限</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /var/jenkins_home</span><br><span class="line"><span class="built_in">chmod</span> 777 -R /var/jenkins_home</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /certs/client</span><br><span class="line"><span class="built_in">chmod</span> 777 -R /certs/client</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取 Docker in Docker 镜像</span></span><br><span class="line">docker image pull docker:dind</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动一个名为 jenkins-docker 的容器，该容器包含 Docker in Docker。</span></span><br><span class="line"><span class="comment"># 该容器与 Jenkins 容器共享网络，并设置了一些环境变量和卷，以便在 Jenkins 中连接到 Docker。</span></span><br><span class="line">docker run --name jenkins-docker --<span class="built_in">rm</span> --detach \</span><br><span class="line">  --privileged --network jenkins --network-alias docker \</span><br><span class="line">  --<span class="built_in">env</span> DOCKER_TLS_CERTDIR=/certs \</span><br><span class="line">  --volume /certs/client:/certs/client \</span><br><span class="line">  --volume /var/jenkins_home:/var/jenkins_home \</span><br><span class="line">  --publish 2376:2376 \</span><br><span class="line">  docker:dind --storage-driver overlay2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-1-先配置新建一个-Dockerfile"><a href="#1-1-先配置新建一个-Dockerfile" class="headerlink" title="1.1. 先配置新建一个 Dockerfile"></a>1.1. 先配置新建一个 Dockerfile</h3><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用了 jenkins/jenkins:lts-jdk17 作为基础镜像</span></span><br><span class="line"><span class="comment"># 这是 Jenkins 官方提供的基于 OpenJDK 17 的 Jenkins 镜像。FROM 关键字用于指定基础镜像。</span></span><br><span class="line"><span class="keyword">FROM</span> jenkins/jenkins:lts-jdk17</span><br><span class="line"><span class="comment"># 切换用户到 root：</span></span><br><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 lsb-release（Debian 系统中的包）和 curl</span></span><br><span class="line"><span class="comment"># 使用 apt-get 更新包列表并安装 lsb-release。</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y lsb-release curl</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载 Docker GPG 密钥</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> curl -fsSLo /usr/share/keyrings/docker-archive-keyring.asc https://mirrors.aliyun.com/docker-ce/linux/debian/gpg</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 Docker APT 源：</span></span><br><span class="line"><span class="comment"># 使用阿里云的源，可以根据需要选择其他镜像源</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/usr/share/keyrings/docker-archive-keyring.asc] https://mirrors.aliyun.com/docker-ce/linux/debian <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> &gt; /etc/apt/sources.list.d/docker.list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 Docker CLI</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y docker-ce-cli</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将用户切换回 jenkins 用户</span></span><br><span class="line"><span class="comment"># USER jenkins</span></span><br><span class="line"><span class="comment"># 安装 Jenkins 插件</span></span><br><span class="line"><span class="comment"># 使用 jenkins-plugin-cli 工具安装 Jenkins 插件，包括 &quot;blueocean&quot; 和 &quot;docker-workflow&quot;</span></span><br><span class="line"><span class="comment"># RUN jenkins-plugin-cli --plugins &quot;blueocean docker-workflow&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-2-构建镜像"><a href="#1-2-构建镜像" class="headerlink" title="1.2.构建镜像"></a>1.2.构建镜像</h3><p>镜像名字叫 my_jenkins</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build -t my_jenkins .</span><br></pre></td></tr></table></figure>

<h3 id="1-3-运行镜像"><a href="#1-3-运行镜像" class="headerlink" title="1.3.运行镜像"></a>1.3.运行镜像</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run --name my_jenkins --detach \</span><br><span class="line">  --network jenkins --<span class="built_in">env</span> DOCKER_HOST=tcp://docker:2376 \</span><br><span class="line">  --<span class="built_in">env</span> DOCKER_CERT_PATH=/certs/client --<span class="built_in">env</span> DOCKER_TLS_VERIFY=1 \</span><br><span class="line">  --publish 8080:8080 --publish 50000:50000 \</span><br><span class="line">  --volume /var/jenkins_home:/var/jenkins_home \</span><br><span class="line">  --volume /certs/client:/certs/client:ro \</span><br><span class="line">  my_jenkins</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li>–name my_jenkins：指定容器的名称为 my_jenkins。</li>
<li>–detach：让容器在后台运行（detached 模式）。</li>
<li>–network jenkins: 将容器连接到名为 jenkins 的 Docker 网络。</li>
<li>–env DOCKER_HOST&#x3D;tcp:&#x2F;&#x2F;docker:2376：设置环境变量 DOCKER_HOST，指定 Docker 客户端连接的 Docker 守护进程地址。这里使用了 Docker in Docker 容器的别名 docker 和端口 2376。</li>
<li>–env DOCKER_CERT_PATH&#x3D;&#x2F;certs&#x2F;client：设置环境变量 DOCKER_CERT_PATH，指定 Docker TLS 证书的路径。</li>
<li>–env DOCKER_TLS_VERIFY&#x3D;1：设置环境变量 DOCKER_TLS_VERIFY，启用 Docker 客户端的 TLS 验证。</li>
<li>–publish 8080:8080：将 Jenkins 容器的 8080 端口映射到主机的 8080 端口，使得可以通过主机的 8080 端口访问 Jenkins Web UI。</li>
<li>–publish 50000:50000：将 Jenkins 容器的 50000 端口映射到主机的 50000 端口，这是 Jenkins 使用的 Agent 的通信端口。</li>
<li>–volume .&#x2F;jenkins_home:&#x2F;var&#x2F;jenkins_home：将主机上的 .&#x2F;jenkins_home 目录挂载到容器内部的 &#x2F;var&#x2F;jenkins_home，用于持久化存储 Jenkins 数据和配置。</li>
<li>–volume &#x2F;certs&#x2F;client:&#x2F;certs&#x2F;client:ro：将主机上的 &#x2F;certs&#x2F;client 目录挂载到容器内部的 &#x2F;certs&#x2F;client，用于存储 Docker TLS 证书。:ro 表示挂载为只读，以增加安全性。</li>
<li>my_jenkins：指定要运行的镜像，这里假设你之前使用 docker build 命令构建了一个名为 my_jenkins 的 Jenkins 镜像。</li>
</ol>
<hr>
<p><a href="https://blog.csdn.net/abu935009066/article/details/136450091">https://blog.csdn.net/abu935009066/article/details/136450091</a></p>
<h2 id="2-拉取-jenkins-镜像-启动后去容器里安装-Docker-CLI"><a href="#2-拉取-jenkins-镜像-启动后去容器里安装-Docker-CLI" class="headerlink" title="2.拉取 jenkins 镜像,启动后去容器里安装 Docker CLI"></a>2.拉取 jenkins 镜像,启动后去容器里安装 Docker CLI</h2><h3 id="2-1-启动-Jenkins-容器并绑定-Docker-套接字，以允许-Jenkins-使用宿主机的-Docker："><a href="#2-1-启动-Jenkins-容器并绑定-Docker-套接字，以允许-Jenkins-使用宿主机的-Docker：" class="headerlink" title="2.1. 启动 Jenkins 容器并绑定 Docker 套接字，以允许 Jenkins 使用宿主机的 Docker："></a>2.1. 启动 Jenkins 容器并绑定 Docker 套接字，以允许 Jenkins 使用宿主机的 Docker：</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#将宿主机目录 /var/jenkins_home 挂载到容器中，检查并修改宿主机上的目录权限将宿主机目录 /var/jenkins_home 挂载到容器中，检查并修改宿主机上的目录权限</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> -R 1000:1000 /var/jenkins_home</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 Jenkins 容器</span></span><br><span class="line">docker run -d \</span><br><span class="line">  --name my_jenkins \</span><br><span class="line">  -p 8080:8080 \</span><br><span class="line">  -p 50000:50000 \</span><br><span class="line">  -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">  -v /var/jenkins_home:/var/jenkins_home \</span><br><span class="line">  jenkins/jenkins:lts-jdk17</span><br><span class="line"></span><br><span class="line">  <span class="comment">#这条命令通过 -v /var/run/docker.sock:/var/run/docker.sock 将宿主机的 Docker socket 挂载到 Jenkins 容器内。这允许 Jenkins 容器通过 /var/run/docker.sock 直接与宿主机的 Docker 服务进行通信。</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-在容器内执行以下命令，以更新包列表并安装-Docker-CLI："><a href="#2-2-在容器内执行以下命令，以更新包列表并安装-Docker-CLI：" class="headerlink" title="2.2. 在容器内执行以下命令，以更新包列表并安装 Docker CLI："></a>2.2. 在容器内执行以下命令，以更新包列表并安装 Docker CLI：</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 更新包列表</span></span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 Docker CLI 所需的依赖项</span></span><br><span class="line">apt-get install -y apt-transport-https ca-certificates curl gnupg2 software-properties-common</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 Docker 的官方 GPG 密钥</span></span><br><span class="line">curl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 Docker 的官方源</span></span><br><span class="line">add-apt-repository <span class="string">&quot;deb [arch=amd64] https://download.docker.com/linux/debian <span class="subst">$(lsb_release -cs)</span> stable&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 Docker CLI</span></span><br><span class="line">apt-get install -y docker-ce-cli</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证 Docker CLI 是否安装成功</span></span><br><span class="line">docker --version</span><br><span class="line"></span><br><span class="line"><span class="comment">#退出容器并重启</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">docker restart my_jenkins</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>只包括安装 Docker CLI 所需的必要包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-get update &amp;&amp; \</span><br><span class="line">apt-get install -y apt-transport-https ca-certificates curl &amp;&amp; \</span><br><span class="line">curl -fsSL https://download.docker.com/linux/debian/gpg | <span class="built_in">tee</span> /etc/apt/trusted.gpg.d/docker.gpg &gt; /dev/null &amp;&amp; \</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [arch=amd64] https://download.docker.com/linux/debian stable main&quot;</span> &gt; /etc/apt/sources.list.d/docker.list &amp;&amp; \</span><br><span class="line">apt-get update &amp;&amp; \</span><br><span class="line">apt-get install -y docker-ce-cli &amp;&amp; \</span><br><span class="line">docker --version</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-3-为了使-Jenkins-能够使用-Docker-CLI，jenkins-用户必须属于-docker-组"><a href="#2-3-为了使-Jenkins-能够使用-Docker-CLI，jenkins-用户必须属于-docker-组" class="headerlink" title="2.3. 为了使 Jenkins 能够使用 Docker CLI，jenkins 用户必须属于 docker 组"></a>2.3. 为了使 Jenkins 能够使用 Docker CLI，jenkins 用户必须属于 docker 组</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it --user root my_jenkins /bin/bash</span><br><span class="line"><span class="comment">#在容器内部查看 Docker 组 ID,记录 Docker 组的 ID（例如 998）。</span></span><br><span class="line"><span class="built_in">ls</span> -n /var/run/docker.sock</span><br><span class="line"></span><br><span class="line">groupadd -g $(<span class="built_in">stat</span> -c <span class="string">&#x27;%g&#x27;</span> /var/run/docker.sock) docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 Docker 组（如果不存在）</span></span><br><span class="line">groupadd -g 998 docker</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加 Jenkins 用户到 Docker 组</span></span><br><span class="line">groupmod -g 998 docker</span><br><span class="line"></span><br><span class="line"><span class="comment">#确保 Docker 组的 ID 与宿主机上的一致。</span></span><br><span class="line">usermod -aG docker jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看 jenkins 用户是否已经成功加入 docker 组：</span></span><br><span class="line"><span class="built_in">groups</span> jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置jenkins密码</span></span><br><span class="line">passwd jenkins  <span class="comment"># 设置jenkins密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置为连接数据库密码，可以使用 su - jenkins 切换到 jenkins 用户</span></span><br><span class="line">su - jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加完用户后，需重启 Jenkins 容器以使改动生效：</span></span><br><span class="line"><span class="built_in">exit</span>  <span class="comment"># 退出容器</span></span><br><span class="line">docker restart my_jenkins</span><br></pre></td></tr></table></figure>

<h2 id="2-4-提交已经安装-docker-cli-的-jenkins-镜像"><a href="#2-4-提交已经安装-docker-cli-的-jenkins-镜像" class="headerlink" title="2.4.提交已经安装 docker cli 的 jenkins 镜像"></a>2.4.提交已经安装 docker cli 的 jenkins 镜像</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker stop my_jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment">#将现有容器保存为一个新的镜像,包含当前容器的所有更改（包括已安装的 Docker CLI）</span></span><br><span class="line">docker commit my_jenkins my-jenkins-with-docker-cli</span><br><span class="line"></span><br><span class="line"><span class="comment">#在确认镜像已保存后，可以删除旧的容器：</span></span><br><span class="line">docker <span class="built_in">rm</span> my_jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用新镜像启动一个新的 Jenkins 容器并挂载正确的卷</span></span><br><span class="line">docker run -d \</span><br><span class="line">  --name my_jenkins \</span><br><span class="line">  -p 8080:8080 \</span><br><span class="line">  -p 50000:50000 \</span><br><span class="line">  -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">  -v /var/jenkins_home:/var/jenkins_home \</span><br><span class="line">  my-jenkins-with-docker-cli</span><br><span class="line"></span><br><span class="line"><span class="comment">#保留现有容器的环境：新镜像基于之前容器的状态，因此容器中安装的 Docker CLI 和其他修改都会保留。</span></span><br><span class="line"><span class="comment">#挂载正确的卷：确保 /var/jenkins_home 目录正确挂载，实现持久化数据存储。</span></span><br></pre></td></tr></table></figure>

<h2 id="2-5-配置-jenkins"><a href="#2-5-配置-jenkins" class="headerlink" title="2.5 配置 jenkins"></a>2.5 配置 jenkins</h2><ol>
<li>安装插件 github plugin&#x2F;docker pipeline plugin</li>
<li>配置凭证 github-credentials-id【jenkins 容器内部 ssh：私钥放 jenkins 中，公钥放 github-ssh 中】 ，</li>
<li>配置凭证 registry-url 以及 registry-credentials-id【登录 register 用户名和密码】。以及配置 宿主机 docker 配置项中 registry-url</li>
<li>配置 github webhook，jenkins 容器内部监听 8080 端口，jenkins 配置 webhook 地址为 <a href="http://jenkinsip:8080/github-webhook/">http://jenkinsip:8080/github-webhook/</a></li>
<li>新建一个 pipeline 任务，<br>选择【构建触发器】 GitHub hook trigger for GITScm polling<br>选择【定义】pipeline script from SCM<br>指定 master 分支</li>
</ol>
]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>jenkins</tag>
        <tag>CICD</tag>
      </tags>
  </entry>
  <entry>
    <title>jenkins pipeline自动构建部署Fastapi服务</title>
    <url>/post/jenkins-3-fastapi.html</url>
    <content><![CDATA[<h1 id="一-DB-服务"><a href="#一-DB-服务" class="headerlink" title="一. DB 服务"></a>一. DB 服务</h1><h2 id="1-docker-compose-yml，一次启动多个服务"><a href="#1-docker-compose-yml，一次启动多个服务" class="headerlink" title="1.docker-compose.yml，一次启动多个服务"></a>1.docker-compose.yml，一次启动多个服务</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#先要配置持久化数据目录权限</span></span><br><span class="line"><span class="comment">#1.创建挂载目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ./store/mysql/data</span><br><span class="line"><span class="built_in">mkdir</span> -p ./store/mysql/log</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.修改目录拥有者</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> -R $(<span class="built_in">whoami</span>):$(<span class="built_in">whoami</span>) ./store/mysql/data</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> -R $(<span class="built_in">whoami</span>):$(<span class="built_in">whoami</span>) ./store/mysql/log</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.修改目录权限</span></span><br><span class="line"><span class="built_in">chmod</span> -R 777 ./store/mysql/data</span><br><span class="line"><span class="built_in">chmod</span> -R 777 ./store/mysql/log</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/mysql:8.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">my_mysql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">****</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./store/mysql/data:/bitnami/mysql/data&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./store/mysql/log:/bitnami/mysql/log&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/redis:7.4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">my_redis</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ALLOW_EMPTY_PASSWORD=yes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDIS_DISABLE_COMMANDS=FLUSHDB,FLUSHALL</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./store/redis/data:/bitnami/redis/data&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./store/redis/log:/bitnami/redis/log&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/mongodb:7.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">my_mongodb</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;27017:27017&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./store/mongodb/data:/bitnami/mongodb/data&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./store/mongodb/log:/bitnami/mongodb/log&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">network</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">network:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span> <span class="comment"># 使用默认的 bridge 网络类型</span></span><br></pre></td></tr></table></figure>

<h2 id="2-docker-run-启动单个服务"><a href="#2-docker-run-启动单个服务" class="headerlink" title="2.docker run 启动单个服务"></a>2.docker run 启动单个服务</h2><p>目录下启动，持久化数据</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动 MySQL 容器</span></span><br><span class="line">docker run -d \</span><br><span class="line">  --name my_mysql \</span><br><span class="line">  --network monitor \</span><br><span class="line">  --restart always \</span><br><span class="line">  -e MYSQL_ROOT_PASSWORD=**** \</span><br><span class="line">  -p 3306:3306 \</span><br><span class="line">  -v ./store/mysql/data:/bitnami/mysql/data \</span><br><span class="line">  -v ./store/mysql/log:/bitnami/mysql/log \</span><br><span class="line">  bitnami/mysql:8.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 Redis 容器</span></span><br><span class="line">docker run -d \</span><br><span class="line">  --name my_redis \</span><br><span class="line">  --restart always \</span><br><span class="line">  --network monitor \</span><br><span class="line">  -e ALLOW_EMPTY_PASSWORD=<span class="built_in">yes</span> \</span><br><span class="line">  -e REDIS_PASSWORD=rootroot \</span><br><span class="line">  -e REDIS_DISABLE_COMMANDS=FLUSHDB,FLUSHALL \</span><br><span class="line">  -p 6379:6379 \</span><br><span class="line">  -v ./store/redis/data:/bitnami/redis/data \</span><br><span class="line">  -v ./store/redis/log:/bitnami/redis/log \</span><br><span class="line">  bitnami/redis:7.4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 MongoDB 容器</span></span><br><span class="line">docker run -d \</span><br><span class="line">  --name my_mongodb \</span><br><span class="line">  --network monitor \</span><br><span class="line">  --restart always \</span><br><span class="line">  -p 27017:27017 \</span><br><span class="line">  -v ./store/mongodb/data:/bitnami/mongodb/data \</span><br><span class="line">  -v ./store/mongodb/log:/bitnami/mongodb/log \</span><br><span class="line">  bitnami/mongodb:7.0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="二-Docker"><a href="#二-Docker" class="headerlink" title="二.Docker"></a>二.Docker</h1><h2 id="1-配置-docker"><a href="#1-配置-docker" class="headerlink" title="1.配置 docker"></a>1.配置 docker</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#确保当前用户具有访问 Docker 守护进程的权限。通过将用户添加到 docker 组来授予该权限</span></span><br><span class="line"><span class="built_in">sudo</span> usermod -aG docker tisha</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启 Docker 守护进程</span></span><br><span class="line"><span class="built_in">sudo</span> service docker restart/start</span><br><span class="line"><span class="built_in">sudo</span> service docker status</span><br><span class="line"><span class="built_in">sudo</span> service daemon-reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#要将所有权分配给 Docker Unix 套接字，可以使用 chown 命令。该命令应以 root 用户或具有超级用户权限的用户身份执行。</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> root /var/run/docker.sock</span><br><span class="line"></span><br><span class="line"><span class="comment">#运行 sudo update-alternatives --config iptables</span></span><br><span class="line">输入 1 选择 iptables-legacy</span><br><span class="line">现在运行 <span class="built_in">sudo</span> service docker start，Docker 将按预期启动！</span><br></pre></td></tr></table></figure>

<h2 id="2-docker-使用"><a href="#2-docker-使用" class="headerlink" title="2.docker 使用"></a>2.docker 使用</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#进入 mysql</span></span><br><span class="line">docker <span class="built_in">exec</span> -it my_mysql bash</span><br><span class="line">mysql -u root -p</span><br><span class="line">SHOW DATABASES;</span><br><span class="line">CREATE DATABASE fastapi;</span><br><span class="line">USE fastapi;</span><br><span class="line">DESCRIBE fastapi;</span><br><span class="line"></span><br><span class="line"><span class="comment">#进入 python 命令行</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 45789a13b24f python</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改 docker-compose.yml 或者 nginx.conf 文件后，重新启动容器</span></span><br><span class="line">docker-compose up -d --force-recreate</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看 nginx 日志</span></span><br><span class="line">docker <span class="built_in">exec</span> -it nginx <span class="built_in">cat</span> /var/log/nginx/error.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#移除镜像的 tag</span></span><br><span class="line">docker rmi mysql:latest</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看当前 latest 镜像到底是什么版本</span></span><br><span class="line">docker run --<span class="built_in">rm</span> nginx:latest nginx -v</span><br><span class="line">nginx version: nginx/1.25.4</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改 latest 为指定版本</span></span><br><span class="line">docker run -d -p 80:80 -v /home/tisha/fastapi-server/nginx.conf:/etc/nginx/nginx.conf:ro --name nginx-latest nginx:1.25.4</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除所有镜像</span></span><br><span class="line">docker rmi $(docker images -q)</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除指定镜像</span></span><br><span class="line">docker rmi</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除所有容器</span></span><br><span class="line">docker <span class="built_in">rm</span> $(docker ps -a -q)</span><br><span class="line"></span><br><span class="line"><span class="comment">#停止并删除所有正在运行和已停止的容器</span></span><br><span class="line">docker stop $(docker ps -aq) &amp;&amp; docker <span class="built_in">rm</span> $(docker ps -aq)</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除指定容器</span></span><br><span class="line">docker <span class="built_in">rm</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除所有为 none 的镜像</span></span><br><span class="line">docker images -f <span class="string">&quot;dangling=true&quot;</span> -q | xargs docker rmi</span><br><span class="line"></span><br><span class="line"><span class="comment">#清除 Docker Compose 的缓存。你可以运行以下命令来移除你的服务</span></span><br><span class="line">docker-compose down --rmi all</span><br><span class="line"></span><br><span class="line"><span class="comment">#再次运行你的服务： 重新构建你的镜像并启动你的服务。</span></span><br><span class="line">docker-compose up --build</span><br><span class="line"></span><br><span class="line"><span class="comment">#Dockerfile 位于当前目录下，构建镜像执行以下命令来构建 Docker 镜像。记得在后方加上一个点（.），表示当前目录。同时可以用 -t 标记来给镜像一个易于记忆的名字，比如 &quot;myapp&quot;。</span></span><br><span class="line">docker build --no-cache -t fastapi_app:latest .</span><br><span class="line"></span><br><span class="line"><span class="comment">#构建成功后，你可以使用以下命令来启动一个基于这个镜像的容器：</span></span><br><span class="line">docker run -p 8000:8000 fastapi_app</span><br><span class="line">docker run --name=fastapi_app -p 8000:8000 fastapi_app</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改仓库代码后需要重新构建并重新启动容器</span></span><br><span class="line">docker build -t fastapi_app .</span><br><span class="line">docker stop fastapi_app</span><br><span class="line">docker <span class="built_in">rm</span> fastapi_app</span><br><span class="line">docker run --name=fastapi_app -p 8000:8000 fastapi_app</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看 Docker 的系统日志。</span></span><br><span class="line">journalctl -u docker</span><br></pre></td></tr></table></figure>

<h2 id="3-网络使用"><a href="#3-网络使用" class="headerlink" title="3.网络使用"></a>3.网络使用</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查容器的详细信息，包括网络配置</span></span><br><span class="line">docker inspect my_jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment">#简化输出，仅显示网络信息</span></span><br><span class="line">docker inspect -f <span class="string">&#x27;&#123;&#123;.NetworkSettings.Networks&#125;&#125;&#x27;</span> my_registry</span><br><span class="line">docker inspect -f <span class="string">&#x27;&#123;&#123;.NetworkSettings.Networks&#125;&#125;&#x27;</span> my_jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment">#清理未使用的网络</span></span><br><span class="line">docker network prune</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除指定网络</span></span><br><span class="line">docker network <span class="built_in">rm</span> my-network</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#输出容器IP地址</span></span><br><span class="line">docker inspect -f <span class="string">&#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> my_mysql</span><br></pre></td></tr></table></figure>

<h1 id="三-部署应用"><a href="#三-部署应用" class="headerlink" title="三. 部署应用"></a>三. 部署应用</h1><h2 id="1-构建-fastapiserver-镜像文件"><a href="#1-构建-fastapiserver-镜像文件" class="headerlink" title="1.构建 fastapiserver 镜像文件"></a>1.构建 fastapiserver 镜像文件</h2><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用 Python 3.11 作为基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.11</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装系统依赖</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y \</span></span><br><span class="line"><span class="language-bash">    build-essential \</span></span><br><span class="line"><span class="language-bash">    default-libmysqlclient-dev \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制 Poetry 配置文件</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> pyproject.toml poetry.lock* ./</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新 pip 并设置国内镜像源</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --upgrade pip &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    pip config <span class="built_in">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 Poetry，增加超时时间</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --no-cache-dir --<span class="built_in">timeout</span>=300 poetry</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 Poetry 安装依赖（禁用虚拟环境），添加重试逻辑</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> poetry config virtualenvs.create <span class="literal">false</span> &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="keyword">for</span> i <span class="keyword">in</span> 1 2 3; <span class="keyword">do</span> poetry install --no-dev --no-interaction &amp;&amp; <span class="built_in">break</span> || <span class="built_in">sleep</span> 5; <span class="keyword">done</span> &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    pip show uvicorn</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制项目文件</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 PYTHONPATH</span></span><br><span class="line"><span class="keyword">ENV</span> PYTHONPATH=<span class="string">&quot;/app&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露应用端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行数据库检查和启动应用</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;python&quot;</span>, <span class="string">&quot;app/run.py&quot;</span>]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-本地-mac-使用-docker-部署服务"><a href="#2-本地-mac-使用-docker-部署服务" class="headerlink" title="2.本地 mac 使用 docker 部署服务"></a>2.本地 mac 使用 docker 部署服务</h2><ol>
<li>部署检查 mysql 服务</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动 mysql 容器</span></span><br><span class="line">docker run -d \</span><br><span class="line">  --name my_mysql \</span><br><span class="line">  --network monitor \</span><br><span class="line">  --restart always \</span><br><span class="line">  -e MYSQL_ROOT_PASSWORD=**** \</span><br><span class="line">  -p 3306:3306 \</span><br><span class="line">  -v ./store/mysql/data:/bitnami/mysql/data \</span><br><span class="line">  -v ./store/mysql/log:/bitnami/mysql/log \</span><br><span class="line">  bitnami/mysql:8.0</span><br><span class="line"></span><br><span class="line"><span class="comment">#检查 my_mysql 容器 容器自动加入 bridge 网络中</span></span><br><span class="line">docker inspect -f <span class="string">&#x27;&#123;&#123;.NetworkSettings.Networks&#125;&#125;&#x27;</span> my_mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#my_mysql容器 IP 地址</span></span><br><span class="line">docker inspect -f <span class="string">&#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> my_mysql</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>部署 fastapiserver 服务</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#打包 fastapiserver 镜像</span></span><br><span class="line">docker build -t fastapiserver:latest .</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动 fastapiserver 容器，连接 mysql 使用容器 IP 地址</span></span><br><span class="line">docker run -d \</span><br><span class="line">    --name fastapiserver \</span><br><span class="line">    --network monitor \</span><br><span class="line">    -p 8000:8000 \</span><br><span class="line">    --env-file .<span class="built_in">env</span> \</span><br><span class="line">    -e DATABASE_URL=mysql+pymysql://****:****@172.17.0.2:3306/fastapi \</span><br><span class="line">    fastapiserver:latest \</span><br><span class="line">    sh -c <span class="string">&quot;alembic upgrade head &amp;&amp; uvicorn app.run:app --host 0.0.0.0 --port 8000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#检查fastapiserver 容器 容器自动加入 bridge 网络中</span></span><br><span class="line">docker inspect -f <span class="string">&#x27;&#123;&#123;.NetworkSettings.Networks&#125;&#125;&#x27;</span> 检查fastapiserver</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>访问 <a href="http://localhost:8000/redoc">http://localhost:8000/redoc</a></li>
</ol>
<h2 id="3-服务器上部署服务"><a href="#3-服务器上部署服务" class="headerlink" title="3.服务器上部署服务"></a>3.服务器上部署服务</h2><ol>
<li>启动 mysql 容器<br>&#x2F;home&#x2F;tisha&#x2F;db&#x2F;docker-compose.yml 启动 mysql,加入 db_network 网络</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line"> --name my_mysql \</span><br><span class="line"> --network monitor \</span><br><span class="line"> --restart always \</span><br><span class="line"> -e MYSQL_ROOT_PASSWORD=**** \</span><br><span class="line"> -p 3306:3306 \</span><br><span class="line"> -v ./store/mysql/data:/bitnami/mysql/data \</span><br><span class="line"> -v ./store/mysql/log:/bitnami/mysql/log \</span><br><span class="line"> bitnami/mysql:8.0</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>启动 fastapiserver 服务【用于 jenkinsfile 配置】</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line"> --name fastapiserver \</span><br><span class="line"> --network monitor \</span><br><span class="line"> -p 8000:8000 \</span><br><span class="line"> -e DATABASE_URL=mysql+pymysql://****:****@172.17.0.3:3306/fastapi \</span><br><span class="line"> fastapiserver:latest \</span><br><span class="line"> sh -c <span class="string">&quot;alembic upgrade head &amp;&amp; uvicorn app.run:app --host 0.0.0.0 --port 8000&quot;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>访问 <a href="http://ip:8000/redoc">http://IP:8000/redoc</a></li>
</ol>
<h2 id="4-服务器上-CICD，jenkinsfile-配置文件"><a href="#4-服务器上-CICD，jenkinsfile-配置文件" class="headerlink" title="4. 服务器上 CICD，jenkinsfile 配置文件"></a>4. 服务器上 CICD，jenkinsfile 配置文件</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line"></span><br><span class="line">    environment &#123;</span><br><span class="line">        IMAGE_NAME = <span class="string">&#x27;qblingserver&#x27;</span></span><br><span class="line">        IMAGE_TAG = <span class="string">&#x27;latest&#x27;</span></span><br><span class="line">        REPO_URL = <span class="string">&#x27;git@github.com:TishaQin/qblingServer.git&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Checkout&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                cleanWs()</span><br><span class="line">                script &#123;</span><br><span class="line">                    // 使用 sshagent 插件注入 SSH 凭证</span><br><span class="line">                    sshagent([<span class="string">&#x27;github-credentials-id&#x27;</span>]) &#123;</span><br><span class="line">                        // 使用 checkout 步骤来克隆仓库</span><br><span class="line">                        checkout([<span class="variable">$class</span>: <span class="string">&#x27;GitSCM&#x27;</span>,</span><br><span class="line">                            branches: [[name: <span class="string">&#x27;*/master&#x27;</span>]],</span><br><span class="line">                            userRemoteConfigs: [[url: <span class="string">&quot;<span class="variable">$&#123;REPO_URL&#125;</span>&quot;</span>]]</span><br><span class="line">                        ])</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">&#x27;Stop and Remove Existing Container&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                script &#123;</span><br><span class="line">                    def containerExists = sh(script: <span class="string">&quot;docker ps -q -f name=<span class="variable">$&#123;IMAGE_NAME&#125;</span>&quot;</span>, returnStatus: <span class="literal">true</span>) == 0</span><br><span class="line">                    <span class="keyword">if</span> (containerExists) &#123;</span><br><span class="line">                        sh <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">                        docker stop <span class="variable">$&#123;IMAGE_NAME&#125;</span> || echo &quot;</span>Container <span class="variable">$&#123;IMAGE_NAME&#125;</span> not running.<span class="string">&quot;</span></span><br><span class="line"><span class="string">                        docker rm <span class="variable">$&#123;IMAGE_NAME&#125;</span> || echo &quot;</span>Container <span class="variable">$&#123;IMAGE_NAME&#125;</span> not found.<span class="string">&quot;</span></span><br><span class="line"><span class="string">                        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="built_in">echo</span> <span class="string">&quot;No existing container found: <span class="variable">$&#123;IMAGE_NAME&#125;</span>. Skipping stop and remove.&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">&#x27;Build Docker Image&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                script &#123;</span><br><span class="line">                    sh <span class="string">&quot;docker build -t <span class="variable">$&#123;IMAGE_NAME&#125;</span>:<span class="variable">$&#123;IMAGE_TAG&#125;</span> .&quot;</span></span><br><span class="line">                    <span class="built_in">echo</span> <span class="string">&quot;Docker image built successfully.&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">&#x27;Deploy with Docker Run&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                script &#123;</span><br><span class="line">                    sh <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">                    docker run -d \\</span></span><br><span class="line"><span class="string">                        --name <span class="variable">$&#123;IMAGE_NAME&#125;</span> \\</span></span><br><span class="line"><span class="string">                        --network monitor \\</span></span><br><span class="line"><span class="string">                        -p 8000:8000 \\</span></span><br><span class="line"><span class="string">                        --env-file .env.prod \\</span></span><br><span class="line"><span class="string">                        -e DATABASE_URL=mysql+pymysql://root:rootroot@my_mysql/qbling \\</span></span><br><span class="line"><span class="string">                        -v /var/log/qblingserver:/app/logs \\</span></span><br><span class="line"><span class="string">                        <span class="variable">$&#123;IMAGE_NAME&#125;</span>:<span class="variable">$&#123;IMAGE_TAG&#125;</span></span></span><br><span class="line"><span class="string">                    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            cleanWs()</span><br><span class="line">            script &#123;</span><br><span class="line">                sh <span class="string">&#x27;docker rmi $(docker images -f &quot;dangling=true&quot; -q) || true&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>jenkins</tag>
        <tag>CICD</tag>
      </tags>
  </entry>
  <entry>
    <title>python虚拟环境</title>
    <url>/post/python-0-venv.html</url>
    <content><![CDATA[<h2 id="poetry-使用"><a href="#poetry-使用" class="headerlink" title="poetry 使用"></a>poetry 使用</h2><h3 id="windows-下安装-poetry"><a href="#windows-下安装-poetry" class="headerlink" title="windows 下安装 poetry"></a>windows 下安装 poetry</h3><ol>
<li>Windows 下 powershell 安装<br>(Invoke-WebRequest -Uri <a href="https://raw.githubusercontent.com/python-poetry/poetry/master/install-poetry.py">https://raw.githubusercontent.com/python-poetry/poetry/master/install-poetry.py</a> -UseBasicParsing).Content | python -</li>
</ol>
<h3 id="poetry-命令使用"><a href="#poetry-命令使用" class="headerlink" title="poetry 命令使用"></a>poetry 命令使用</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">poetry --version</span><br><span class="line">poetry config --list   <span class="comment">#查看poetry配置</span></span><br><span class="line">poetry config virtualenvs.in-project <span class="literal">true</span>   <span class="comment">#设置poetry包缓存的位置/项目虚拟环境的位置/设置虚拟环境生成在项目内</span></span><br><span class="line"></span><br><span class="line">poetry <span class="built_in">env</span> remove python</span><br><span class="line">poetry <span class="built_in">env</span> use python</span><br><span class="line">poetry shell   <span class="comment">#进入虚拟环境</span></span><br><span class="line"></span><br><span class="line">poetry add fastapi 		<span class="comment">#安装包</span></span><br><span class="line">poetry remove flask</span><br><span class="line">poetry lock          <span class="comment">#poetry.lock 相当于 Poetry 的 requirements.txt 。</span></span><br><span class="line">poetry <span class="built_in">export</span> -f requirements.txt -o requirements.txt --without-hashes</span><br><span class="line"><span class="comment">#在执行完 poetry lock 指令后，必须再使用 poetry install 来安装模块。否则就会出现 poetry.lock 和虚拟环境不一致的状况</span></span><br><span class="line">poetry install</span><br><span class="line">poetry install --no-root   <span class="comment">#如果不需要安装项目本身，而只安装项目的依赖，你可以使用 命令来跳过项目本身的安装。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#新增模块至 dev-dependencies</span></span><br><span class="line">poetry add black --group dev</span><br><span class="line"></span><br><span class="line">poetry update</span><br><span class="line"></span><br><span class="line">poetry show</span><br><span class="line"></span><br><span class="line">poetry show --tree</span><br><span class="line"></span><br><span class="line">poetry <span class="built_in">export</span> -f requirements.txt -o requirements.txt --without-hashes --dev</span><br><span class="line"></span><br><span class="line">poetry <span class="built_in">source</span> add tsinghua https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"></span><br><span class="line"><span class="comment">#cmd中通过requirements.txt安装</span></span><br><span class="line"><span class="keyword">for</span> /f %i <span class="keyword">in</span> (requirements.txt) <span class="keyword">do</span> poetry add %i    <span class="comment">#添加requirement.txt中的依赖到poetry中并安装</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="poetry-安装依赖和安装项目的场景区分"><a href="#poetry-安装依赖和安装项目的场景区分" class="headerlink" title="poetry 安装依赖和安装项目的场景区分"></a>poetry 安装依赖和安装项目的场景区分</h3><ol>
<li><p>同时安装项目和项目依赖的场景这通常发生在开发阶段，你在本地环境中运行项目。在这种情况下，你希望安装项目的所有依赖项，同时也希望你的包可用，以便测试和运行项目的代码。Poetry 会创建一个虚拟环境并在其中安装所有依赖，以便你的环境干净且有序，避免混淆和冲突。</p>
</li>
<li><p>只安装项目本身的场景当你将自己的 Python 包或应用（如 qbling）发布到 PyPi 或其他分发渠道时，用户可能只需要安装项目本身。这是由于在你的 pyproject.toml 文件中已经列出了项目的所有依赖，这样用户在安装你的项目时，依赖项会自动安装。</p>
</li>
<li><p>只安装项目依赖的场景在一些使用 Docker 或其他自动化系统的场景中，你可能不希望安装项目本身，只安装项目依赖。这中情况下，你可以使用 poetry install –no-root。这种场景可能包括在 CI&#x2F;CD 管道中运行测试，或者在构建 Docker 镜像时，你可能只希望在镜像中包含一些依赖项，而不将整个项目安装到镜像中。</p>
</li>
</ol>
<h2 id="virtualEnv（支持-python2-和-python3，需要安装包）"><a href="#virtualEnv（支持-python2-和-python3，需要安装包）" class="headerlink" title="virtualEnv（支持 python2 和 python3，需要安装包）"></a><font style="color:rgb(51, 51, 51);">virtualEnv（支持 python2 和 python3，需要安装包）</font></h2><pre><code>    在**Python3.4**之前，[virtualenv](https://so.csdn.net/so/search?q=virtualenv)需要独立手动安装后，方可执行。
</code></pre>
<p>完整的创建新虚拟环境并指定用什么版本和放在什么位置的命令如下：</p>
<p><strong><font style="color:#E8323C;">virtualenv –p c:\Python27\Python2.exe d:\Python_virtualenvs\for_django</font></strong></p>
<p>-p： 指定你要虚拟的 Python 版本，这里选择了本地的 python2.7</p>
<p>d:\virtualenvs\for_django：表明在该目录下，建立一个叫做 for_django 的虚拟环境，这样的命名方式，让你一眼就能看出这个虚拟环境是为谁建立的。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip3 install virtualenv  # 使用自己对应安装的pip版本</span><br><span class="line">virtualenv  myenv  #当前目录下，创建一个独立的Python运行环境: myenv（若不在当前目录下，就要指定python的版本和目录，用上-p参数）</span><br><span class="line"></span><br><span class="line">myenv\Scripts\activate.bat #Windows当前目录的进入myenv\Script，激活虚拟环境</span><br><span class="line">source myenv/bin/activate #Linux激活虚拟环境</span><br><span class="line">deactivate #命令退出当前的myenv环境</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install virtualenvwrapper-win #win环境下安装virtualenv包管理，管理多个虚拟环境</span><br><span class="line">pip install virtualenvwrapper #linux环境下安装virtualenv包管理</span><br><span class="line">mkvirtualenv myenv #创建一个独立的Python运行环境: myenv（自动将myenv环境安装在C:\Users\Administrator\Envs\盘下，安装完成自动进入myenv的虚拟环境）</span><br><span class="line">deactivate #命令退出当前的myenv环境</span><br><span class="line">workon #查看当前下有多少个虚拟环境</span><br><span class="line">workon myenv #进入某个虚拟环境</span><br><span class="line">pip list / pip install /pip uninstall #在虚拟环境中安装和卸载包</span><br></pre></td></tr></table></figure>

<blockquote>
<p><font style="color:rgb(51, 51, 51);">virtualenv 虚拟环境配合 pip 的 freeze 功能，可以一次性快捷的将整个环境下的第三方模块全部记录下来： </font><font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">pip freeze &gt; d:requirements.txt</font></p>
<p><font style="color:rgb(51, 51, 51);">对应的，也可以用它一次性通过在别的机器上或虚拟环境里，将文件里列出的第三方库安装起来。只需要使用命令：</font><font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">pip install -r requirements.txt</font></p>
<p>使用如下命令根据导出结果下载相关包及依赖</p>
</blockquote>
<pre><code>命令格式：pip3 download -d [保存目录] -r [导出结果文件]
</code></pre>
<p><font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);"> pip3 download -d .\ -r requirements.txt</font></p>
<blockquote>
</blockquote>
<h2 id="venv-Python-从-3-3-版本开始，自带了一个虚拟环境-venv。"><a href="#venv-Python-从-3-3-版本开始，自带了一个虚拟环境-venv。" class="headerlink" title=" venv (Python 从 3.3 版本开始，自带了一个虚拟环境 venv。)"></a><font style="color:rgb(51, 51, 51);"> venv (Python 从 3.3 版本开始，自带了一个虚拟环境 venv。)</font></h2><p><font style="color:rgb(51, 51, 51);">它的很多操作都和 virtualenv 类似，但是两者运行机制不同。因为是从 3.3 版本开始自带的，这个工具也仅仅支持 python 3.3 和以后版本。所以，要在 python2 上使用虚拟环境，依然要利用 virtualenv 。</font></p>
<ol>
<li><font style="color:rgb(51, 51, 51);">venv 安装</font></li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows 中venv已经以标准库的形式存在，不用再单独安装</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Linux</span></span><br><span class="line">sudo apt-get install python3-venv  # 如有不同版本的Python3,可指定具体版本venv：python3.5-venv</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><font style="color:rgb(51, 51, 51);">在当前目录创建一个独立的 Python 运行环境: myenv</font></li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows</span></span><br><span class="line">py -3 -m venv myenv</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Linux</span></span><br><span class="line">python3 -m venv myenv</span><br><span class="line">虚拟运行环境、安装第三方包、运行程序及退出虚拟环境等操作均与 virtualenv 相同</span><br></pre></td></tr></table></figure>

<blockquote>
<p><font style="color:rgb(51, 51, 51);">venv 环境下安装第三方报错超时,先执行设置超时时间，再重新安装包</font><strong><font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">pip –default-timeout&#x3D;100 install -U Pillow</font></strong></p>
</blockquote>
<p>python -m pip install –upgrade –force-reinstall pip</p>
]]></content>
      <categories>
        <category>Python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>python标准库</title>
    <url>/post/python-1-lib.html</url>
    <content><![CDATA[<p><img src="/images/pythonlib.png"></p>
<h1 id="日志的结构："><a href="#日志的结构：" class="headerlink" title="日志的结构："></a>日志的结构：</h1><p>日志记录器，日志格式器，日志等级，日志筛选器，日志处理器（流处理器，网络处理器，文件处理器）</p>
<p>需要记录测试执行过程 —–时间，对象，参数，结果等</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="comment">#自定义一个status字段，日志记录时要传入</span></span><br><span class="line">LOG_FORMATTER = (<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(status)s - %(message)s&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;%H:%M:%S&#x27;</span>)</span><br><span class="line">LOG_NAME = <span class="string">r&#x27;demo_log&#x27;</span></span><br><span class="line">LOG_FILE = <span class="string">r&#x27;./demo.log&#x27;</span></span><br><span class="line">LOG_LEVEL = logging.DEBUG</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">creat_logger</span>(<span class="params">log_name: <span class="built_in">str</span> = LOG_NAME,</span></span><br><span class="line"><span class="params">                 log_file: <span class="built_in">str</span> = LOG_FILE,</span></span><br><span class="line"><span class="params">                 log_level: <span class="built_in">int</span> = LOG_LEVEL,</span></span><br><span class="line"><span class="params">                 log_formatter: <span class="built_in">tuple</span> = LOG_FORMATTER</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    日志配置和生成器</span></span><br><span class="line"><span class="string">    :param log_name:日志名称</span></span><br><span class="line"><span class="string">    :param log_file:日志文件的路径</span></span><br><span class="line"><span class="string">    :param log_level:日志等级 DEBUG INFO WARING error critical</span></span><br><span class="line"><span class="string">    :param log_formatter:日志的格式</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1、 定义日志的输出格式</span></span><br><span class="line">    formatter = logging.Formatter(*log_formatter)</span><br><span class="line">    <span class="comment"># 2，定义日志的文件处理器，需要传入文件路径</span></span><br><span class="line">    handler = logging.FileHandler(log_file)</span><br><span class="line">    <span class="built_in">print</span>(handler.baseFilename)</span><br><span class="line">    <span class="comment"># 3.将日志格式添加到日志处理器中</span></span><br><span class="line">    handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4，获取一个日志记录器，传入日志记录器的名称</span></span><br><span class="line">    logger = logging.getLogger(log_name)</span><br><span class="line">    <span class="comment"># 5.设置日志等级</span></span><br><span class="line">    logger.setLevel(log_level)</span><br><span class="line">    <span class="comment"># 6.将处理器和记录器关联</span></span><br><span class="line">    logger.addHandler(handler)</span><br><span class="line">    <span class="comment"># 7.将记录器返回</span></span><br><span class="line">    <span class="keyword">return</span> logger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log = creat_logger()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="手动在指定位置记录（缺点：需要修改内部代码去手动添加日志记录）"><a href="#手动在指定位置记录（缺点：需要修改内部代码去手动添加日志记录）" class="headerlink" title="手动在指定位置记录（缺点：需要修改内部代码去手动添加日志记录）"></a>手动在指定位置记录（缺点：需要修改内部代码去手动添加日志记录）</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> chapter6.logs <span class="keyword">import</span> log</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="comment">#函数中进行日志的记录</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_a</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    log.debug(func_a.__name__, extra=&#123;<span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;running&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / args.__len__(), <span class="number">1</span> / kwargs.__len__()</span><br><span class="line"></span><br><span class="line"><span class="comment"># func_a(1, name=&#x27;json&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试类和测试方法中记录日志</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestA</span>(unittest.TestCase):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_a</span>(<span class="params">self</span>):</span><br><span class="line">        log.debug(<span class="variable language_">self</span>.test_a.__name__, extra=&#123;<span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;running&#x27;</span>&#125;)</span><br><span class="line">        <span class="keyword">assert</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_b</span>(<span class="params">self</span>):</span><br><span class="line">        log.debug(<span class="variable language_">self</span>.test_b.__name__, extra=&#123;<span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;running&#x27;</span>&#125;)</span><br><span class="line">        <span class="keyword">assert</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    unittest.main()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="利用好装饰器来记录测试方法和函数的执行日志-动态且灵活的记录"><a href="#利用好装饰器来记录测试方法和函数的执行日志-动态且灵活的记录" class="headerlink" title="利用好装饰器来记录测试方法和函数的执行日志(动态且灵活的记录)"></a>利用好装饰器来记录测试方法和函数的执行日志(动态且灵活的记录)</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">from</span> log.logs <span class="keyword">import</span> log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## def logs(func):</span></span><br><span class="line"><span class="comment">#     &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#     普通日志装饰器</span></span><br><span class="line"><span class="comment">#     :param func:</span></span><br><span class="line"><span class="comment">#     :return:</span></span><br><span class="line"><span class="comment">#     &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#     @wraps(func)</span></span><br><span class="line"><span class="comment">#     def wrap_func(*args, **kwargs):</span></span><br><span class="line"><span class="comment">#         tuple_args = args</span></span><br><span class="line"><span class="comment">#         dict_kwargs = kwargs</span></span><br><span class="line"><span class="comment">#         func(*args, **kwargs)</span></span><br><span class="line"><span class="comment">#         log.debug(</span></span><br><span class="line"><span class="comment">#             f&#x27;&#123;func.__name__&#125;(*args: tuple = *&#123;tuple_args&#125;, **kwargs: dict = **&#123;dict_kwargs&#125;)&#x27;,</span></span><br><span class="line"><span class="comment">#             extra=&#123;&#x27;status&#x27;: &#x27;PASS&#x27;&#125;</span></span><br><span class="line"><span class="comment">#         )</span></span><br><span class="line"><span class="comment">#     return wrap_func</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logs</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    兼容日志装饰器</span></span><br><span class="line"><span class="string">    :param func:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrap_func</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        tuple_args = args</span><br><span class="line">        dict_kwargs = kwargs</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            func(*args, **kwargs)</span><br><span class="line">            log.debug(</span><br><span class="line">                <span class="string">f&#x27;<span class="subst">&#123;func.__name__&#125;</span>(*args: tuple = *<span class="subst">&#123;tuple_args&#125;</span>, **kwargs: dict = **<span class="subst">&#123;dict_kwargs&#125;</span>)&#x27;</span>,</span><br><span class="line">                extra=&#123;<span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;PASS&#x27;</span>&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            log.exception(</span><br><span class="line">                <span class="string">f&#x27;<span class="subst">&#123;func.__name__&#125;</span>(*args: tuple = *<span class="subst">&#123;tuple_args&#125;</span>, **kwargs: dict = **<span class="subst">&#123;dict_kwargs&#125;</span>)&#x27;</span>,</span><br><span class="line">                exc_info=<span class="literal">True</span>,</span><br><span class="line">                extra=&#123;<span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;FAIL&#x27;</span>&#125;</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrap_func</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> logs_decorators <span class="keyword">import</span> logs</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logs</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_a</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / args.__len__(), <span class="number">1</span> / kwargs.__len__()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># func_a(1, name=&#x27;json&#x27;)</span></span><br><span class="line"><span class="comment"># func_a()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestA</span>(unittest.TestCase):</span><br><span class="line"></span><br><span class="line"><span class="meta">    @logs</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_a</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">assert</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @logs</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_b</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">assert</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    unittest.main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="其他详解"><a href="#其他详解" class="headerlink" title="其他详解"></a>其他详解</h2><p><a href="https://five3.blog.csdn.net/article/details/88770676">Python 日志模块 logging 使用详解</a></p>
<h1 id="decorator-装饰器用法"><a href="#decorator-装饰器用法" class="headerlink" title="decorator 装饰器用法"></a>decorator 装饰器用法</h1><ol>
<li>decorator，以装饰符号@进行标识，类似于 Java 的注解，主要作用是保证对象封闭的条件下实现该对象的特定操作（一般不修改对象的内部逻辑，而是通过对象属性进行操作）</li>
<li>装饰器按照实现的对象类型可以分为函数装饰器和类装饰器</li>
<li>装饰器还可以分为有参和无参两种类型</li>
<li>计时，鉴权，路由，日志记录(详见日志模块)，依赖处理，异常捕捉</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 无参函数装饰器</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_2</span>(<span class="params">func</span>):</span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrap_func</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;11&#x27;</span> + func.__name__)</span><br><span class="line">        func(*args, **kwargs)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;22&#x27;</span> + func.__name__)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrap_func</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有参函数装饰器</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_3</span>(<span class="params">arg=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner_func</span>(<span class="params">func</span>):</span><br><span class="line"><span class="meta">        @wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wrap_func</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;函数执行前的操作&#x27;</span>+arg) <span class="keyword">if</span> arg <span class="keyword">else</span> <span class="string">&#x27;...&#x27;</span></span><br><span class="line">            func(*args, **kwargs)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;函数执行后&#x27;</span> + func.__name__)</span><br><span class="line">        <span class="keyword">return</span> wrap_func</span><br><span class="line">    <span class="keyword">return</span> inner_func</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@func_3(<span class="params"><span class="string">&quot;1&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># @func_2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;====&#x27;</span> + func_1.__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># @func_2 = func_2(func_1)  --&gt;wrap_func</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># func_1()-&gt;wrap_func()</span></span><br><span class="line"></span><br><span class="line">func_1()</span><br></pre></td></tr></table></figure>

<h2 id="使用装饰器解决用例依赖的问题"><a href="#使用装饰器解决用例依赖的问题" class="headerlink" title="使用装饰器解决用例依赖的问题"></a>使用装饰器解决用例依赖的问题</h2><p>用例依赖的几种情况：数据依赖（被测系统需要依赖外部系统的数据），步骤（用户的操作是分步骤的），业务（综合数据和步骤的，根据实际公司的业务来决定，一般是执行被测用例前，前面所依赖的业务都要成功执行），unittest 没提供用例依赖的解决方法，侧重于独立的用例，手动编写一个装饰器来解决用例依赖，简化业务过程中冗余的操作，如果所依赖的用例失败，那么后面的用例直接被跳过。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DependencyError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__int__</span>(<span class="params">self, _<span class="built_in">type</span>=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>._<span class="built_in">type</span> = _<span class="built_in">type</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._<span class="built_in">type</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&#x27;Dependency name of test is required!&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._<span class="built_in">type</span> == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&#x27;Dependency name of test can not the case self!&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">depend</span>(<span class="params"><span class="keyword">case</span>=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">    <span class="comment"># 所要依赖的测试用例不能为空</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">case</span>:</span><br><span class="line">        <span class="keyword">raise</span> DependencyError</span><br><span class="line">    <span class="comment"># 将unittest中测试的结果收集，结果有失败，错误，跳过，成功</span></span><br><span class="line">    _mark = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrap_func</span>(<span class="params">func</span>):</span><br><span class="line"><span class="meta">        @wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">inner_func</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="comment"># 所要依赖的测试用例不能是自己</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">case</span> == func.__name__:</span><br><span class="line">                <span class="keyword">raise</span> DependencyError(<span class="number">1</span>)</span><br><span class="line">            _r = <span class="variable language_">self</span>._outcome.result</span><br><span class="line">            _f, _e, _s = _r.failures, _r.errors, _r.skipped  <span class="comment">#每一个结果集是以列表的方式存储的，列表中的每一个元素是一个元组，元组第一个元素是用例名称。第二个元素是原因</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (_f <span class="keyword">or</span> _e <span class="keyword">or</span> _s):</span><br><span class="line">                <span class="comment"># 如果三个结果集（列表）都为空，所要依赖的用例肯定是执行通过的，就可以直接执行当前被测用例了</span></span><br><span class="line">                func(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> _f:</span><br><span class="line">                _mark.extend([fail[<span class="number">0</span>] <span class="keyword">for</span> fail <span class="keyword">in</span> _f])</span><br><span class="line">            <span class="keyword">if</span> _e:</span><br><span class="line">                _mark.extend([error[<span class="number">0</span>] <span class="keyword">for</span> error <span class="keyword">in</span> _e])</span><br><span class="line">            <span class="keyword">if</span> _s:</span><br><span class="line">                _mark.extend([skip[<span class="number">0</span>] <span class="keyword">for</span> skip <span class="keyword">in</span> _s])</span><br><span class="line"></span><br><span class="line">            unittest.skipIf(</span><br><span class="line">                <span class="keyword">case</span> <span class="keyword">in</span> <span class="built_in">str</span>(_mark),</span><br><span class="line">                <span class="string">f&#x27;The pre-depend case :<span class="subst">&#123;<span class="keyword">case</span>&#125;</span> has failed! Skip the specified case!&#x27;</span></span><br><span class="line">            )(func)(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="comment"># 如果case in str(_mark)成立，源码中返回skip(reason)，相当于skip(reason)(func)，跳过func用例</span></span><br><span class="line">        <span class="comment"># 如果case in str(_mark)不成立，源码中返回_id(obj)，return obj函数，相当于return func,所以后面加上(self)，执行func(self)用例</span></span><br><span class="line">        <span class="keyword">return</span> inner_func</span><br><span class="line">    <span class="keyword">return</span> wrap_func</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># @unittest.skipIf(case in str(_mark), &#x27;&#x27;)</span></span><br><span class="line"><span class="comment"># def test(self):</span></span><br><span class="line"><span class="comment">#     ...</span></span><br><span class="line"><span class="comment"># 相当于</span></span><br><span class="line"><span class="comment"># unittest.skipIf(case in str(_mark), &#x27;&#x27;)(test)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 作用于函数或者类上</span></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> .decorators <span class="keyword">import</span> depend</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestA</span>(unittest.TestCase):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_a</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>.test_a.__name__)</span><br><span class="line">        <span class="keyword">assert</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_b</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>.test_b.__name__)</span><br><span class="line">        <span class="keyword">assert</span> <span class="number">1</span> == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @depend(<span class="params"><span class="string">&#x27;test_d&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_c</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>.test_c.__name__)</span><br><span class="line">        <span class="keyword">assert</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># @depend(&#x27;test_a&#x27;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestB</span>(unittest.TestCase):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># @depend(&#x27;test_a&#x27;)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_d</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>.test_d.__name__)</span><br><span class="line">        <span class="keyword">assert</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    unittest.main(verbosity=<span class="number">2</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>python函数式编程</title>
    <url>/post/python-2-func.html</url>
    <content><![CDATA[<p><img src="/images/pythonfunc.png"></p>
]]></content>
      <categories>
        <category>Python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>python collections</title>
    <url>/post/python-3-collections.html</url>
    <content><![CDATA[<p><img src="/images/collections.png"></p>
]]></content>
      <categories>
        <category>Python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>python collections.abc</title>
    <url>/post/python-4-collections-abc.html</url>
    <content><![CDATA[<p><img src="/images/collections.abc.png"></p>
]]></content>
      <categories>
        <category>Python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>python 多线程</title>
    <url>/post/python-5-thread.html</url>
    <content><![CDATA[<p><img src="/images/pythonthread.png"></p>
]]></content>
      <categories>
        <category>Python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>python unittest</title>
    <url>/post/python-6-unittest.html</url>
    <content><![CDATA[<h1 id="unitetst-和-pytest-对比"><a href="#unitetst-和-pytest-对比" class="headerlink" title="unitetst 和 pytest 对比"></a>unitetst 和 pytest 对比</h1><p><img src="/images/python61.png"><br><img src="/images/python62.png"><br><img src="/images/python63.png"></p>
<h3 id="四-写法对比"><a href="#四-写法对比" class="headerlink" title="四 写法对比"></a>四 写法对比</h3><figure class="highlight python"><figcaption><span>unittest</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestLogin</span>(unittest.TestCase):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setUp</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 前置：访问登录页面</span></span><br><span class="line">        <span class="variable language_">self</span>.driver = webdriver.Chrome()</span><br><span class="line">        <span class="variable language_">self</span>.driver.maximize_window()</span><br><span class="line">        <span class="variable language_">self</span>.driver.get(CD.web_login_url)</span><br><span class="line">        <span class="variable language_">self</span>.lg = LoginPage(<span class="variable language_">self</span>.driver)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tearDown</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#后置，关闭浏览器</span></span><br><span class="line">        <span class="variable language_">self</span>.driver.quit()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><figcaption><span>pytest</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># conftest中定义多个fixture，一个fixture可以是另一个fixture的前后置，期间还是用yield隔开前后置</span></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&#x27;class&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">access_web</span>():</span><br><span class="line">    <span class="comment"># 前置条件</span></span><br><span class="line">    <span class="keyword">global</span> driver  <span class="comment">#声明driver为全局变量</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;========所有测试用例之前的，整个测试用例只执行一次=========&quot;</span>)</span><br><span class="line">    driver=webdriver.Chrome()</span><br><span class="line">    driver.maximize_window()</span><br><span class="line">    driver.get(CD.web_login_url)</span><br><span class="line">    <span class="comment"># 实例化LoginPage类</span></span><br><span class="line">    lg=LoginPage(driver)</span><br><span class="line">    <span class="comment"># yield 同时可以返回值(driver,lg)，相当于return，在使用返回值的时候直接用函数名</span></span><br><span class="line">    <span class="keyword">yield</span> (driver,lg)  <span class="comment">#分割线：前面是前置条件、后面是后置条件</span></span><br><span class="line">    <span class="comment"># 后置条件</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;========所有测试用例之后的，整个测试用例只执行一次=========&quot;</span>)</span><br><span class="line">    driver.quit()</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture()</span></span><br><span class="line"><span class="comment"># @pytest.fixture()表示函数默认作用域access_web的作用域在函数上，执行测试用例时，每个函数都执行一次</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">refresh_page</span>():</span><br><span class="line">    <span class="keyword">global</span> driver</span><br><span class="line">    <span class="comment"># 前置操作</span></span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    <span class="comment"># 后置操作</span></span><br><span class="line">    driver.refresh()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/images/python64.png"></p>
<h3 id="八-参数化"><a href="#八-参数化" class="headerlink" title="八 参数化"></a>八 参数化</h3><blockquote>
<p>unitetst 参数化</p>
<ol>
<li>引入第三方包 paramunittest，</li>
<li>内置文本参数化的方式 subTest<br>这种有缺点：测试数据只能写在代码中，当数据量过大，不利于维护测试数据</li>
<li>unittests 数据驱动 ddt，引入第三方包 ddt ，@ddt 和@unpack</li>
</ol>
</blockquote>
<figure class="highlight python"><figcaption><span>unittest</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@ddt</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestLogin</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">#异常测试用例</span></span><br><span class="line"><span class="meta">    @@data(<span class="params">*LD.phone_data</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_login_0_user_wrongFormat</span>(<span class="params">self,data</span>):</span><br><span class="line">        <span class="comment">#前置：访问登录页面</span></span><br><span class="line">        <span class="comment">#步骤：输入用户名、密码、点击</span></span><br><span class="line">        <span class="comment"># 调用login方法</span></span><br><span class="line">        <span class="variable language_">self</span>.lg.login(data[<span class="string">&#x27;user&#x27;</span>],data[<span class="string">&#x27;pwd&#x27;</span>])</span><br><span class="line">        <span class="comment"># 断言：首页当中能否找到“退出”按钮</span></span><br><span class="line">        <span class="comment">#等待10秒</span></span><br><span class="line">        <span class="comment">#找元素 //div[@class=&quot;navbar-account&quot;]</span></span><br><span class="line">        <span class="variable language_">self</span>.assertEqual(<span class="variable language_">self</span>.lg.get_errorMsg_form_loginArea(),data[<span class="string">&#x27;check&#x27;</span>])</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><figcaption><span>pytest</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestLogin</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">#异常测试用例</span></span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(<span class="params"><span class="string">&quot;data&quot;</span>,LD.phone_data</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_login_0_user_wrongFormat</span>(<span class="params">self,data,access_web</span>):</span><br><span class="line">        <span class="comment">#前置：访问登录页面</span></span><br><span class="line">        <span class="comment">#步骤：输入用户名、密码、点击</span></span><br><span class="line">        <span class="comment"># 调用login方法</span></span><br><span class="line">        access_web[<span class="number">1</span>].login(data[<span class="string">&#x27;user&#x27;</span>],data[<span class="string">&#x27;passwd&#x27;</span>])</span><br><span class="line">        <span class="comment"># 断言：首页当中能否找到“退出”按钮</span></span><br><span class="line">        <span class="comment">#等待10秒</span></span><br><span class="line">        <span class="comment">#找元素 //div[@class=&quot;navbar-account&quot;]</span></span><br><span class="line">        <span class="keyword">assert</span> access_web[<span class="number">1</span>].get_errorMsg_form_loginArea(),data[<span class="string">&#x27;check&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="九-unittest-其他"><a href="#九-unittest-其他" class="headerlink" title="九 unittest 其他"></a>九 unittest 其他</h3><ol>
<li><p>unittest-TestFixture<br>setUp()和 tearDown()是每个测试用例进行时都会执行的测试方法。特殊类方法 setUpClass()，tearDownClass()，在所有测试用例(整体)前后执行。用例的跳过@unittest.skip,skipIf()</p>
</li>
<li><p>unittest 的缺点：<br>2.1 用例依赖的支持较弱，原生写法里面不支持将两个测试方法进行关联，只能将被关联用例重复硬编码写在被测方法中（如果硬是要做原生的用例依赖，测试用例之间参数联动判定跳过，设置一个类属性变量（通常用列表，字典），被依赖的用例执行成功后更改下个测试所有依赖的变量值，下个用例中设定判断条件看是否要跳过此条用例，跳过就是直接 return ）<br>2.2 测试数据不支持文件 IO，自然无法读取外部的配置文件</p>
</li>
<li><p>unittese 测试套件</p>
</li>
</ol>
<figure class="highlight python"><figcaption><span>测试套件使用结合两种html测试报告的输出</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># 测试套件 —— 包含待测的模块、类、测试方testsuite</span></span><br><span class="line"><span class="comment"># 测试加载器 —— 决定测试模块、测试类、测试方法的加载testloader</span></span><br><span class="line"><span class="comment"># 测试运行器 —— 记录测试过程、输出测试结果testrunner</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试结果输出到文本中——文本报告TextTestRunner</span></span><br><span class="line"><span class="comment"># 测试结果输出到网页中——网页报告HTMLTestRunner</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> join, dirname</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入开关</span></span><br><span class="line"><span class="comment"># from chapter4.case import tests</span></span><br><span class="line"><span class="keyword">from</span> setting <span class="keyword">import</span> SUIT_MODULE_1</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> HTMLTestRunner <span class="keyword">import</span> HTMLTestRunner</span><br><span class="line"><span class="keyword">from</span> BeautifulReport <span class="keyword">import</span> BeautifulReport</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义测试用例的目录，用于测试加载器去加载</span></span><br><span class="line">CASE_PATH = join(dirname(__file__), <span class="string">&#x27;./chapter4/case&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试套件初始化，测试加载器初始化（大量测试用执行的时候使用测试加载器）</span></span><br><span class="line">suit = unittest.TestSuite()</span><br><span class="line">loader = unittest.defaultTestLoader</span><br><span class="line"><span class="comment"># loader = unittest.TestLoader()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试加载器发现测试对象</span></span><br><span class="line"><span class="comment"># start_dir起始目录，pattern命名规则，loader.discover递归寻找起始目录下符合命名规则的类和方法</span></span><br><span class="line">test_suit = loader.discover(start_dir=CASE_PATH,pattern=<span class="string">&#x27;module*.py&#x27;</span>)</span><br><span class="line"><span class="comment"># 更灵活的方式，做一个开关决定哪些测试模块执行</span></span><br><span class="line"><span class="comment"># for test in tests:</span></span><br><span class="line"><span class="comment">#     test_suit = loader.discover(start_dir=CASE_PATH, pattern=test)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试对象加入测试套件</span></span><br><span class="line"><span class="comment"># 如果没有测试测试加载器，执行少量的测试用例可以直接使用suite.addTests([demo2.demo2(&#x27;test3&#x27;),demo2.demo2(&#x27;test4&#x27;)])）</span></span><br><span class="line">suit.addTest(test_suit)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试运行器初始化,# 运行测试</span></span><br><span class="line"><span class="comment"># runner = unittest.TextTestRunner(verbosity=2)</span></span><br><span class="line"><span class="comment"># runner.run(suit)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果要将测试结果输出测试报告，只需要更改运行器runnner</span></span><br><span class="line"><span class="comment"># with open(&#x27;./report.html&#x27;, &#x27;wb&#x27;) as fp:</span></span><br><span class="line"><span class="comment">#     runner = HTMLTestRunner(fp, verbosity=2)</span></span><br><span class="line"><span class="comment">#     runner.run(suit)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用BeautifulReport输出测试报告</span></span><br><span class="line">now = time.strftime(<span class="string">&quot;%Y-%m-%d-%H-%M-%S&quot;</span>, time.localtime(time.time()))</span><br><span class="line">report_title = <span class="string">&quot;测试报告&quot;</span> + now + <span class="string">&#x27;.html&#x27;</span></span><br><span class="line">result = BeautifulReport(suit)</span><br><span class="line">result.report(filename=report_title, report_dir=<span class="string">&quot;F:\\SELENIUMPYTHON\\report&quot;</span>,</span><br><span class="line">                  description=<span class="string">&quot;描述信息&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>使用原生框架解决断言问题</li>
</ol>
<figure class="highlight python"><figcaption><span>改造断言，增加断言失败后的处理</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">demo</span>(unittest.TestCase):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">assert</span> <span class="number">51</span> == <span class="number">51</span>,<span class="string">&#x27;如果assert失败就显示这段提示&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="variable language_">self</span>.assertEqual(<span class="string">&#x27;asdf&#x27;</span>, <span class="string">&#x27;asdd&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> AssertionError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;捕捉失败后的处理&#x27;</span>)</span><br><span class="line">            <span class="keyword">raise</span> AssertionError(<span class="string">&#x27;断言失败&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>读取配置文件.ini，.yml，.excel</li>
</ol>
<figure class="highlight python"><figcaption><span>File类集成通用读取配置文件的方法</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> exists</span><br><span class="line"><span class="keyword">from</span> yaml <span class="keyword">import</span> safe_load_all, safe_load</span><br><span class="line"><span class="keyword">from</span> xlrd <span class="keyword">import</span> open_workbook</span><br><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">File</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, file_path: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> exists(file_path):</span><br><span class="line">            <span class="keyword">raise</span> FileNotFoundError</span><br><span class="line">        <span class="variable language_">self</span>._file_path = file_path</span><br><span class="line">        <span class="variable language_">self</span>._data = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">YamlReader</span>(<span class="title class_ inherited__">File</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, yml_path: <span class="built_in">str</span>, multi: <span class="built_in">bool</span> = <span class="literal">False</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        @param yml_path: yml文件的路径</span></span><br><span class="line"><span class="string">        @param multi: 是否进行多节读取</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>(YamlReader, <span class="variable language_">self</span>).__init__(yml_path)</span><br><span class="line">        <span class="variable language_">self</span>._multi = multi</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># self._data用于判断是否已经打开过yaml文件，如果是第一次打开就开始解析，如果是多次打开就直接返回</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>._data:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="variable language_">self</span>._file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>._multi:</span><br><span class="line">                    <span class="variable language_">self</span>._data = <span class="built_in">list</span>(safe_load_all(fp))  <span class="comment"># 读取多节</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="variable language_">self</span>._data = safe_load(fp)  <span class="comment"># 读取单节</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># obj = YamlReader(r&#x27;E:\网课\493 - 托尼老师-Python自动化测试开发实战 一门能就业的测试课-368元\课程资料\课程资料\autotest_framework-master\autotest_framework\chapter5\demo.yml&#x27;)</span></span><br><span class="line"><span class="comment"># print(obj.data)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExcelReader</span>(<span class="title class_ inherited__">File</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, excel_path: <span class="built_in">str</span>, sheet: [<span class="built_in">int</span>, <span class="built_in">str</span>], excel_title: <span class="built_in">bool</span> = <span class="literal">True</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        @param excel_path: excel文件存放的路径</span></span><br><span class="line"><span class="string">        @param sheet: 从哪个sheet表格读取，可以使用0，1，2也可以指定表格名称</span></span><br><span class="line"><span class="string">        @param excel_title:是否读取excel表头（第一行的数据），读取就返回一个字典，不读取就返回一个二维列表</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>(ExcelReader, <span class="variable language_">self</span>).__init__(excel_path)</span><br><span class="line">        <span class="variable language_">self</span>._sheet = sheet</span><br><span class="line">        <span class="variable language_">self</span>._excel_title = excel_title</span><br><span class="line">        <span class="variable language_">self</span>._data = []</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>._data:</span><br><span class="line">            work_book = open_workbook(<span class="variable language_">self</span>._file_path)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(<span class="variable language_">self</span>._sheet, (<span class="built_in">int</span>, <span class="built_in">str</span>)):</span><br><span class="line">                <span class="keyword">raise</span> TypeError(<span class="string">&#x27;excel文件的表格不存在：&#123;&#125;不存在&#x27;</span>.<span class="built_in">format</span>(<span class="variable language_">self</span>._sheet))</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(<span class="variable language_">self</span>._sheet, <span class="built_in">int</span>):</span><br><span class="line">                s = work_book.sheet_by_index(<span class="variable language_">self</span>._sheet)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                s = work_book.sheet_by_name(<span class="variable language_">self</span>._sheet)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>._excel_title:</span><br><span class="line">                title = s.row_values(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, s.nrows):</span><br><span class="line">                    <span class="variable language_">self</span>._data.append(<span class="built_in">dict</span>(<span class="built_in">zip</span>(title, s.row_values(col))))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, s.nrows):</span><br><span class="line">                    <span class="variable language_">self</span>._data.append(s.row_values(col))</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._data</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">excel中读取表头和不读取表头的两种方式</span></span><br><span class="line"><span class="string">A  B  C</span></span><br><span class="line"><span class="string">A1 B1 C1</span></span><br><span class="line"><span class="string">A2 B2 C2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ExcelReader(path, sheet=0).data</span></span><br><span class="line"><span class="string">[&#123;A:A1,B:B1,C:C1&#125;,&#123;A:A2,B:B2,C:C2&#125;]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ExcelReader(path, sheet=0,excel_title=False).data</span></span><br><span class="line"><span class="string">[[A1,B1,C1],[A2,B2,C2]]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">INIReader</span>(<span class="title class_ inherited__">File</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, ini_path: <span class="built_in">str</span>, section: <span class="built_in">str</span> = <span class="string">&#x27;MYSQL&#x27;</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        @param ini_path:</span></span><br><span class="line"><span class="string">        @param section:指定读取那一节，默认是mysql</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>(INIReader, <span class="variable language_">self</span>).__init__(ini_path)</span><br><span class="line">        <span class="variable language_">self</span>._data = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>._section = section.upper()</span><br><span class="line">        <span class="variable language_">self</span>._parser = configparser.ConfigParser() <span class="comment">#专门解析ini文件的包</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>._data:</span><br><span class="line">            <span class="variable language_">self</span>._parser.read(<span class="variable language_">self</span>._file_path, encoding=<span class="string">&#x27;UTF-8&#x27;</span>)</span><br><span class="line">            <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="variable language_">self</span>._parser.items(<span class="variable language_">self</span>._section):</span><br><span class="line">                <span class="comment"># ini文件解析的key和value都是字符串，现在有些key对应的value是int类型</span></span><br><span class="line">                <span class="variable language_">self</span>._data[k] = <span class="built_in">int</span>(v) <span class="keyword">if</span> k <span class="keyword">in</span> (<span class="string">&#x27;port&#x27;</span>, <span class="string">&#x27;maxsize&#x27;</span>, <span class="string">&#x27;minsize&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;increment&#x27;</span>) <span class="keyword">else</span> v</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._data</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>ddt 的用法</li>
</ol>
<figure class="highlight python"><figcaption><span>ddt读取txt,json,yml文件</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> ddt <span class="keyword">import</span> ddt, data, unpack, file_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_txt_data</span>():</span><br><span class="line">    txt_data = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./a.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> txtFile:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> txtFile.readlines():</span><br><span class="line">            txt_data.append(line.strip(<span class="string">&#x27;\n&#x27;</span>).split(<span class="string">&#x27;，&#x27;</span>))</span><br><span class="line">        <span class="keyword">return</span> txt_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_json_data</span>():</span><br><span class="line">    json_data = json.load(<span class="built_in">open</span>(<span class="string">&#x27;a.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> json_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@ddt</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dddt</span>(unittest.TestCase):</span><br><span class="line"></span><br><span class="line"><span class="meta">    @data(<span class="params">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">    @unpack</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_ddt</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="comment"># print(type(name), name,age)</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @data(<span class="params">*read_txt_data(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="meta">    @unpack</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_ddt_txt</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="comment"># print(type(name), name,age)  #&lt;class &#x27;str&#x27;&gt; 777</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># @data(*read_json_data())</span></span><br><span class="line">    <span class="comment"># @unpack</span></span><br><span class="line">    <span class="comment"># def test_ddt_json(self, name, age):</span></span><br><span class="line">    <span class="comment">#     print(name,&quot;:&quot;,age)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 特殊情况：当入口与文件中数据参数无法统一命名时，解决办法</span></span><br><span class="line"><span class="meta">    @data(<span class="params">*read_json_data(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="meta">    @unpack</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_ddt_json2</span>(<span class="params">self, **jsondata</span>):</span><br><span class="line">        <span class="comment"># print(jsondata[&quot;name&quot;], &quot;:&quot;, jsondata[&quot;age&quot;])</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">    @file_data(<span class="params"><span class="string">&#x27;./b.yml&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_ddt_yaml</span>(<span class="params">self,*data</span>): <span class="comment"># *代表顺序阅读列表类型，**代表顺序阅读对象(字典)类型</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(data),data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    unittest.main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><figcaption><span>ddt读取数据的多种方法</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">#ddt,使用@ddt(针对类),@data,@unpack,@file_data加载数据</span></span><br><span class="line"><span class="comment">#@data @unpack @file_data 针对方法</span></span><br><span class="line"><span class="keyword">from</span> ddt <span class="keyword">import</span> ddt,data,unpack,file_data</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>():</span><br><span class="line">    testdata = [&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;tom&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">21</span>&#125;, &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;wendy&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">22</span>&#125;]</span><br><span class="line">    <span class="keyword">return</span> testdata</span><br><span class="line"><span class="meta">@ddt</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyTestCase</span>(unittest.TestCase):</span><br><span class="line">    <span class="comment">#读取一个元组</span></span><br><span class="line"><span class="meta">    @data(<span class="params"><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_001</span>(<span class="params">self,value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(value),value)  <span class="comment">#返回内容-&lt;class &#x27;int&#x27;&gt;： 1 2 3</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">#读取一个字符串</span></span><br><span class="line"><span class="meta">    @data(<span class="params"><span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_001_1</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(value), value)  <span class="comment"># 返回内容-&lt;class &#x27;str&#x27;&gt;： 1 2 3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#读取多个元组</span></span><br><span class="line"><span class="meta">    @data(<span class="params">(<span class="params"><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span></span>),(<span class="params"><span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span></span>)</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_002</span>(<span class="params">self,value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(value),value)  <span class="comment">#返回内容-&lt;class &#x27;tuple&#x27;&gt;：(1,2,3),(4,5,6)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @data(<span class="params">(<span class="params"><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span></span>),(<span class="params"><span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span></span>)</span>)</span></span><br><span class="line"><span class="meta">    @unpack </span><span class="comment">#拆包</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_003</span>(<span class="params">self,value1,value2,value3</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(value1),<span class="built_in">type</span>(value2),<span class="built_in">type</span>(value3),value1,value2,value3)  <span class="comment">#返回内容&lt;class &#x27;int&#x27;&gt;：1 2 3 \n 4 5 6</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#列表</span></span><br><span class="line"><span class="meta">    @data(<span class="params">[&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">21</span>&#125;,&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;wendy&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">22</span>&#125;]</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_004</span>(<span class="params">self,value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(value),value)    <span class="comment">#返回内容&lt;class &#x27;list&#x27;&gt;：[&#123;&#x27;name&#x27;: &#x27;tom&#x27;, &#x27;age&#x27;: 21&#125;, &#123;&#x27;name&#x27;: &#x27;wendy&#x27;, &#x27;age&#x27;: 22&#125;]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">#字典</span></span><br><span class="line"><span class="meta">    @data(<span class="params">&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">21</span>&#125;,&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;wendy&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">22</span>&#125;</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_005</span>(<span class="params">self,value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(value),value)  <span class="comment">#返回内容&lt;class &#x27;dict&#x27;&gt;：&#123;&#x27;name&#x27;: &#x27;tom&#x27;, &#x27;age&#x27;: 21&#125; \n &#123;&#x27;name&#x27;: &#x27;wendy&#x27;, &#x27;age&#x27;: 22&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#字典-value</span></span><br><span class="line"><span class="meta">    @data(<span class="params">&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="string">&#x27;21&#x27;</span>&#125;,&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;wendy&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="string">&#x27;22&#x27;</span>&#125;</span>)</span></span><br><span class="line"><span class="meta">    @unpack</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_006</span>(<span class="params">self,name,age</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(name),<span class="built_in">type</span>(age),name,age)  <span class="comment">#返回内容 &lt;class &#x27;str&#x27;&gt;：tom 21 wendy 22</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#变量或者方法调用</span></span><br><span class="line">    testdata =[&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">21</span>&#125;,&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;wendy&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">22</span>&#125;]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#方法调用</span></span><br><span class="line"><span class="meta">    @data(<span class="params">get_data(<span class="params"></span>)</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_007</span>(<span class="params">self,value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(value),value)  <span class="comment">#返回内容&lt;class &#x27;list&#x27;&gt;：[&#123;&#x27;name&#x27;: &#x27;tom&#x27;, &#x27;age&#x27;: 21&#125;, &#123;&#x27;name&#x27;: &#x27;wendy&#x27;, &#x27;age&#x27;: 22&#125;]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#变量调用</span></span><br><span class="line"><span class="meta">    @data(<span class="params">testdata</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_008</span>(<span class="params">self,value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(value),value)   <span class="comment">#返回内容&lt;class &#x27;list&#x27;&gt;：[&#123;&#x27;name&#x27;: &#x27;tom&#x27;, &#x27;age&#x27;: 21&#125;, &#123;&#x27;name&#x27;: &#x27;wendy&#x27;, &#x27;age&#x27;: 22&#125;]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#读文件</span></span><br><span class="line"><span class="meta">    @file_data(<span class="params">os.getcwd(<span class="params"></span>)+<span class="string">&#x27;/testjson.json&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_009</span>(<span class="params">self,value</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(value),value)  <span class="comment">#返回内容&lt;class &#x27;list&#x27;&gt; [&#x27;wendy&#x27;, &#x27;honghong&#x27;, &#x27;xignxing&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>测试库</category>
      </categories>
      <tags>
        <tag>unittest</tag>
      </tags>
  </entry>
  <entry>
    <title>pytest框架与自动化测试应用</title>
    <url>/post/python-7-pytest.html</url>
    <content><![CDATA[<h2 id="pytest-文件命名（也可以修改默认的搜索规则）"><a href="#pytest-文件命名（也可以修改默认的搜索规则）" class="headerlink" title="pytest 文件命名（也可以修改默认的搜索规则）"></a>pytest 文件命名（也可以修改默认的搜索规则）</h2><ol>
<li><p>测试文件命名为**<font style="color:#E8323C;">test_XXX.py</font><strong>或者</strong><font style="color:#E8323C;">XXX_test.py</font>**</p>
</li>
<li><p>测试函数，测试方法命名为**<font style="color:#F5222D;">test_XXX</font>**</p>
</li>
<li><p>测试类命名为**<font style="color:#F5222D;">TestXXX</font>**</p>
</li>
<li><p>测试搜索规则：</p>
<ul>
<li>从一个或多个目录开始查找，在命令行中指定文件名或者目录名，未指定就是用当前目录</li>
<li>在该目录和所有子目录下递归查找测试模块</li>
<li>测试模块是指文件名为 test_<em>.py 或者</em>_test.py 的文件</li>
<li>在测试模块中查找以 test_开头的函数名</li>
<li>查找名字以 Test 开头的类，首先筛选掉包含<strong>init</strong>函数的类，再查找以 Test_开头的类方法</li>
</ul>
</li>
</ol>
<h2 id="pytest-框架结构"><a href="#pytest-框架结构" class="headerlink" title="pytest 框架结构"></a>pytest 框架结构</h2><ul>
<li>模块级 -模块始末运行：setup_module&#x2F;teardown_module，</li>
<li>函数级别-函数始末运行（在类外部）：setup_function&#x2F;teardown_function</li>
<li>类级 -类始末运行（在类中）：setup_class&#x2F;teardown_class，必须以@classmethod 装饰</li>
<li>方法级 -方法始末运行（在类中）：setup_method&#x2F;teardown_method</li>
<li>方法级 -方法始末运行（在类中）：setup&#x2F;teardown</li>
</ul>
<h2 id="pytest-运行结果"><a href="#pytest-运行结果" class="headerlink" title="pytest 运行结果"></a>pytest 运行结果</h2><ol>
<li>passed-.，测试通过</li>
<li>failed-F， 测试失败，（也可能是由 xpass 状态与 strict 选项冲突造成的失败）</li>
<li>skipped-s，测试未被执行（标记为@pytest.mark.skip() 或者@pytest.mark.skipif() ）</li>
<li>xfail-x，预期测试失败，并且确实失败 (标记为@pytest.mark.xfail() )</li>
<li>xpass-X，预期测试失败，但实际上运行通过，不符合预期</li>
<li>error-E，测试用例之外的代码触发了异常，可能由 fixture 或者 hook 函数引起</li>
</ol>
<h2 id="pytest-运行选项"><a href="#pytest-运行选项" class="headerlink" title="pytest 运行选项"></a>pytest 运行选项</h2><h3 id="pytest-静态挑选测试用例"><a href="#pytest-静态挑选测试用例" class="headerlink" title="pytest 静态挑选测试用例"></a>pytest 静态挑选测试用例</h3><pre><code>pytest tests/func/test_add.py (运行单个文件里的全部测试)
pytest tests/func::TestUpdate (运行单个测试类)
pytest tests/func/test_add.py::test_add_return_valid_id (运行单个测试函数)
pytest tests/func::TestUpdate::test_bad_id (运行单个测试类中的测试方法)
</code></pre>
<h3 id="pytest-动态挑选测试用例"><a href="#pytest-动态挑选测试用例" class="headerlink" title="pytest 动态挑选测试用例"></a>pytest 动态挑选测试用例</h3><h4 id="1-pytest-k-“asdict-or-defaults”-–collect-only-加上-k-指定特定运行的用例，用测试名划分测试集合，可以指定测试文件名，目录，类名，函数名"><a href="#1-pytest-k-“asdict-or-defaults”-–collect-only-加上-k-指定特定运行的用例，用测试名划分测试集合，可以指定测试文件名，目录，类名，函数名" class="headerlink" title="1 pytest -k “asdict or defaults” –collect-only (加上-k 指定特定运行的用例，用测试名划分测试集合，可以指定测试文件名，目录，类名，函数名)"></a>1 pytest -k “asdict or defaults” –collect-only (加上-k 指定特定运行的用例，用测试名划分测试集合，可以指定测试文件名，目录，类名，函数名)</h4><blockquote>
<p>-k 允许用一个表达式指定需要运行的是测试，该表达式可以匹配测试名（或其字串）模糊匹配，表达式中可以包含 and，or，not<br>pytest -v -k _raises (测试方法为 test_add_raises,test_get_raises,test_delete_raises)<br>pytest -v -k “_raises and not delete”，就会跳过 test_delete_raises 的执行</p>
</blockquote>
<p>pytest -k ‘test_laugou.py’ 按照文件名全匹配，运行 test_laugou.py 下所有用例<br>pytest -k ‘laugou’ 按照文件名部分匹配，运行 test_laugou.py 下所有用例<br>ptest -k ‘Baidu’ 按照类名匹配，运行下 Baidu 测试类下所有用例<br>pytest -k ‘message’ 按照方法名匹配，test_message 这个测试方法会被执行</p>
<p><img src="/images/python71.png"></p>
<h4 id="2-pytest-m-run-please（用于标记测试类-测试方法并分组，以便快速选中并允许）-使用-m-选项可以用表达式指定多个标记名："><a href="#2-pytest-m-run-please（用于标记测试类-测试方法并分组，以便快速选中并允许）-使用-m-选项可以用表达式指定多个标记名：" class="headerlink" title="2 pytest -m run_please（用于标记测试类&#x2F;测试方法并分组，以便快速选中并允许）,使用-m 选项可以用表达式指定多个标记名："></a>2 pytest -m run_please（用于标记测试类&#x2F;测试方法并分组，以便快速选中并允许）,使用-m 选项可以用表达式指定多个标记名：</h4><pre><code>1. -m &quot;mark1 and mark2&quot; （选中带有这两个标记的所有测试用例）
2. -m &quot;mark1 or mark2&quot;    （选中带有mark1或者mark2的所有测试用例）
3. -m &quot;mark1 and not mark2&quot;    （选中带有mark1的所有测试用例，过滤掉带有mark2的）
</code></pre>
<p><img src="/images/python72.png"> <img src="/images/python73.png"></p>
<h3 id="pytest-忽略测试用例"><a href="#pytest-忽略测试用例" class="headerlink" title="pytest 忽略测试用例"></a>pytest 忽略测试用例</h3><h4 id="1-忽略某一个测试文件-–ignore"><a href="#1-忽略某一个测试文件-–ignore" class="headerlink" title="1 忽略某一个测试文件 –ignore"></a>1 忽略某一个测试文件 –ignore</h4><p>pytest -m pytest –ignore&#x3D;test&#x2F;test_itesting.py</p>
<h4 id="2-忽略某一个测试方法-–deselect"><a href="#2-忽略某一个测试方法-–deselect" class="headerlink" title="2 忽略某一个测试方法 –deselect"></a>2 忽略某一个测试方法 –deselect</h4><p>pytest -m pytest –deselect&#x3D;test&#x2F;test_itesting.py::test_a</p>
<h4 id="3-使用-pytest-mark-skip-装饰器忽略"><a href="#3-使用-pytest-mark-skip-装饰器忽略" class="headerlink" title="3 使用 @pytest.mark.skip 装饰器忽略"></a>3 使用 @pytest.mark.skip 装饰器忽略</h4><p>@pytest.mark.skip(reason&#x3D;’misunderstood the API’)</p>
<h4 id="4-使用-pytest-mark-skipif-装饰器忽略"><a href="#4-使用-pytest-mark-skipif-装饰器忽略" class="headerlink" title="4 使用 @pytest.mark.skipif 装饰器忽略"></a>4 使用 @pytest.mark.skipif 装饰器忽略</h4><p>@pytest.mark.skipif(tasks.version &lt; ‘0.2.0’, reason&#x3D;‘not supported until version 0.2.0’) 条件成立就跳过测试用例</p>
<h4 id="5-使用-m-或者-k-参数忽略"><a href="#5-使用-m-或者-k-参数忽略" class="headerlink" title="5 使用-m 或者-k 参数忽略"></a>5 使用-m 或者-k 参数忽略</h4><h3 id="pytest-命令行参数"><a href="#pytest-命令行参数" class="headerlink" title="pytest 命令行参数"></a>pytest 命令行参数</h3><h4 id="1-pytest-v-（详细展示结果，每个文件中的每个测试用例占一行，文件名函数名结果都会显示出来）"><a href="#1-pytest-v-（详细展示结果，每个文件中的每个测试用例占一行，文件名函数名结果都会显示出来）" class="headerlink" title="1 pytest -v （详细展示结果，每个文件中的每个测试用例占一行，文件名函数名结果都会显示出来）"></a>1 pytest -v （详细展示结果，每个文件中的每个测试用例占一行，文件名函数名结果都会显示出来）</h4><p>（没用-v 之前是每个测试文件占一行，测试结果是.或者 F 这种单个字符）</p>
<h4 id="2-pytest-q-和-v-相反，回简化输出信息"><a href="#2-pytest-q-和-v-相反，回简化输出信息" class="headerlink" title="2 pytest -q (和-v 相反，回简化输出信息)"></a>2 pytest -q (和-v 相反，回简化输出信息)</h4><p>pytest -q –tb&#x3D;line（仅打印异常的代码位置）结合使用</p>
<h4 id="3-pytest-s-（允许终端输出-print-结果）"><a href="#3-pytest-s-（允许终端输出-print-结果）" class="headerlink" title="3 pytest -s （允许终端输出 print 结果）"></a>3 pytest -s （允许终端输出 print 结果）</h4><h4 id="4-pytest-–collect-only-（展示当前目录下哪些测试用例会被运行，非常方便的在测试运行之前，检查选中的测试用例是否符合预期）"><a href="#4-pytest-–collect-only-（展示当前目录下哪些测试用例会被运行，非常方便的在测试运行之前，检查选中的测试用例是否符合预期）" class="headerlink" title="4 pytest –collect-only （展示当前目录下哪些测试用例会被运行，非常方便的在测试运行之前，检查选中的测试用例是否符合预期）"></a>4 pytest –collect-only （展示当前目录下哪些测试用例会被运行，非常方便的在测试运行之前，检查选中的测试用例是否符合预期）</h4><p><img src="/images/python74.png"></p>
<h4 id="5-pytest-x-用于-debug-时候，遇到失败时立即停止整个会话-（正常情况下，不使用-x-遇到测试失败的用例，并不会停止执行后面的测试用例）"><a href="#5-pytest-x-用于-debug-时候，遇到失败时立即停止整个会话-（正常情况下，不使用-x-遇到测试失败的用例，并不会停止执行后面的测试用例）" class="headerlink" title="5 pytest -x (用于 debug 时候，遇到失败时立即停止整个会话)（正常情况下，不使用-x 遇到测试失败的用例，并不会停止执行后面的测试用例）"></a>5 pytest -x (用于 debug 时候，遇到失败时立即停止整个会话)（正常情况下，不使用-x 遇到测试失败的用例，并不会停止执行后面的测试用例）</h4><h4 id="56-pytest-–maxfail-2-x-时遇到测试失败就立即停止，–maxfail-是允许-pytest-失败几个后停止，明确指出可以失败几次"><a href="#56-pytest-–maxfail-2-x-时遇到测试失败就立即停止，–maxfail-是允许-pytest-失败几个后停止，明确指出可以失败几次" class="headerlink" title="56 pytest –maxfail&#x3D;2 (-x 时遇到测试失败就立即停止，–maxfail 是允许 pytest 失败几个后停止，明确指出可以失败几次)"></a>56 pytest –maxfail&#x3D;2 (-x 时遇到测试失败就立即停止，–maxfail 是允许 pytest 失败几个后停止，明确指出可以失败几次)</h4><p>pytest –max-fail&#x3D;1 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; pytest -x (这两个作用一样的)</p>
<h4 id="7-pytest-v-lf-–last-failed-当一个或者多个测试失败时，再次运行并使用–lf-时，仅运行上次未通过的测试用例"><a href="#7-pytest-v-lf-–last-failed-当一个或者多个测试失败时，再次运行并使用–lf-时，仅运行上次未通过的测试用例" class="headerlink" title="7 pytest -v -lf –last-failed (当一个或者多个测试失败时，再次运行并使用–lf 时，仅运行上次未通过的测试用例)"></a>7 pytest -v -lf –last-failed (当一个或者多个测试失败时，再次运行并使用–lf 时，仅运行上次未通过的测试用例)</h4><h4 id="8-pytest-v-ff-–failed-first-当一个或者多个测试失败时，再次运行并使用–ff-时，之前运行未通过的用例会首先执行，然后才是其他用例"><a href="#8-pytest-v-ff-–failed-first-当一个或者多个测试失败时，再次运行并使用–ff-时，之前运行未通过的用例会首先执行，然后才是其他用例" class="headerlink" title="8 pytest -v -ff –failed-first (当一个或者多个测试失败时，再次运行并使用–ff 时，之前运行未通过的用例会首先执行，然后才是其他用例)"></a>8 pytest -v -ff –failed-first (当一个或者多个测试失败时，再次运行并使用–ff 时，之前运行未通过的用例会首先执行，然后才是其他用例)</h4><h4 id="9-pytest-l-–showlocals（失败测试用例由于被堆栈跟踪，所以局部变量以及值都会显示出来）"><a href="#9-pytest-l-–showlocals（失败测试用例由于被堆栈跟踪，所以局部变量以及值都会显示出来）" class="headerlink" title="9 pytest -l &#x2F; –showlocals（失败测试用例由于被堆栈跟踪，所以局部变量以及值都会显示出来）"></a>9 pytest -l &#x2F; –showlocals（失败测试用例由于被堆栈跟踪，所以局部变量以及值都会显示出来）</h4><h4 id="10-pytest-–tb-XXX-（决定捕捉到失败时输出信息的展示方式）"><a href="#10-pytest-–tb-XXX-（决定捕捉到失败时输出信息的展示方式）" class="headerlink" title="10 pytest –tb&#x3D;XXX （决定捕捉到失败时输出信息的展示方式）"></a>10 pytest –tb&#x3D;XXX （决定捕捉到失败时输出信息的展示方式）</h4><pre><code>1. short 模式仅输出assert的一行（不显示上下文）
2. line模式值使用一行输出所有的错误信息
3. no模式直接屏蔽全部回溯信息
4. long模式输出最为详尽的回溯信息
5. auto默认值，如果多个测试用例失败，只打印第一个和最后一个的回溯信息
6. native模式只输出python标准库的回溯信息
</code></pre>
<h4 id="11-pytest-–durations-N-vv-（统计测试过程中那几个阶段是最慢的，会显示最慢的-N-个阶段，耗时越长越靠前）"><a href="#11-pytest-–durations-N-vv-（统计测试过程中那几个阶段是最慢的，会显示最慢的-N-个阶段，耗时越长越靠前）" class="headerlink" title="11 pytest –durations&#x3D;N -vv （统计测试过程中那几个阶段是最慢的，会显示最慢的 N 个阶段，耗时越长越靠前）"></a>11 pytest –durations&#x3D;N -vv （统计测试过程中那几个阶段是最慢的，会显示最慢的 N 个阶段，耗时越长越靠前）</h4><p>pytest –durations&#x3D;0 （将所有结算按照耗时从长到短排序后显示）</p>
<p><img src="/images/python75.png"></p>
<p><strong><font style="color:#F5222D;">每个测试用例大体上都包含三个阶段：setup，call， teardown</font></strong></p>
<h4 id="12-pytest-h-（展示-pytest-的用法和新添加插件的选项）"><a href="#12-pytest-h-（展示-pytest-的用法和新添加插件的选项）" class="headerlink" title="12 pytest -h （展示 pytest 的用法和新添加插件的选项）"></a>12 pytest -h （展示 pytest 的用法和新添加插件的选项）</h4><h3 id="pytest-程序中执行-pytest-main"><a href="#pytest-程序中执行-pytest-main" class="headerlink" title="pytest 程序中执行 pytest.main()"></a>pytest 程序中执行 pytest.main()</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    pytest.main()   无参构造-运行目录及子目录下的所有用例</span><br><span class="line">    pytest.main([<span class="string">&#x27;testcsv.py&#x27;</span>]) 有参构造，运行指定模块所有用例</span><br><span class="line">    pytest.main([<span class="string">&#x27;testcsv.py::TestClass::testMethod&#x27;</span>]) 有参构造，运行指定模块指定用例</span><br><span class="line">    pytest.main([<span class="string">&#x27;testcsv.py&#x27;</span>, <span class="string">&#x27;-q&#x27;</span>])    -q:安静模式, 不输出环境信息</span><br><span class="line">    pytest.main([<span class="string">&#x27;testcsv.py&#x27;</span>, <span class="string">&#x27;-v&#x27;</span>])</span><br><span class="line">    pytest.main([<span class="string">&#x27;testcsv.py&#x27;</span>, <span class="string">&#x27;-s&#x27;</span>])     -s: 显示程序中的<span class="built_in">print</span>/logging输出:安静模式, 不输出环境信息</span><br><span class="line">    pytest.main([<span class="string">&#x27;testcsv.py&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>])     -x:出现一条测试用例失败就退出测试。</span><br><span class="line">    pytest.main([<span class="string">&#x27;testcsv.py&#x27;</span>, <span class="string">&#x27;--lf&#x27;</span>])   --lf:定位失败的用例</span><br><span class="line">    pytest.main([<span class="string">&#x27;testcsv.py&#x27;</span>, <span class="string">&#x27;-l&#x27;</span>])     -l 打印失败用例的变量值</span><br><span class="line"></span><br><span class="line">    <span class="comment">#使用allure生成 Html 格式的测试报告</span></span><br><span class="line">    pytest.main([<span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;--alluredir&#x27;</span>, <span class="string">&#x27;report/result&#x27;</span>, <span class="string">&#x27;testcsv.py&#x27;</span>])</span><br><span class="line">    split = <span class="string">&#x27;allure ’ + &#x27;</span>generate ’ + <span class="string">&#x27;./report/result ’ + &#x27;</span>-o ’ + <span class="string">&#x27;./report/html ’ + ‘–clean’</span></span><br><span class="line"><span class="string">    os.system(split)</span></span><br></pre></td></tr></table></figure>

<h2 id="pytest-参数化-parametrize"><a href="#pytest-参数化-parametrize" class="headerlink" title="pytest 参数化 parametrize"></a>pytest 参数化 parametrize</h2><blockquote>
<p>pytest 实现参数化的三种方式</p>
<ol>
<li>pytest.fixture() 使用 fixture 传 params 参数实现参数化</li>
<li>@pytest.mark.parametrize 允许在测试函数或类中定义多组参数</li>
<li>pytest_generate_tests 钩子函数允许定义自定义参数方案或扩展 P174</li>
</ol>
</blockquote>
<h3 id="parametrize-源码分析"><a href="#parametrize-源码分析" class="headerlink" title="parametrize 源码分析"></a>parametrize 源码分析</h3><p><font style="color:#bbb529;">@pytest.mark.parametrize(</font><font style="color:#F5222D;">argnames, argvalues，indirect&#x3D;False，ids&#x3D;None, scope&#x3D;None</font><font style="color:#bbb529;">) </font></p>
<ul>
<li><font style="color:#F5222D;">argnames</font> 参数名，是个字符串，如中间用逗号分隔则表示为多个参数名</li>
<li><font style="color:#F5222D;">argvalues </font>参数值，参数组成的列表，列表中有几个元素，就会生成几条用例（可用于函数，类，<font style="color:#F5222D;">用在类上，该数据集会被传递给该类的所有类方法</font>）</li>
<li><font style="color:#F5222D;">indirect ，</font>设置为 True，pytest 会把 argnames 当作函数执行，将 argvalues 作为参数传入到 argnames 这个函数里（见 2.4）</li>
</ul>
<h3 id="parametrize-使用方法"><a href="#parametrize-使用方法" class="headerlink" title="parametrize 使用方法"></a>parametrize 使用方法</h3><h4 id="parametrize-自动生成的用例标识"><a href="#parametrize-自动生成的用例标识" class="headerlink" title="parametrize 自动生成的用例标识"></a>parametrize 自动生成的用例标识</h4><ol>
<li><font style="color:#bbb529;">@pytest.mark.parametrize</font>(<font style="color:#6a8759;">‘task’</font><font style="color:#cc7832;">, </font>[Task(<font style="color:#6a8759;">‘sleep’</font><font style="color:#cc7832;">, </font><font style="color:#aa4926;">done</font>&#x3D;<font style="color:#cc7832;">True</font>)<font style="color:#cc7832;">,</font>Task(<font style="color:#6a8759;">‘wake’</font><font style="color:#cc7832;">, </font><font style="color:#6a8759;">‘brian’</font>)<font style="color:#cc7832;">,</font>Task(<font style="color:#6a8759;">‘breathe’</font><font style="color:#cc7832;">, </font><font style="color:#6a8759;">‘BRIAN’</font><font style="color:#cc7832;">, True</font>)<font style="color:#cc7832;">, </font>Task(<font style="color:#6a8759;">‘exercise’</font><font style="color:#cc7832;">, </font><font style="color:#6a8759;">‘BrIaN’</font><font style="color:#cc7832;">, False</font>)])</li>
</ol>
<p>没有指定 id，pytest 默认的用参数加数字作为 task 标识，task0,rask1,task2 这样。<br><img src="/images/python76.png"></p>
<ol start="2">
<li><font style="color:#bbb529;">@pytest.mark.parametrize</font>(<font style="color:#6a8759;">‘summary, owner, done’</font><font style="color:#cc7832;">, </font>[(<font style="color:#6a8759;">‘sleep’</font><font style="color:#cc7832;">, None, False</font>)<font style="color:#cc7832;">,</font>(<font style="color:#6a8759;">‘wake’</font><font style="color:#cc7832;">, </font><font style="color:#6a8759;">‘brian’</font><font style="color:#cc7832;">, False</font>)<font style="color:#cc7832;">,</font>(<font style="color:#6a8759;">‘breathe’</font><font style="color:#cc7832;">, </font><font style="color:#6a8759;">‘BRIAN’</font><font style="color:#cc7832;">, True</font>)<font style="color:#cc7832;">, </font>(<font style="color:#6a8759;">‘eat eggs’</font><font style="color:#cc7832;">, </font><font style="color:#6a8759;">‘BrIaN’</font><font style="color:#cc7832;">, False</font>)<font style="color:#cc7832;">,</font>])</li>
</ol>
<p>将 task 替换成几组键值对，易于被 pytest 装换成字符串的数据对象，则输出结果中的测试标识会使用组合后的参数值以增强可读性。</p>
<p><img src="/images/python77.png"></p>
<p>还可以直接使用完整的测试标识来指定需要运行的测试：</p>
<p>pytest -v test_add_variety.py::test_add_3[sleep-None-False]或者</p>
<p>参数有空格的就得加引号 pytest -v “test_add_variety.py::test_add_3[eat eggs-None-False]”</p>
<h4 id="ids-参数用法"><a href="#ids-参数用法" class="headerlink" title="ids 参数用法"></a>ids 参数用法</h4><ol>
<li><font style="color:#bbb529;">@pytest.mark.parametrize</font>(<font style="color:#6a8759;">‘task’</font><font style="color:#cc7832;">, </font>tasks_to_try<font style="color:#cc7832;">, </font><font style="color:#aa4926;">ids</font>&#x3D;task_ids)</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tasks_to_try = (Task(<span class="string">&#x27;sleep&#x27;</span>, done=<span class="literal">True</span>),</span><br><span class="line">                Task(<span class="string">&#x27;wake&#x27;</span>, <span class="string">&#x27;brian&#x27;</span>),</span><br><span class="line">                Task(<span class="string">&#x27;wake&#x27;</span>, <span class="string">&#x27;brian&#x27;</span>),</span><br><span class="line">                Task(<span class="string">&#x27;breathe&#x27;</span>, <span class="string">&#x27;BRIAN&#x27;</span>, <span class="literal">True</span>),</span><br><span class="line">                Task(<span class="string">&#x27;exercise&#x27;</span>, <span class="string">&#x27;BrIaN&#x27;</span>, <span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line">task_ids = [<span class="string">&#x27;Task(&#123;&#125;,&#123;&#125;,&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(t.summary, t.owner, t.done) <span class="keyword">for</span> t <span class="keyword">in</span> tasks_to_try]  <span class="comment">#由于给数据集分配了一个变量tasks_to_try，所以通过它生成ids</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#引入parametrize（）一个额外参数ids，使列表中的每一个元素被标识</span></span><br><span class="line"><span class="comment">#ids是一个字符串列表，它和数据对象列表的长度保持一致(这里的ids是列表，也可以指定是一个函数）</span></span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&#x27;task&#x27;</span>, tasks_to_try, ids=task_ids</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add_5</span>(<span class="params">task</span>):</span><br><span class="line">    task_id = tasks.add(task)</span><br><span class="line">    t_from_db = tasks.get(task_id)</span><br><span class="line">    <span class="keyword">assert</span> equivalent(t_from_db, task)</span><br></pre></td></tr></table></figure>

<p><img src="/images/python78.png"></p>
<ol start="2">
<li><font style="color:#bbb529;">@pytest.mark.parametrize</font>(<font style="color:#6a8759;">‘task’</font><font style="color:#cc7832;">, </font>[<br>pytest.param(Task(<font style="color:#6a8759;">‘create’</font>)<font style="color:#cc7832;">, </font><font style="color:#aa4926;">id</font>&#x3D;<font style="color:#6a8759;">‘just summary’</font>)<font style="color:#cc7832;">,<br></font><font style="color:#cc7832;"> </font>pytest.param(Task(<font style="color:#6a8759;">‘inspire’</font><font style="color:#cc7832;">, </font><font style="color:#6a8759;">‘Michelle’</font>)<font style="color:#cc7832;">, </font><font style="color:#aa4926;">id</font>&#x3D;<font style="color:#6a8759;">‘summary&#x2F;owner’</font>)<font style="color:#cc7832;">,<br></font><font style="color:#cc7832;"> </font>pytest.param(Task(<font style="color:#6a8759;">‘encourage’</font><font style="color:#cc7832;">, </font><font style="color:#6a8759;">‘Michelle’</font><font style="color:#cc7832;">, True</font>)<font style="color:#cc7832;">, </font><font style="color:#aa4926;">id</font>&#x3D;<font style="color:#6a8759;">‘summary&#x2F;owner&#x2F;done’</font>)])</li>
</ol>
<p>在给@pytest.mark.parametrize() 装饰器传入列表参数时，还可以在参数值旁边定义一个 id 来做标识，语法是<font style="color:#F5222D;">pytest.param(<value>，id&#x3D;”XX”)</font></p>
<p><font style="color:#F5222D;">在 id 不能被参数化批量生成，需要自定义的时候，这个方法很管用</font></p>
<h4 id="多次使用-paramtrize"><a href="#多次使用-paramtrize" class="headerlink" title="多次使用 paramtrize"></a>多次使用 paramtrize</h4><p>同一个测试用例还可以同时添加多个<font style="color:#bbb529;">@pytest.mark.parametrize</font>装饰器，多个 parametrize 的所有元素互相组合（类似笛卡尔积），生成大量测试用例</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;x&quot;</span>, [<span class="number">1</span>, <span class="number">2</span>]</span>)</span></span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;y&quot;</span>, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_search2</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="built_in">print</span>(x, y)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># test_fixture_scope.py::test_search2[3-1]</span></span><br><span class="line"><span class="comment"># test_fixture_scope.py::test_search2[3-2]</span></span><br><span class="line"><span class="comment"># test_fixture_scope.py::test_search2[4-1]</span></span><br><span class="line"><span class="comment"># test_fixture_scope.py::test_search2[4-2]</span></span><br><span class="line"><span class="comment"># test_fixture_scope.py::test_search2[5-1]</span></span><br><span class="line"><span class="comment"># test_fixture_scope.py::test_search2[5-2]</span></span><br></pre></td></tr></table></figure>

<h4 id="pytest-fixture-与-pytest-mark-parametrize-结合实现参数化（indirect-参数用法）"><a href="#pytest-fixture-与-pytest-mark-parametrize-结合实现参数化（indirect-参数用法）" class="headerlink" title="@pytest.fixture 与@pytest.mark.parametrize 结合实现参数化（indirect 参数用法）"></a><font style="color:#1DC0C9;background-color:rgba(255, 255, 255, 0);">@pytest.fixture 与@pytest.mark.parametrize 结合实现参数化（indirect 参数用法）</font></h4><blockquote>
<p>如果测试数据需要在 fixture 方法中使用，同时也需要在测试用例中使用，可以在使用 parametrize 的时候添加一个参数 indirect&#x3D;True，pytest 可以实现将参数传入到 fixture 方法中，也可以在当前测试用例中使用</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&quot;module&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    user = request.param</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;登录用户<span class="subst">&#123;user&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;login&quot;</span>, [<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;jerry&#x27;</span>],indirect=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_indirect</span>(<span class="params">login</span>):</span><br><span class="line">    a = login</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;测试用例中login的返回值:<span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录用户tom</span></span><br><span class="line"><span class="comment"># PASSED                   [ 50%]测试用例中login的返回值:tom</span></span><br><span class="line"><span class="comment"># 登录用户jerry</span></span><br><span class="line"><span class="comment"># PASSED                 [100%]测试用例中login的返回值:jerry</span></span><br></pre></td></tr></table></figure>

<p>代码的结果可以看到，当 indirect&#x3D;True 时，会将 login 作为参数，[‘tom’,’jerry’]作为参数传入 login 的 fixture 中，生成多条用例。通过 return 将结果返回，当调用 login 可以获取到 login 这个方法的返回数据。</p>
<h4 id="argnames-的用法-其他参数详细用法见书-P165"><a href="#argnames-的用法-其他参数详细用法见书-P165" class="headerlink" title="argnames 的用法 [其他参数详细用法见书 P165]"></a>argnames 的用法 <font style="color:#F1A2AB;">[其他参数详细用法见书 P165]</font></h4><p>parametrize 方法中的第一个参数 argnames 是一个被逗号分隔的字符串&#x2F;列表&#x2F;元组,表明指定的参数, argnames 通常是与被标记测试方法入参的参数名对应的,但实际上有一些限制,它只能是被标记测试方法入参的子集</p>
<ol>
<li>测试方法中未声明, mark.parametrize 中声明</li>
</ol>
<p>test_sample 测试方法中未声明 expected, 如果在标记中强行声明,会报错</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&#x27;input, expected&#x27;</span>, [(<span class="params"><span class="number">1</span>,<span class="number">2</span></span>)]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_sample</span>(<span class="params"><span class="built_in">input</span></span>):</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>测试方法参数声明范围小于 mark.parametrize 声明范围, 即不能是被标记测试方法入参中定义了默认值的参数</li>
</ol>
<p>test_sample 测试方法中声明 expected 参数但同时赋予了默认值, 如果在标记中强行声明,会报错</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&#x27;input, expected&#x27;</span>, [(<span class="params"><span class="number">1</span>,<span class="number">2</span></span>)]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_sample</span>(<span class="params"><span class="built_in">input</span>, expected=<span class="number">2</span></span>):</span><br></pre></td></tr></table></figure>

<h2 id="pytest-自定义-Fixture"><a href="#pytest-自定义-Fixture" class="headerlink" title="pytest 自定义 Fixture"></a>pytest 自定义 Fixture</h2><blockquote>
<p>fixture 是在测试函数运行前后，由 pytest 执行的外壳函数</p>
<p>fixture 中的代码可以定制，满足多变的测试需求，包括定义传入测试中的数据集，配置测试前系统的初始状态，为批量测试提供数据源</p>
<p><font style="background-color:rgba(255, 255, 255, 0);">pytest.fixture(scope&#x3D;”function”, params&#x3D;None, autouse&#x3D;False, ids&#x3D;None, name&#x3D;None)</font></p>
</blockquote>
<h3 id="fixture-的-scope-作用范围哪几种值？"><a href="#fixture-的-scope-作用范围哪几种值？" class="headerlink" title="fixture 的 scope 作用范围哪几种值？"></a>fixture 的 scope 作用范围哪几种值？</h3><blockquote>
<p>scope 控制该 fixture 的作用范围<br>作用范围@pytest.fixture(scope&#x3D;’function’)，作用范围由小到大：function、&gt; class、module、package、session</p>
</blockquote>
<blockquote>
<p>scope&#x3D;function（fixture 默认值）,所以我们不传的时候，（function 函数或者方法级&gt;别）都会被调用，<br>scope&#x3D;class 可以实现每个测试类（class 类级别）前执行一次，<br>scope&#x3D;module 在每个 py 文件（module 模块级别）执行前执行一次，<br>scope&#x3D;session 即 pytest 的会话，即所有的测试执行开始到结束，只会执行一次的操作（多个文件调用一次，可以跨.py 文件调用，每个.py 文件就是 module）</p>
</blockquote>
<p>使用 <font style="color:#F5222D;">–setup-show 参数 </font>回溯 fixture 的执行过程</p>
<p><img src="/images/python79.png"></p>
<h3 id="fixture-参数化-params"><a href="#fixture-参数化-params" class="headerlink" title="fixture 参数化 params"></a>fixture 参数化 params</h3><blockquote>
<ol>
<li>fixture 参数列表中的 request 也是 pytest 内建的 fixture 之一，代表 fixture 的调用状态，它有一个 param 字段会被@pytest.fixture(params&#x3D;[1, 2, 3, 4])的 params 列表中的一个元素填充</li>
<li>装饰器@pytest.fixture(params&#x3D;[1, 2, 3, 4]，会分别传入数据 1，2，3 到用例中，这里传入的是个列表，传入的数据需要使用一个固定的参数名<font style="background-color:#F9EFCD;">request.param</font>来接收，对于 params 里面的每个值，fixture 都会调用执行一次。</li>
</ol>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#def id_fuc():</span></span><br><span class="line"><span class="comment">#    ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">autouse=<span class="literal">True</span>, params=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], name=<span class="string">&#x27;eee&#x27;</span></span>)</span></span><br><span class="line"><span class="comment">#@pytest.fixture(autouse=True, params=[1, 2, 3, 4], name=&#x27;eee&#x27;, ids=id_func)  #ids参数也可以被指定为一个函数，供pytest生成标识</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">data_eee</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> request.param</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_use_fixtures</span>():</span><br><span class="line">    <span class="keyword">assert</span> eee <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    pytest.main()</span><br></pre></td></tr></table></figure>

<p><img src="/images/python710.png"></p>
<h3 id="fixture-的-ids"><a href="#fixture-的-ids" class="headerlink" title="fixture 的 ids"></a>fixture 的 ids</h3><p>指定每个字符串 id，当有多个 param 时，针对每个 param，可以指定 id，这个 id 将成为测试用例名字的一部分，如果没有提供 id，则自动生成一个 id.</p>
<h3 id="fixture-隐式调用-autouse"><a href="#fixture-隐式调用-autouse" class="headerlink" title="fixture 隐式调用 autouse"></a>fixture 隐式调用 autouse</h3><p>如果每条用例都需要前置执行 fixture 功能，则需要在每一个用例方法参数里面传入这个 fixture 的名字，这里在装饰器里面添加一个 autouse&#x3D;”true”参数，会自动应用到所有的测试方法中</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">autouse=<span class="string">&quot;true&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">some_data</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;yield前面的代码执行111111&quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span>  <span class="number">42</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;yield前面的代码执行222222&quot;</span>)</span><br><span class="line">    <span class="comment"># return 42</span></span><br></pre></td></tr></table></figure>

<h3 id="fixture-重命名-name"><a href="#fixture-重命名-name" class="headerlink" title="fixture 重命名 name"></a>fixture 重命名 name</h3><p><font style="color:#bbb529;">@pytest.fixture</font>(<font style="color:#aa4926;">name</font>&#x3D;<font style="color:#6a8759;">“eee”</font>)，使用 fixture 的 name 参数对此 fixture 重命名</p>
<p>pytest –fixtures XXX.py 如果想找出 eee 是哪里定义的，可以指定–fixtures 命令选项，并提供所在测试文件名，pytest 将列举所有可供测试使用的 fixture 包括重命名的。</p>
<h3 id="将-fixture-作为函数参数使用（基本用法-pytest-fixture-）"><a href="#将-fixture-作为函数参数使用（基本用法-pytest-fixture-）" class="headerlink" title="将 fixture 作为函数参数使用（基本用法@pytest.fixture()）"></a>将 fixture 作为函数参数使用（基本用法<font style="color:#bbb529;">@pytest.fixture</font>()）</h3><p><font style="color:#bbb529;">@pytest.fixture</font>()装饰器用于声明函数是一个 fixture，如果测试函数的参数列表中包含 fixture 名，pytest 会以该名称搜索 fixture（先搜索该测试所在的模块，然后搜索 conftest.py），并在测试函数执行之前执行该 fixture。</p>
<p>fixture 可以完成任务，也可以返回数据给测试函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">some_data</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;yield前面的代码执行111111&quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span>  <span class="number">42</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;yield前面的代码执行222222&quot;</span>)</span><br><span class="line">    <span class="comment"># return 42</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_some_data</span>(<span class="params">some_data</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;执行测试函数3333&quot;</span>,some_data)</span><br><span class="line">    <span class="keyword">assert</span> some_data == <span class="number">42</span></span><br></pre></td></tr></table></figure>

<h3 id="测试用例如何调用-fixture，如果要调用多个-fixture，应该怎么做？（多样用法）"><a href="#测试用例如何调用-fixture，如果要调用多个-fixture，应该怎么做？（多样用法）" class="headerlink" title="测试用例如何调用 fixture，如果要调用多个 fixture，应该怎么做？（多样用法）"></a>测试用例如何调用 fixture，如果要调用多个 fixture，应该怎么做？（多样用法）</h3><blockquote>
<p>一个测试用例调用了多个 fixture，调用顺序是范围越广的先调用，比如 session 级别的先调用，然后再到 function 级别</p>
</blockquote>
<ol>
<li>调用多个 fixture，就要把 fixture 作为参数传入测试用例函数中:def test_some_data(some_data,some_data1): …</li>
</ol>
<p><img src="/images/python711.png"></p>
<ol start="2">
<li>也可使用装饰器@pytest.mark.usefixtures(‘some_data’,‘some_data1’)指定多个 fixture，非常适合用在测试类上，与作为参数传入用例函数中区别在于作为参数传入能够使用 fixture 的返回值，usefixtures 形式不能拿到 fixture 的返回值</li>
</ol>
<p><img src="/images/python712.png"></p>
<pre><code>tips: 如果叠加使用多个 fixture，多 fixture 笛卡尔积调用就是把 fixture 各组参数以笛卡尔积的形式进行组合。
</code></pre>
<ol start="3">
<li>常用 fixture 添加 autouse 选项，这里代表每个测试函数会默认去执行此 fixture，并且我们测试函数不需要传入 some_data3 参数也可以执行这个 fixture。如果跟上 scope 作用域，则代表作用域内的测试函数都执行该 fixture</li>
</ol>
<p><img src="/images/python713.png"></p>
<h3 id="使用-fixture-执行配置及销毁逻辑"><a href="#使用-fixture-执行配置及销毁逻辑" class="headerlink" title="使用 fixture 执行配置及销毁逻辑"></a>使用 fixture 执行配置及销毁逻辑</h3><p>fixture 函数会在测试函数之前执行，但如果 fixture 函数包含 yield，那么系统会在 yield 处停止，转而运行测试函数，等测试函数执行完再回到 fixture，继续执行 yield 后面的代码</p>
<p>因此将 yield 之前的代码视为 setup 过程，yield 之后的代码视为 teardown 过程。无论测试函数执行过程中发生什么，yield 之后的代码都会被执行</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="comment">#scope=&quot;module&quot;当前.py文件里面所有用例开始前只执行一次</span></span><br><span class="line"><span class="comment"># scope=&quot;module&quot;+yield结合，相当于setup_module和teardown_module方法</span></span><br><span class="line"><span class="comment"># 整个模块运行之前调用yield之前打印，整个运行之后调用yield之后打印他。如果用例出现异常，不影响yiled后面teardown执行</span></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&quot;module&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">open</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;打开浏览器&quot;</span>)</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;执行teardown&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;关闭浏览器&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.mark.usefixtures(<span class="params"><span class="string">&quot;open&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_search1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;test_search1&quot;</span>)</span><br><span class="line">    <span class="keyword">raise</span> NameError</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_search2</span>(<span class="params"><span class="built_in">open</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;test_search2&quot;</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    pytest.main([<span class="string">&#x27;utils/my_utils/test_fixture_scope.py&#x27;</span>, <span class="string">&#x27;-vs&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="通过-conftest-py-共享-fixture"><a href="#通过-conftest-py-共享-fixture" class="headerlink" title="通过 conftest.py 共享 fixture"></a>通过 conftest.py 共享 fixture</h3><ol>
<li><p>如果希望多个测试文件共享 fixture，可以在某个公共目录下新建一个 conftest.py 文件，将 fixture 放在其中。低一级的 conftest.py 中的 fixture 可以供所在目录及其子目录下的测试使用。</p>
</li>
<li><p>fixture scope 为 session 级别是可以跨.py 模块调用的，也就是我们有多个.py 文件的用例时，如果多个用例只需调用一次 fixture，可以将 scope&#x3D;’session’写到 conftest.py 文件。写到 conftest.py 文件可以全局调用这里面的方法。使用 conftest.py 规则是:</p>
<ol>
<li><p>conftest.py 文件名是固定的，不可更改</p>
</li>
<li><p>conftest.py 与运行的用例要在同一个 package 下，且这个包有<strong>init</strong>.py 文件</p>
</li>
<li><p>执行过程中 pytest 会自动识别当前目录的 conftest.py，不需要导入<br>（尽管 conftest.py 是 py 模块，但它不能被测试文件导入，import conftest 用法是不被允许的，它被 pytest 视作一个本地插件库，可以把 tests&#x2F;conftest.py 看成是供 tests 目录下所有测试文件使用的 fixture 仓库）</p>
</li>
<li><p>放在项目根目录下可以全局调用，放在某个 packeg 下，就在该 packeg 内生效（其作用域是当前目录以及子目录），如果希望 fixture 的作用域仅限于某个测试文件，就将它写在该测试文件中。</p>
</li>
</ol>
</li>
</ol>
<h3 id="使用-fixture-传递测试数据，直接-return-数据"><a href="#使用-fixture-传递测试数据，直接-return-数据" class="headerlink" title="使用 fixture 传递测试数据，直接 return 数据"></a>使用 fixture 传递测试数据，直接 return 数据</h3><p>（数据可以用于测试中，也可以被其他 fixture 使用）</p>
<blockquote>
<p>如果是测试函数执行 assert 出错，测试结果为 Fail，用户就知道失败是发生在核心测试函数内部</p>
<p>如果是 fixture 函数发生 assert 异常，那么测试函数会报告成 ERROR，用户就知道失败是发生在测试依赖的 fixture</p>
</blockquote>
<h2 id="pytest-内置-Fixture"><a href="#pytest-内置-Fixture" class="headerlink" title="pytest 内置 Fixture"></a>pytest 内置 Fixture</h2><blockquote>
<p>内置的 fixture 可以大幅简化测试工作，例如在处理临时文件时，内置 fixture 可以识别命令行参数，在多个测试会话间通信，校验输出流，更改环境变量，审查错误报警</p>
</blockquote>
<h3 id="1-tmpdir，tmpdir-factory"><a href="#1-tmpdir，tmpdir-factory" class="headerlink" title="1. tmpdir，tmpdir_factory"></a>1. tmpdir，tmpdir_factory</h3><blockquote>
<p>负责在测试开始运行前创建临时文件目录，并在结束测试后删除<br>tmpdir 作用范围是函数 function 级别，单个测试或者每个测试函数需要创建临时目录或文件应该使用 tmpdir<br>tmpdir_factory 作用范围是会话 session 级别</p>
</blockquote>
<p>如果需要模块或者类级别作用范围的临时目录，该怎么办？可以利用 tmpdir_factory 再创建一个 fixture</p>
<p>假设有一个测试模块，其中有很多测试用例要读取一个 JSON 文件，我们可以在模块本身或 conftest.py 中创建一个作用范围是模块级别的 fixture，用于配置该文件</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="string">&quot;&quot;&quot;author_file_json 这个新fixture创建了一个临时目录data，并在目录下创建了一个文件author_file.json，</span></span><br><span class="line"><span class="string">然后将python_author_data字典写入json文件中，因为这个fixture是module级别的，所以该json文件只需要被每个模块创建一次</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&#x27;module&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">author_file_json</span>(<span class="params">tmpdir_factory</span>):</span><br><span class="line">    python_author_data = &#123;</span><br><span class="line">        <span class="string">&#x27;Ned&#x27;</span>: &#123;<span class="string">&#x27;City&#x27;</span>: <span class="string">&#x27;Boston&#x27;</span>&#125;,</span><br><span class="line">        <span class="string">&#x27;Brian&#x27;</span>: &#123;<span class="string">&#x27;City&#x27;</span>: <span class="string">&#x27;Portland&#x27;</span>&#125;,</span><br><span class="line">        <span class="string">&#x27;Luciano&#x27;</span>: &#123;<span class="string">&#x27;City&#x27;</span>: <span class="string">&#x27;Sau Paulo&#x27;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    file= tmpdir_factory.mktemp(<span class="string">&#x27;data&#x27;</span>).join(<span class="string">&#x27;author_file.json&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;file:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(file)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> file.<span class="built_in">open</span>(<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(python_author_data, f)</span><br><span class="line">    <span class="keyword">return</span> file</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="string">&quot;&quot;&quot;这里两个测试用例将使用同一个json文件，如果一个测试数据文件能服务于多个用例，那么就没必要为每个测试用例创建一个数据文件，直接定义为模块级别的fixture&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_brian_in_portland</span>(<span class="params">author_file_json</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;A test that uses a data file.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> author_file_json.<span class="built_in">open</span>() <span class="keyword">as</span> f:</span><br><span class="line">        authors = json.load(f)</span><br><span class="line">    <span class="keyword">assert</span> authors[<span class="string">&#x27;Brian&#x27;</span>][<span class="string">&#x27;City&#x27;</span>] == <span class="string">&#x27;Portland&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_all_have_cities</span>(<span class="params">author_file_json</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Same file is used for both tests.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> author_file_json.<span class="built_in">open</span>() <span class="keyword">as</span> f:</span><br><span class="line">        authors = json.load(f)</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> authors:</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(authors[a][<span class="string">&#x27;City&#x27;</span>]) &gt; <span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-pytestconfig"><a href="#2-pytestconfig" class="headerlink" title="2. pytestconfig"></a>2. pytestconfig</h3><blockquote>
<p><font style="color:rgb(77, 77, 77);">pytestconfig 可以通过</font><a href="https://so.csdn.net/so/search?q=%E5%91%BD%E4%BB%A4%E8%A1%8C&spm=1001.2101.3001.7020"><font style="color:rgb(77, 77, 77);">命令行</font></a><font style="color:rgb(77, 77, 77);">参数、选项、配置文件、插件、运行目录等方式来控制 pytest；</font></p>
<p><font style="color:rgb(77, 77, 77);">pytestconfig 实际上就是 request.config 的快捷方式，被称为“pytest 配置对象”；</font></p>
</blockquote>
<h4 id="获取命令行参数的值"><a href="#获取命令行参数的值" class="headerlink" title="获取命令行参数的值"></a><font style="color:rgb(79, 79, 79);">获取命令行参数的值</font></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册自定义参数 cmdopt 到配置对象</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pytest_addoption</span>(<span class="params">parser</span>):</span><br><span class="line">    parser.addoption(<span class="string">&quot;--cmdopt&quot;</span>, action=<span class="string">&quot;store&quot;</span>, default=<span class="string">&quot;None&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;将自定义命令行参数 &#x27;--cmdopt&#x27; 添加到 pytest 配置中&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从配置对象获取 cmdopt 的值</span></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&#x27;session&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmdopt</span>(<span class="params">pytestconfig</span>):</span><br><span class="line">    <span class="keyword">return</span> pytestconfig.getoption(<span class="string">&#x27;--cmdopt&#x27;</span>)    <span class="comment">#getoption() 可以获取命令行的值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后任何 fixture 或测试用例都可以调用 cmdopt 来获得设备信息</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">device_info = &#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;xxx&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;华为&#x27;</span>, <span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;10&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">pytest.main([<span class="string">&#x27;-m all&#x27;</span>, <span class="string">f&#x27;--cmdopt=<span class="subst">&#123;device_info&#125;</span>&#x27;</span>])  <span class="comment"># 使用自定义参数传参</span></span><br></pre></td></tr></table></figure>

<h4 id="获取-pytest-ini-配置文件参数的值"><a href="#获取-pytest-ini-配置文件参数的值" class="headerlink" title="获取 pytest.ini 配置文件参数的值"></a><font style="color:rgb(79, 79, 79);">获取 pytest.ini 配置文件参数的值</font></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[pytest]</span><br><span class="line">markers =</span><br><span class="line">    demo : marks tests <span class="keyword">as</span> demo</span><br><span class="line">    smoke: marks tests <span class="keyword">as</span> smoke</span><br><span class="line">    test : marks tests <span class="keyword">as</span> test</span><br><span class="line"></span><br><span class="line">log_cli = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pytest.fixture(<span class="params">autouse=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fuc_fix</span>(<span class="params">pytestconfig</span>):</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="built_in">print</span>(pytestconfig.getini(<span class="string">&#x27;markers&#x27;</span>))  <span class="comment">#[&#x27;demo : marks tests as demo&#x27;, &#x27;smoke: marks tests as smoke&#x27;, &#x27;test : marks tests as test&#x27;]</span></span><br><span class="line">    <span class="built_in">print</span>(pytestconfig.getini(<span class="string">&#x27;log_cli&#x27;</span>))  <span class="comment">#True    部分参数中的值会被转换为布尔值！</span></span><br></pre></td></tr></table></figure>

<h3 id="3-pytest-cache-文件夹"><a href="#3-pytest-cache-文件夹" class="headerlink" title="3. .pytest_cache 文件夹"></a>3. .pytest_cache 文件夹</h3><blockquote>
<p><font style="color:rgb(18, 18, 18);">pytest 运行完用例之后会生成一个 </font><font style="color:rgb(18, 18, 18);background-color:rgb(246, 246, 246);">.pytest_cache</font><font style="color:rgb(18, 18, 18);">的缓存文件夹，用于记录用例的 ids 和上一次失败的用例。</font><br><font style="color:rgb(18, 18, 18);">1、跑自动化时经常会出现这样一个情况，一轮自动化跑完后零星出现了几个失败测试用例，无法断定失败的原因，所以可能需要重新跑一下失败的测试用例去调试，那我们要做的是就去修改脚本把那几个失败的测试用例筛选出来然后重新跑一遍；</font><br><font style="color:rgb(18, 18, 18);">2、但是在 pytest 测试框架因为有缓存功能，就不需要手动去查找上次失败的测试用例并筛选执行;</font><br><font style="color:rgb(18, 18, 18);">3.、pytest 测试框架中执行完所有的测试用例后会在当前目录下生成 </font><font style="color:rgb(18, 18, 18);background-color:rgb(246, 246, 246);">.pytest_cache</font><font style="color:rgb(18, 18, 18);"> ，里面就保存了上一次用例执行的信息;</font></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">--last-failed： 如重新运行上次运行结果为失败的测试用例， 如果没有执行失败的用例则执行所有的测试用例。【 --lf 】</span><br><span class="line">--failed-first：运行所有测试，但首先运行上次运行失败的测试（这可能会重新测试，从而导致重复的 fixture setup/teardown ）【 --ff 】</span><br><span class="line">--new-first：根据文件插件的时间，新的测试用例会先运行。【 --nf 】</span><br><span class="line">--cache-show：显示 .pytest_cache 文件内容，不会收集测试用例也不会执行测试用例</span><br><span class="line">--cache-clear：开始执行测试之前先清空 .pytest_cache 文件</span><br></pre></td></tr></table></figure>

<p>cache 还可以用于记录测试的耗时，存储到 Cache，如果接下来的测试耗时大于之前的两倍，就抛出异常?????</p>
<p>cache 的接口比较简单 cache.get(key, default),cache.set(key,value)</p>
<h3 id="4-capsys"><a href="#4-capsys" class="headerlink" title="4. capsys"></a>4. capsys</h3><ol>
<li>允许代码读取 stdout 和 stderr</li>
<li>可以临时禁止抓取日志输出</li>
</ol>
<h3 id="5-monkypatch"><a href="#5-monkypatch" class="headerlink" title="5. monkypatch"></a>5. monkypatch</h3><ol>
<li>在运行期间对类或者模块进行动态修改</li>
</ol>
<h3 id="5-doctest-namespace"><a href="#5-doctest-namespace" class="headerlink" title="5. doctest_namespace"></a>5. doctest_namespace</h3><h3 id="6-recwarn"><a href="#6-recwarn" class="headerlink" title="6. recwarn"></a>6. recwarn</h3><ol>
<li>用来检查待测代码产生的警告信息</li>
</ol>
<h2 id="pytest-ini-配置文件"><a href="#pytest-ini-配置文件" class="headerlink" title="pytest.ini 配置文件"></a>pytest.ini 配置文件</h2><p>首先了解 pytest 中有哪些非测试文件？</p>
<ol>
<li>pytest.ini 主配置文件，可以改变 pytest 的默认行为</li>
<li>conftest.py 本地插件库，其中的 hook 和 fixture 作用于该文件所在的目录以及所有子目录</li>
<li><strong>init</strong>.py 每个测试子目录都包含</li>
<li>tox.ini 使用 tox 工具时的配置文件，与 pytest.ini 一样的功能，但是这两个不能同时使用？？？</li>
<li>setup.cfg 也采用 ini 的格式，可以影响 setup.py 的行为，用于发布一个 python 包的配置文件</li>
</ol>
<h3 id="1-修改默认命令行选项"><a href="#1-修改默认命令行选项" class="headerlink" title="1. 修改默认命令行选项"></a>1. 修改默认命令行选项</h3><p>使用 pytest.ini 文件中的 addopts 设置<br>-rsxX 表示 pytest 报告所有测试用例被跳过，预计失败但实际通过的原因<br>-l 表示报告所有失败测试的堆栈中的局部变量<br>–tb&#x3D;short 简化堆栈回溯信息，只保留文件和行数<br>–strict 禁止使用未在配置文件中注册的标记</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">addopts</span> = -rsxX -l --tb=short --strict</span><br><span class="line"><span class="attr">xfail_strict</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">markers</span> =</span><br><span class="line">    smoke: run the smoke test functions</span><br><span class="line">    get: run the get test functions</span><br></pre></td></tr></table></figure>

<h3 id="2-注册标记来防范拼写错误"><a href="#2-注册标记来防范拼写错误" class="headerlink" title="2. 注册标记来防范拼写错误"></a>2. 注册标记来防范拼写错误</h3><p>使用 pytest.ini 文件中的 markers 设置<br>使用 pytest –markers 查看注册了哪些标记</p>
<h3 id="3-指定-pytest-的最低版本号"><a href="#3-指定-pytest-的最低版本号" class="headerlink" title="3. 指定 pytest 的最低版本号"></a>3. 指定 pytest 的最低版本号</h3><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">minversion</span> = <span class="number">3.0</span></span><br></pre></td></tr></table></figure>

<h3 id="4-指定-pytest-忽略哪些搜索目录"><a href="#4-指定-pytest-忽略哪些搜索目录" class="headerlink" title="4. 指定 pytest 忽略哪些搜索目录"></a>4. 指定 pytest 忽略哪些搜索目录</h3><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">norecursedirs</span> = ._ venv src _.egg dist build</span><br></pre></td></tr></table></figure>

<h3 id="5-添加测试用例路径"><a href="#5-添加测试用例路径" class="headerlink" title="5. 添加测试用例路径"></a>5. 添加测试用例路径</h3><p>testpaths 限定测试用例的搜索范围，只有在 pytest 未指定文件目录或测试用例标识符时，该选项才会被启用</p>
<h3 id="6-修改测试用例搜索匹配规则"><a href="#6-修改测试用例搜索匹配规则" class="headerlink" title="6. 修改测试用例搜索匹配规则"></a>6. 修改测试用例搜索匹配规则</h3><p>pytest 寻找以 Test<em>开头的测试类，而且这个类不能有<strong>init</strong>函数，如果把测试类命名为</em>Test 或者*Suite 呢???</p>
<figure class="highlight ini"><figcaption><span>pytest.ini</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line">python*<span class="attr">classes</span> = \*\_Test Test*\* Suite</span><br><span class="line">python*<span class="attr">files</span> = test*\* _*test check*_</span><br><span class="line">python*<span class="attr">functions</span> = test*\_ check\_\_</span><br></pre></td></tr></table></figure>

<h3 id="7-指定-usefixtures-的默认配置"><a href="#7-指定-usefixtures-的默认配置" class="headerlink" title="7. 指定 usefixtures 的默认配置"></a>7. 指定 usefixtures 的默认配置</h3><figure class="highlight ini"><figcaption><span>pytest.ini</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"><span class="attr">usefixtures</span>=</span><br><span class="line">drivers</span><br><span class="line">login</span><br></pre></td></tr></table></figure>

<p>如果 usefixtures 后面没有跟具体的 fixture,则读取配置文件中默认的 fixture,这个默认值必须存在,否则报错</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pytest.mark usefixtures</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>()...</span><br></pre></td></tr></table></figure>

<h3 id="8-禁用-XPASS"><a href="#8-禁用-XPASS" class="headerlink" title="8. 禁用 XPASS"></a>8. 禁用 XPASS</h3><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">xfail_strict</span> = <span class="literal">true</span> <span class="comment">#会使那些被标记为@pytest.mark.xfail 但实际通过的测试用例也被报告为失败 Failed</span></span><br></pre></td></tr></table></figure>

<h3 id="9-避免文件名冲突"><a href="#9-避免文件名冲突" class="headerlink" title="9. 避免文件名冲突"></a>9. 避免文件名冲突</h3><p>只需要在两个子目录里各添加一个空的<strong>init</strong>.py 文件即可</p>
<h3 id="10-ids-解决中文显示乱码的问题"><a href="#10-ids-解决中文显示乱码的问题" class="headerlink" title="10. ids 解决中文显示乱码的问题"></a>10. ids 解决中文显示乱码的问题</h3><p>第一种解决办法设置 ini 文件中的</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">disable_test_id_escaping_and_forfeit_all_rights_to_community_support</span> = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><figcaption><span>第二种解决办法:在conftest.py中利用pytest提供的hook函数pytest_collection_modifyitems</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">pytest_collection_modifyitems</span>(<span class="params">items</span>):</span><br><span class="line"><span class="comment">#测试用例收集完成时，将收集到的item的name和nodeid的中文显示在控制台上</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">    item.name = item.name.encode(<span class="string">&quot;utf-8&quot;</span>).decode(<span class="string">&quot;unicode_escape&quot;</span>)</span><br><span class="line">    item._nodeid = item.nodeid.encode(<span class="string">&quot;utf-8&quot;</span>).decode(<span class="string">&quot;unicode_escape&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="11-console-output-style-输出样式配置"><a href="#11-console-output-style-输出样式配置" class="headerlink" title="11. console_output_style 输出样式配置"></a>11. console_output_style 输出样式配置</h3><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">console_output_style</span>=</span><br><span class="line">classic (经典 pytest 输出,没有显示进度百分比)/</span><br><span class="line">progress(带进度指示器) /</span><br><span class="line">count (进度显示为已完成的测试数而不是百分比)</span><br></pre></td></tr></table></figure>

<h3 id="12-filterwarnings-警告过滤"><a href="#12-filterwarnings-警告过滤" class="headerlink" title="12. filterwarnings 警告过滤"></a>12. filterwarnings 警告过滤</h3><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">filterwarnings</span> = error</span><br><span class="line">ignore:: DeprecationWarning</span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="pytest-插件-plugins"><a href="#pytest-插件-plugins" class="headerlink" title="pytest 插件 plugins"></a>pytest 插件 plugins</h2><h3 id="改变测试流程的插件"><a href="#改变测试流程的插件" class="headerlink" title="改变测试流程的插件"></a>改变测试流程的插件</h3><h4 id="pytest-ordering-自定义用例执行顺序"><a href="#pytest-ordering-自定义用例执行顺序" class="headerlink" title="pytest-ordering 自定义用例执行顺序"></a>pytest-ordering 自定义用例执行顺序</h4><p>用例方法上添加装饰器@pytest.mark.run(order&#x3D;2),用例执行顺序会以 order 值大小升序去调用执行。</p>
<h4 id="pytest–random-order-随机化测试顺序"><a href="#pytest–random-order-随机化测试顺序" class="headerlink" title="pytest–random-order 随机化测试顺序"></a>pytest–random-order 随机化测试顺序</h4><h4 id="pytest-assume-断言报错后依然执行"><a href="#pytest-assume-断言报错后依然执行" class="headerlink" title="pytest-assume 断言报错后依然执行"></a>pytest-assume 断言报错后依然执行</h4><p>pytest.assume(x&gt;1)</p>
<h4 id="pytest-repeat-重复运行测试"><a href="#pytest-repeat-重复运行测试" class="headerlink" title="pytest-repeat 重复运行测试"></a>pytest-repeat 重复运行测试</h4><p>pytest test.py –count&#x3D;2 -v -k test-list 使用–count 来指定每个测试用例运行两次</p>
<h4 id="pytest-timeout"><a href="#pytest-timeout" class="headerlink" title="pytest-timeout"></a>pytest-timeout</h4><p>允许在命令行指定超时时间或者直接在测试代码中标注超时时间</p>
<h4 id="pytest-rerunfailures-失败测试用例自动重试"><a href="#pytest-rerunfailures-失败测试用例自动重试" class="headerlink" title="pytest-rerunfailures 失败测试用例自动重试"></a>pytest-rerunfailures 失败测试用例自动重试</h4><p>pytest test_demo.py –reruns 2 定义失败后重试 2 次</p>
<h4 id="pytest-freezegun-冰冻时间"><a href="#pytest-freezegun-冰冻时间" class="headerlink" title="pytest-freezegun 冰冻时间"></a>pytest-freezegun 冰冻时间</h4><p>这个插件可以随时改变当前系统时间,freezer 可以冰冻时间, freezer.move_to 可以改变时间,解决验证某一时间点的代码触发,或未来时间的代码变化问题</p>
<p>pytest.assume(x&gt;1)</p>
<h4 id="pytest-xdist-并发运行测试用例"><a href="#pytest-xdist-并发运行测试用例" class="headerlink" title="pytest-xdist 并发运行测试用例"></a>pytest-xdist 并发运行测试用例</h4><p>原理: 将测试分发到 CPU 和远程主机,以盒装模式运行,该模式可以保留分段错误,以 looponfail 模式运行,并根据文件更改自动重新运行失败的测试</p>
<blockquote>
<p>假如测试用例 1000 条，一条测试用例执行需要 1 分钟，一个测试人员需要 1000 分钟才能完成一条回归测试，如果是 10 个人一起执行就需要 100 分钟，这就是一种并行测试，分布式的场景。</p>
</blockquote>
<p>通常测试都是依次执行的，因为有些资源一次只能被一个测试用例访问，如果你的测试不需要访问共享资源，就可以通过并行运行来提速，pytest-xdist 可以指定处理器数目来同时运行多个测试，甚至可以把测试放在多台机器上运行。pytest-xdist 是 pytest 分布式执行插件，特性在于：</p>
<ol>
<li>可以多个 CPU 或主机执行，允许用户将测试并发执行（进程级并发）</li>
<li>插件动态决定用例执行顺序，为了保证每条用例在各个独立线程里正确的执行，应该保证测试用例的独立性（这也符合测试用例设计的最佳实践）</li>
<li>多个 CPU 并发执行，需要加上参数<ol>
<li>pytest -n auto，auto 表示自动检测 CPU 数目</li>
<li>pytest -n 4，4 表示执行运行测试用例的处理器进程数</li>
</ol>
</li>
</ol>
<p>缺点：非线程安全&#x2F;多线程运行时性能不佳&#x2F;需要做状态隔离</p>
<h4 id="pytest-parallel-并发运行测试用例"><a href="#pytest-parallel-并发运行测试用例" class="headerlink" title="pytest-parallel 并发运行测试用例"></a>pytest-parallel 并发运行测试用例</h4><p>pytest-parallel 仅仅支持 python3.6 以上，unix&#x2F;mac 上支持多线程运行和多进程运行两种，windows 上仅支持多线程运行方式</p>
<ol>
<li>指定 2 个进程并发: <code>pytest --workers 2</code></li>
<li>指定 2 个进程并发,每个进程最多运行 3 个线程: <code>pytest --workers 2 --test-per-worker 3</code><br>有时会出现【管道已结束 109】错误，官方暂时未修复</li>
</ol>
<h3 id="改善输出效果的插件"><a href="#改善输出效果的插件" class="headerlink" title="改善输出效果的插件"></a>改善输出效果的插件</h3><h4 id="pytest-instafail-用例失败时立即显示错误堆栈回溯信息"><a href="#pytest-instafail-用例失败时立即显示错误堆栈回溯信息" class="headerlink" title="pytest-instafail 用例失败时立即显示错误堆栈回溯信息"></a>pytest-instafail 用例失败时立即显示错误堆栈回溯信息</h4><h4 id="pytest-sugar-显示色彩和进度"><a href="#pytest-sugar-显示色彩和进度" class="headerlink" title="pytest-sugar 显示色彩和进度"></a>pytest-sugar 显示色彩和进度</h4><h4 id="pytest-emoji-为测试添加一些乐趣，把测试状态字符替换成表情符号"><a href="#pytest-emoji-为测试添加一些乐趣，把测试状态字符替换成表情符号" class="headerlink" title="pytest-emoji 为测试添加一些乐趣，把测试状态字符替换成表情符号"></a>pytest-emoji 为测试添加一些乐趣，把测试状态字符替换成表情符号</h4><h4 id="pytest-html-为测试生成-html-报告"><a href="#pytest-html-为测试生成-html-报告" class="headerlink" title="pytest-html 为测试生成 html 报告"></a>pytest-html 为测试生成 html 报告</h4><h3 id="静态分析用的插件"><a href="#静态分析用的插件" class="headerlink" title="静态分析用的插件"></a>静态分析用的插件</h3><h4 id="pytest-pep8"><a href="#pytest-pep8" class="headerlink" title="pytest-pep8"></a>pytest-pep8</h4><h4 id="pytest-flakes"><a href="#pytest-flakes" class="headerlink" title="pytest-flakes"></a>pytest-flakes</h4><h3 id="web-开发用的插件"><a href="#web-开发用的插件" class="headerlink" title="web 开发用的插件"></a>web 开发用的插件</h3><h4 id="4-1-pytest-httpserver-模拟-http-服务"><a href="#4-1-pytest-httpserver-模拟-http-服务" class="headerlink" title="4.1 pytest-httpserver 模拟 http 服务"></a>4.1 pytest-httpserver 模拟 http 服务</h4><h4 id="4-2-pytest-picked-运行未提交-git-的用例"><a href="#4-2-pytest-picked-运行未提交-git-的用例" class="headerlink" title="4.2 pytest-picked 运行未提交 git 的用例"></a>4.2 pytest-picked 运行未提交 git 的用例</h4><pre><code>写完自动化后都会将代码提交到 git 仓库,随州用例的增多,为了保证仓库代码的干净,当有新增用例的时候,希望只运行新增的且尚未提交到 git 仓库的用例
</code></pre>
<h4 id="4-3-pytest-mock-模拟未实现的部分"><a href="#4-3-pytest-mock-模拟未实现的部分" class="headerlink" title="4.3 pytest-mock 模拟未实现的部分"></a>4.3 pytest-mock 模拟未实现的部分</h4><h4 id="4-4-pytest-cov-测试-python-程序覆盖率"><a href="#4-4-pytest-cov-测试-python-程序覆盖率" class="headerlink" title="4.4 pytest-cov 测试 python 程序覆盖率"></a>4.4 pytest-cov 测试 python 程序覆盖率</h4><p>先安装 pytest-cov 插件，coverage.py 时 pytest-cov 的一个依赖包<br>pytest –cov&#x3D;src src 是源码目录<br>pytest –cov&#x3D;src –cov-report&#x3D;html 得到一个 html 报告</p>
<h3 id="插件管理-https-pypi-org-search-q-pytest"><a href="#插件管理-https-pypi-org-search-q-pytest" class="headerlink" title="插件管理 https://pypi.org/search/?q=pytest"></a>插件管理 <a href="https://pypi.org/search/?q=pytest"><u>https://pypi.org/search/?q=pytest</u></a></h3><ol>
<li>在测试模块或者 conftest.py 文件中加载插件: pytest_plugins &#x3D; (“myqpp.testsupport.myplugin”,)</li>
<li>找出那些插件处于活动那个状态: 命令行中输入 pytest –trance –config</li>
<li>通过名称停用&#x2F;注销插件: pytest - p no: NAME</li>
<li>无条件禁用项目插件,则可以将此选项添加到 pytest.ini 文件中: addopts &#x3D; - P no: NAME</li>
<li>仅在某些环境中(例如 CI 服务器中)禁用它,可以将 PYTEST_ADDOPTS 环境变量设置为 - P no: NAME</li>
</ol>
<h2 id="pytest-与其他工具搭配"><a href="#pytest-与其他工具搭配" class="headerlink" title="pytest 与其他工具搭配"></a>pytest 与其他工具搭配</h2><h3 id="pdb"><a href="#pdb" class="headerlink" title="pdb"></a>pdb</h3><p>调试失败的测试用例<br>pytest -v -lf -x –pdb<br>p&#x2F;print expr 输出 expr 的值<br>pp expr 美化输出 expr 的值<br>l&#x2F;list 列出错误并显示错误之前和之后的 5 行代码<br>l&#x2F;list begin,end 列出错误并通过行号指定需要显示的代码区域<br>a&#x2F;args 打印当前函数的参数列表<br>q&#x2F;quit 退出当前调试会话</p>
<h3 id="tox"><a href="#tox" class="headerlink" title="tox"></a>tox</h3><p>测试多种配置<br>tox 不仅能测试不同的 python 版本，还可以用它来测试不同的依赖配置和不同的操作系统配置<br>pip install tox</p>
<h3 id="jenkins-CI"><a href="#jenkins-CI" class="headerlink" title="jenkins CI"></a>jenkins CI</h3><p>让测试自动化<br>pytest 可以生成 junit.xml 格式的文件，用于给 jenkins 和其他 CI 系统显示结果<br>使用 jenkins 运行 pytest 测试组件，有两个 jenkins 插件好用<br>build-name-setter : 这个插件可以设置每次运行的名字，而不是默认的#1,#2,#3<br>Test Result Analyzer plugin ：这个插件以图表的形式显示测试执行的历史信息</p>
<h3 id="unittest"><a href="#unittest" class="headerlink" title="unittest"></a>unittest</h3><p>用 pytest 运行历史遗留测试用例<br>用 unittest 运行是 python -m unittest -v a.py</p>
<h3 id="Allure"><a href="#Allure" class="headerlink" title="Allure"></a>Allure</h3><p>pip install allure-pytest</p>
<ol>
<li>收集结果 pytest –alluredir &#x3D; &#x2F;tmp&#x2F;allure_results</li>
<li>查看报告 allure serve &#x2F;tmp&#x2F;allure_results</li>
</ol>
<!-- # 待看

parametrize [其他参数详细用法见书 P165]
pytest_generate_tests 钩子函数允许定义自定义参数方案或扩展 P174
最后几页 MOCK/钩子函数用法 -->
]]></content>
      <categories>
        <category>测试库</category>
      </categories>
      <tags>
        <tag>pytest</tag>
      </tags>
  </entry>
  <entry>
    <title>shortcut-key</title>
    <url>/post/shortcut-key.html</url>
    <content><![CDATA[<h2 id="🔹-MAC-基本操作"><a href="#🔹-MAC-基本操作" class="headerlink" title="🔹 MAC 基本操作"></a><strong>🔹 MAC 基本操作</strong></h2><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Cmd + C</td>
<td>复制</td>
</tr>
<tr>
<td>Cmd + V</td>
<td>粘贴</td>
</tr>
<tr>
<td>Cmd + X</td>
<td>剪切</td>
</tr>
<tr>
<td>Cmd + D</td>
<td>复制+粘贴</td>
</tr>
<tr>
<td>Cmd + Z</td>
<td>撤销</td>
</tr>
<tr>
<td>Cmd + Shift + Z</td>
<td>复原（撤销的撤销）</td>
</tr>
<tr>
<td>Cmd + S</td>
<td>保存</td>
</tr>
<tr>
<td>Cmd + Shift + S</td>
<td>另存为</td>
</tr>
</tbody></table>
<h3 id="窗口-程序管理"><a href="#窗口-程序管理" class="headerlink" title="窗口 &amp; 程序管理"></a><strong>窗口 &amp; 程序管理</strong></h3><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Cmd + Tab</td>
<td>切换程序</td>
</tr>
<tr>
<td>Cmd + Shift + Tab</td>
<td>反向切换程序</td>
</tr>
<tr>
<td>Cmd + Q</td>
<td>退出当前程序</td>
</tr>
<tr>
<td>Opt + Cmd + Esc</td>
<td>强制退出程序</td>
</tr>
<tr>
<td>Cmd + W</td>
<td>关闭当前标签页</td>
</tr>
<tr>
<td>Cmd + M</td>
<td>最小化窗口</td>
</tr>
<tr>
<td>Cmd + H</td>
<td>隐藏当前窗口</td>
</tr>
<tr>
<td>Cmd + Opt + H</td>
<td>除当前窗口外，隐藏其他窗口</td>
</tr>
<tr>
<td>Fn + F</td>
<td>全屏窗口</td>
</tr>
<tr>
<td>Cmd + ,</td>
<td>打开程序偏好设置</td>
</tr>
</tbody></table>
<h3 id="访达文件管理"><a href="#访达文件管理" class="headerlink" title="访达文件管理"></a><strong>访达文件管理</strong></h3><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Cmd + Shift + N</td>
<td>新建文件夹</td>
</tr>
<tr>
<td>Cmd + Ctrl + N</td>
<td>将所选文件新建文件夹</td>
</tr>
<tr>
<td>Cmd + T</td>
<td>访达中新建标签页</td>
</tr>
<tr>
<td>Cmd + N</td>
<td>访达中新建窗口</td>
</tr>
<tr>
<td>Cmd + ↑</td>
<td>进入上级文件夹</td>
</tr>
<tr>
<td>Cmd + Delete</td>
<td>删除（移入垃圾桶）</td>
</tr>
<tr>
<td>Cmd + Shift + Delete</td>
<td>清空垃圾桶</td>
</tr>
<tr>
<td>Cmd + E</td>
<td>推出磁盘或设备</td>
</tr>
<tr>
<td>Cmd + I</td>
<td>查看文件信息</td>
</tr>
<tr>
<td>Opt + Cmd + I</td>
<td>开启信息检查器</td>
</tr>
<tr>
<td>Cmd + J</td>
<td>设置显示选项</td>
</tr>
<tr>
<td>Cmd + 双击文件夹</td>
<td>在新窗口打开文件夹</td>
</tr>
</tbody></table>
<h3 id="输入法-文本编辑"><a href="#输入法-文本编辑" class="headerlink" title="输入法 &amp; 文本编辑"></a><strong>输入法 &amp; 文本编辑</strong></h3><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Ctrl + 空格</td>
<td>切换输入法</td>
</tr>
<tr>
<td>Caps Lock（长按）</td>
<td>切换大小写</td>
</tr>
<tr>
<td>Cmd + T</td>
<td>切换字体</td>
</tr>
<tr>
<td>Cmd + B</td>
<td>加粗</td>
</tr>
<tr>
<td>Cmd + I</td>
<td>斜体</td>
</tr>
<tr>
<td>Cmd + U</td>
<td>下划线</td>
</tr>
<tr>
<td>Cmd + Opt + C</td>
<td>复制文本样式</td>
</tr>
<tr>
<td>Cmd + Opt + V</td>
<td>粘贴文本样式</td>
</tr>
<tr>
<td>Cmd + Shift + C</td>
<td>打开颜色面板</td>
</tr>
<tr>
<td>Fn + Delete</td>
<td>向后删除</td>
</tr>
</tbody></table>
<h3 id="浏览器快捷键"><a href="#浏览器快捷键" class="headerlink" title="浏览器快捷键"></a><strong>浏览器快捷键</strong></h3><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Cmd + R</td>
<td>刷新网页</td>
</tr>
<tr>
<td>Cmd + Shift + R</td>
<td>强制刷新网页</td>
</tr>
<tr>
<td>Cmd + Shift + H</td>
<td>前往主页</td>
</tr>
<tr>
<td>Cmd + 【</td>
<td>后退</td>
</tr>
<tr>
<td>Cmd + 】</td>
<td>前进</td>
</tr>
<tr>
<td>Shift + Cmd + D</td>
<td>添加到阅读列表</td>
</tr>
<tr>
<td>Ctrl + Cmd + 2</td>
<td>显示阅读列表</td>
</tr>
<tr>
<td>Cmd + D</td>
<td>添加书签</td>
</tr>
<tr>
<td>Ctrl + Cmd + 1</td>
<td>显示书签列表</td>
</tr>
<tr>
<td>Ctrl + Tab</td>
<td>切换标签页</td>
</tr>
<tr>
<td>Ctrl + Shift + Tab</td>
<td>反向切换标签页</td>
</tr>
<tr>
<td>Cmd + 1~9</td>
<td>直接切换到对应编号的标签页</td>
</tr>
<tr>
<td>Cmd + ~</td>
<td>切换窗口</td>
</tr>
<tr>
<td>Cmd + Shift + T</td>
<td>恢复关闭的网页</td>
</tr>
<tr>
<td>Cmd + Option + J&#x2F;I</td>
<td>直接打开控制台</td>
</tr>
<tr>
<td>Cmd + K</td>
<td>清空控制台</td>
</tr>
<tr>
<td>Cmd + R</td>
<td>重新加载页面（不清缓存）</td>
</tr>
<tr>
<td>Cmd + Shift +R</td>
<td>强制刷新（清缓存）</td>
</tr>
<tr>
<td>Tab</td>
<td>选中 Elements 面板中的下一个元素</td>
</tr>
<tr>
<td>Shift + Tab</td>
<td>选中上一个元素</td>
</tr>
<tr>
<td>Cmd + P</td>
<td>快速搜索文件（在 Sources 面板）</td>
</tr>
<tr>
<td>Cmd + Option + F</td>
<td>在 Sources 面板中搜索文本</td>
</tr>
<tr>
<td>Shift + Enter</td>
<td>在控制台执行多行代码</td>
</tr>
</tbody></table>
<h3 id="截图-录屏"><a href="#截图-录屏" class="headerlink" title="截图 &amp; 录屏"></a><strong>截图 &amp; 录屏</strong></h3><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Cmd + Shift + 3</td>
<td>全屏截图</td>
</tr>
<tr>
<td>Cmd + Shift + 4</td>
<td>选择区域截图</td>
</tr>
<tr>
<td>Cmd + Shift + 4 + 空格</td>
<td>截取窗口</td>
</tr>
<tr>
<td>Cmd + Shift + 5</td>
<td>录屏（全屏&#x2F;区域）</td>
</tr>
<tr>
<td>Cmd + Shift + 6</td>
<td>截取 Touch Bar</td>
</tr>
<tr>
<td>+ Ctrl（任意截图命令）</td>
<td>直接存入剪贴板</td>
</tr>
</tbody></table>
<h2 id="🔹-代码编辑（VSCode-等）"><a href="#🔹-代码编辑（VSCode-等）" class="headerlink" title="🔹 代码编辑（VSCode 等）"></a><strong>🔹 代码编辑（VSCode 等）</strong></h2><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Cmd + D</td>
<td>选中并批量修改相同变量</td>
</tr>
<tr>
<td>Cmd + F</td>
<td>当前文件内搜索（可替换）</td>
</tr>
<tr>
<td>Cmd + Shift + F</td>
<td>全局搜索（跨文件搜索）</td>
</tr>
<tr>
<td>Cmd + B</td>
<td>关闭&#x2F;打开侧边栏</td>
</tr>
<tr>
<td>Cmd + P</td>
<td>搜索并快速打开文件</td>
</tr>
<tr>
<td>Cmd + Shift + P</td>
<td>打开命令面板</td>
</tr>
<tr>
<td>Cmd + Enter</td>
<td>行内换行</td>
</tr>
<tr>
<td>Opt + ↑ &#x2F; ↓</td>
<td>移动当前行代码上下</td>
</tr>
<tr>
<td>Shift + Opt + ↑ &#x2F; ↓</td>
<td>复制当前行代码上下</td>
</tr>
<tr>
<td>Cmd + Shift + K</td>
<td>删除当前行</td>
</tr>
<tr>
<td>Cmd + C（无选中）</td>
<td>复制整行</td>
</tr>
<tr>
<td>Cmd + X（无选中）</td>
<td>剪切整行</td>
</tr>
</tbody></table>
<h3 id="光标-选择"><a href="#光标-选择" class="headerlink" title="光标 &amp; 选择"></a><strong>光标 &amp; 选择</strong></h3><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Opt + ← &#x2F; →</td>
<td>光标按单词跳转</td>
</tr>
<tr>
<td>Cmd + ← &#x2F; →</td>
<td>跳转到行首&#x2F;行尾</td>
</tr>
<tr>
<td>Cmd + ↑ &#x2F; ↓</td>
<td>跳转到文件顶部&#x2F;底部</td>
</tr>
<tr>
<td>Opt + Shift + ← &#x2F; →</td>
<td>按单词选中文本块</td>
</tr>
<tr>
<td>Cmd + Shift + → &#x2F; ←</td>
<td>选中光标前&#x2F;后文本</td>
</tr>
<tr>
<td>Opt + Delete &#x2F; Backspace</td>
<td>按单词删除</td>
</tr>
</tbody></table>
<h3 id="注释-格式化"><a href="#注释-格式化" class="headerlink" title="注释 &amp; 格式化"></a><strong>注释 &amp; 格式化</strong></h3><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Cmd + &#x2F;</td>
<td>行注释&#x2F;取消注释</td>
</tr>
<tr>
<td>Cmd + [ &#x2F; Cmd + ]</td>
<td>左&#x2F;右缩进代码</td>
</tr>
<tr>
<td>Shift + Opt + F</td>
<td>格式化代码（Prettier&#x2F;ESLint）</td>
</tr>
<tr>
<td>Shift + F12</td>
<td>跳转调用当前函数的位置</td>
</tr>
</tbody></table>
<h3 id="终端-UI-操作"><a href="#终端-UI-操作" class="headerlink" title="终端 &amp; UI 操作"></a><strong>终端 &amp; UI 操作</strong></h3><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Cmd + J</td>
<td>显示&#x2F;隐藏终端</td>
</tr>
<tr>
<td>Cmd + K, Cmd + S</td>
<td>打开快捷键设置</td>
</tr>
<tr>
<td>Cmd + Shift + U</td>
<td>打开输出面板</td>
</tr>
<tr>
<td>Cmd + Shift + X</td>
<td>打开扩展商店</td>
</tr>
<tr>
<td>Cmd + 0</td>
<td>定位文件</td>
</tr>
</tbody></table>
<h2 id="🔹-TablePlus-常用快捷键"><a href="#🔹-TablePlus-常用快捷键" class="headerlink" title="🔹 TablePlus 常用快捷键"></a><strong>🔹 TablePlus 常用快捷键</strong></h2><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Cmd + K</td>
<td>切换到新的数据库</td>
</tr>
<tr>
<td>Cmd + Shift + K</td>
<td>切换到新的连接</td>
</tr>
<tr>
<td>Cmd + Enter</td>
<td>运行当前查询</td>
</tr>
<tr>
<td>Cmd + Shift + Enter</td>
<td>运行所有查询</td>
</tr>
<tr>
<td>Cmd + R</td>
<td>重新加载工作区</td>
</tr>
<tr>
<td>Cmd + Option + R</td>
<td>重新加载当前 tab</td>
</tr>
<tr>
<td>Cmd + Shift + R</td>
<td>重新连接</td>
</tr>
<tr>
<td>Cmd + Option + .</td>
<td>取消连接</td>
</tr>
</tbody></table>
<h2 id="🔹-iTerm2-常用快捷键"><a href="#🔹-iTerm2-常用快捷键" class="headerlink" title="🔹 iTerm2 常用快捷键"></a><strong>🔹 iTerm2 常用快捷键</strong></h2><h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a><strong>基本操作</strong></h3><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Option + Space</td>
<td>打开 iTerm2</td>
</tr>
<tr>
<td>⌘ + — &#x2F; + &#x2F; 0</td>
<td>调整字体大小</td>
</tr>
<tr>
<td>⌘ + R</td>
<td>清屏</td>
</tr>
<tr>
<td>Ctrl + L</td>
<td>清屏（与 ⌘ + R 类似）</td>
</tr>
<tr>
<td>Ctrl + A</td>
<td>光标移至行首</td>
</tr>
<tr>
<td>Ctrl + E</td>
<td>光标移至行末</td>
</tr>
<tr>
<td>Ctrl + F &#x2F; B</td>
<td>前进&#x2F;后退（相当于方向键）</td>
</tr>
<tr>
<td>Ctrl + P</td>
<td>上一条命令</td>
</tr>
<tr>
<td>Ctrl + R</td>
<td>搜索命令历史</td>
</tr>
<tr>
<td>Ctrl + D</td>
<td>删除当前字符</td>
</tr>
<tr>
<td>Ctrl + H</td>
<td>删除前一个字符</td>
</tr>
<tr>
<td>Ctrl + W</td>
<td>删除光标前的单词</td>
</tr>
<tr>
<td>Ctrl + K</td>
<td>删除到文本末尾</td>
</tr>
<tr>
<td>Ctrl + T</td>
<td>交换光标处文本</td>
</tr>
</tbody></table>
<h3 id="窗口面板管理"><a href="#窗口面板管理" class="headerlink" title="窗口面板管理"></a><strong>窗口面板管理</strong></h3><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Cmd + D</td>
<td>垂直分割</td>
</tr>
<tr>
<td>Shift + Cmd + D</td>
<td>水平分割</td>
</tr>
<tr>
<td>Cmd + [ &#x2F; Option + Cmd + ← &#x2F; →</td>
<td>切换到前一个面板</td>
</tr>
<tr>
<td>Cmd + ]</td>
<td>切换到后一个面板</td>
</tr>
<tr>
<td>Option + Cmd + ↑ &#x2F; ↓ &#x2F; ← &#x2F; →</td>
<td>切换到上下左右面板</td>
</tr>
<tr>
<td>⌘ + W</td>
<td>关闭当前面板</td>
</tr>
<tr>
<td>⌘ + Shift + Enter</td>
<td>最大化当前面板</td>
</tr>
<tr>
<td>⌘ + Shift + Enter（再次）</td>
<td>还原面板大小</td>
</tr>
</tbody></table>
<h3 id="标签页操作"><a href="#标签页操作" class="headerlink" title="标签页操作"></a><strong>标签页操作</strong></h3><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Cmd + T</td>
<td>新建标签页</td>
</tr>
<tr>
<td>Cmd + W</td>
<td>关闭标签页</td>
</tr>
<tr>
<td>Cmd + ← &#x2F; Shift + Cmd + [</td>
<td>前一个标签页</td>
</tr>
<tr>
<td>Cmd + → &#x2F; Shift + Cmd + ]</td>
<td>后一个标签页</td>
</tr>
<tr>
<td>Cmd + 1~9</td>
<td>进入指定编号的标签页</td>
</tr>
<tr>
<td>Option + Cmd + E</td>
<td>Expose 标签页（全屏显示并支持搜索所有标签页）</td>
</tr>
</tbody></table>
<h3 id="多个窗口操作"><a href="#多个窗口操作" class="headerlink" title="多个窗口操作"></a><strong>多个窗口操作</strong></h3><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Cmd + N</td>
<td>新建窗口</td>
</tr>
<tr>
<td>Cmd + W</td>
<td>关闭窗口</td>
</tr>
<tr>
<td>Cmd + &#96;</td>
<td>前一个窗口</td>
</tr>
<tr>
<td>Shift + Cmd + &#96;</td>
<td>后一个窗口</td>
</tr>
<tr>
<td>Option + Cmd + 1~9</td>
<td>进入指定窗口编号</td>
</tr>
</tbody></table>
<h3 id="其他功能"><a href="#其他功能" class="headerlink" title="其他功能"></a><strong>其他功能</strong></h3><table>
<thead>
<tr>
<th><strong>快捷键</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Cmd + Enter</td>
<td>进入&#x2F;退出全屏模式</td>
</tr>
<tr>
<td>Cmd + &#x2F;</td>
<td>查看当前光标位置</td>
</tr>
<tr>
<td>Cmd + ;</td>
<td>命令自动补全</td>
</tr>
<tr>
<td>Cmd + U</td>
<td>开启&#x2F;关闭背景半透明</td>
</tr>
<tr>
<td>Cmd + R</td>
<td>清屏（重置当前终端）</td>
</tr>
<tr>
<td>Cmd + Shift + H</td>
<td>呼出粘贴历史</td>
</tr>
<tr>
<td>Cmd + Option + B</td>
<td>打开即时回放</td>
</tr>
<tr>
<td>Esc</td>
<td>退出即时回放</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>快捷键</tag>
      </tags>
  </entry>
</search>
